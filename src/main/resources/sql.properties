##################################################
#
#USER
#
##################################################
user.login.matchcount=SELECT COUNT(*) count FROM s_user t WHERE (t.user_no = :USER_NO OR t.mail_address = :USER_NO) AND t.password = :PASSWORD
user.load.id = SELECT u.user_id, u.user_no, u.user_name, u.mail_address, u.`password`, u.photo, u.user_type, u.locked, \
             u.last_visit, u.last_ip, u.credit, u.regist_time,u.is_enterprise_user,u.session_num,u.ip_limit,u.isauthenmail,d.real_name, d.birth_date, d.identityid, d.gender, d.phone, d.address, \
             d.education, d.career, f.cash FROM s_user AS u INNER JOIN s_user_detail AS d ON u.user_id = d.user_id \
             INNER JOIN f_account AS f ON u.user_id = f.user_id WHERE u.user_id = :USER_ID
user.get.userNo = SELECT u.user_id, u.user_no, u.user_name, u.mail_address, u.`password`, u.photo, u.user_type, u.locked, \
             u.last_visit, u.last_ip, u.credit, u.regist_time,u.is_enterprise_user,u.session_num,u.ip_limit,u.isauthenmail, d.real_name, d.birth_date, d.identityid, d.gender, d.phone, d.address, \
             d.education, d.career, f.cash FROM s_user AS u INNER JOIN s_user_detail AS d ON u.user_id = d.user_id \
             INNER JOIN f_account AS f ON u.user_id = f.user_id WHERE (u.user_no = :USER_NO OR u.mail_address = :USER_NO)
user.update.logininfo = UPDATE s_user SET last_visit = :LAST_VISIT , last_ip = :LAST_IP WHERE user_id = :USER_ID
user.check.usernoandmail = SELECT COUNT(*) FROM s_user t WHERE (t.user_no=:USER_NO OR t.mail_address = :USER_NO)
user.create=INSERT INTO s_user (user_id, user_no, user_name, mail_address, `password`, photo, user_type, locked, last_visit, last_ip, credit, regist_time,is_enterprise_user,session_num,ip_limit) \
							VALUES(:USER_ID, :USER_NO, :USER_NAME, :MAIL_ADDRESS, :PASSWORD, :PHOTO, :USER_TYPE, :LOCKED, :LAST_VISIT, :LAST_IP, :CREDIT, :REGIST_TIME, :IS_ENTERPRISE_USER, :SESSION_NUM, :IP_LIMIT)
user.save.detail= INSERT INTO s_user_detail (user_id, real_name, birth_date, identityid, gender, phone, address, education, career) \
							VALUES(:USER_ID, :REAL_NAME, :BIRTH_DATE, :IDENTITYID, :GENDER, :PHONE, :ADDRESS, :EDUCATION, :CAREER)
user.init.account=INSERT INTO f_account(user_id,cash) VALUES(:USER_ID, 0)
user.update.info=update s_user set user_name = :USER_NAME, mail_address=:MAIL_ADDRESS, photo = :PHOTO,user_type=:USER_TYPE, locked=:LOCKED,last_visit = :LAST_VISIT , last_ip = :LAST_IP, isauthenmail = :ISAUTHENMAIL where user_id = :USER_ID
user.update.detail=UPDATE S_USER_DETAIL D SET D.PHONE = :PHONE, D.ADDRESS = :ADDRESS, D.BIRTH_DATE = :BIRTH_DATE, D.CAREER = :CAREER, D.EDUCATION = :EDUCATION, D.GENDER = :GENDER, D.IDENTITYID = :IDENTITYID, D.REAL_NAME = :REAL_NAME WHERE D.USER_ID = :USER_ID
user.update.account = UPDATE f_account SET cash=:CASH WHERE user_id = :USER_ID
user.update.password = UPDATE s_user SET password = :PASSWORD where user_id = :USER_ID
user.detail.checkphone = select count(*) count from s_user_detail where phone = :PHONE
user.update.isauthenmail = update s_user set isauthenmail = :ISAUTHENMAIL where user_id = :USER_ID
user.get.phone = SELECT u.user_id, u.user_no, u.user_name, u.mail_address, u.`password`, u.photo, u.user_type, u.locked, \
             u.last_visit, u.last_ip, u.credit, u.regist_time,u.is_enterprise_user,u.session_num,u.ip_limit,u.isauthenmail, d.real_name, d.birth_date, d.identityid, d.gender, d.phone, d.address, \
             d.education, d.career, f.cash FROM s_user AS u INNER JOIN s_user_detail AS d ON u.user_id = d.user_id \
             INNER JOIN f_account AS f ON u.user_id = f.user_id WHERE d.phone = :PHONE
##################################################
#
#LOGINLOG
#
##################################################
login.log.insert=INSERT INTO s_login_log(user_id,ip,login_datetime) VALUES (:USER_ID,:IP,:LOGIN_DATETIME)

##################################################
#
#\u8003\u8BD5\u7CFB\u7EDF
#
##################################################
examsystem.after.sortname.ofter=SELECT DISTINCT SORT_ID,SORT_NO,SORT_NAME, \
								(SELECT SORT_NAME FROM w_sort WHERE s.SORT_PARENT_ID=SORT_ID) AS  PARENT_SORT_NAME \
								FROM e_exam e JOIN w_sort s ON e.SUBJECT_NO=s.SORT_ID WHERE CAREAOR=:USER_ID AND RELEASE_STATUS=1

examsystem.before.examtype.select=SELECT SUBJECT_NO,SORT_NAME,COUNT(SORT_NAME) AS COUNT_NAME,(SELECT SORT_NAME FROM w_sort WHERE SORT_NO=LEFT(e.SUBJECT_NO ,3)) AS EXAM_TYPE \
								  FROM e_exam e JOIN w_sort s ON s.SORT_NO=e.SUBJECT_NO WHERE RELEASE_STATUS=1 \
								  GROUP BY SUBJECT_NO 
								  
examsystem.before.exam.score = SELECT SUM( IF ( trd.STUDENT_ANSWER = q.QUES_REFER, eq.SCORE, 0 )) SCORE \
								FROM e_test_record_detail AS trd, e_question AS q, e_test_record AS tr, e_exam_question AS eq \
							 	WHERE trd.TEST_REC_ID = :TEST_REC_ID \
							 	AND q.QUES_ID = trd.QUES_ID AND q.QUES_TYPE <> 4 AND q.QUES_TYPE <> 5 AND tr.TEST_REC_ID = trd.TEST_REC_ID AND eq.QUES_ID = trd.QUES_ID AND eq.EXAM_ID = tr.EXAM_ID

examsystem.before.update.detail.score = UPDATE e_test_record_detail AS trd INNER JOIN \
										( SELECT trd1.QUES_ID, IF ( trd1.STUDENT_ANSWER = q.QUES_REFER, eq.SCORE, 0 ) SCORE \
										FROM e_test_record_detail AS trd1, e_question AS q, e_test_record AS tr, e_exam_question AS eq \
										WHERE trd1.TEST_REC_ID = :TEST_REC_ID AND q.QUES_ID = trd1.QUES_ID \
										AND q.QUES_TYPE <> 4 AND q.QUES_TYPE <> 5 AND tr.TEST_REC_ID = trd1.TEST_REC_ID \
										AND eq.QUES_ID = trd1.QUES_ID AND eq.EXAM_ID = tr.EXAM_ID ) AS sqs \
										ON (sqs.QUES_ID = trd.QUES_ID) \
										SET trd.SCORE = sqs.SCORE WHERE trd.TEST_REC_ID = :TEST_REC_ID
															
examsystem.before.delete.detail.recid= DELETE FROM e_test_record_detail WHERE TEST_REC_ID = :TEST_REC_ID

examsystem.before.show.all.info= SELECT ee.B_TOPIC_NUM, ee.M_TOPIC_NUM, sa.TYPE_ID, sa.SCORE, sa.O_SCORE, sa.M_TOPIC, sa.QUES_ID, sa.QUES_CONTENT, sa.OPTION_NUM, sa.QUES_TYPE, sa.REMARK, sa.KNOWLEDGE_POINT, sa.KEYWORD, sa.STU_OSCORE, \
									sa.STU_SCORE, sa.QUES_REFER, sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, sa.COMMENT_REC, sa.QUES_REC, sa.DIFFICULTY, cp.ANSWER_TOTAL, IF ( cp.ANSWER_TOTAL = 0, 0, CONCAT( TRUNCATE ( cp.CORRECT_NUM/cp.ANSWER_TOTAL, 2) * 100, "%" )) CORRECT_PERCENT, \
									eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, eqt.TYPE_NAME, eqt.TYPE, eo.OPT_CONTENT, eo.OPT_ID, eo.OPT_REFER, eo.OPT_NO FROM e_exam ee JOIN ( SELECT eeq.EXAM_ID, eeq.QUES_ID, \
									SUM( IF ( IFNULL(etrd.SCORE, 0) >= eeq.SCORE, 1, 0 )) CORRECT_NUM, SUM( IF ( ISNULL(etrd.STUDENT_ANSWER) = 1, 0, 1 )) ANSWER_TOTAL FROM e_exam_question eeq LEFT JOIN e_test_record_detail etrd \
									ON etrd.QUES_ID = eeq.QUES_ID WHERE eeq.EXAM_ID = :EXAM_ID GROUP BY eeq.QUES_ID ) cp ON cp.EXAM_ID = ee.EXAM_ID JOIN ( SELECT eeq.EXAM_ID, eeq.QUES_ID, eeq.TYPE_ID, eeq.SCORE, eeq.O_SCORE, \
									eeq.M_TOPIC, eq.QUES_CONTENT, eq.OPTION_NUM, eq.QUES_TYPE, eq.REMARK, eq.KNOWLEDGE_POINT, eq.KEYWORD, eq.QUES_REFER, eq.QUES_REC, eq.DIFFICULTY, etrd.SCORE STU_SCORE, etrd.O_SCORE STU_OSCORE, etrd.TEACHER_COMMENT, etrd.ANSWER, etrd.COMMENT_REC, \
									IF ( etrd.SCORE >= eeq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), etrd.STUDENT_ANSWER, "@#@#" ), etrd.STUDENT_ANSWER ) STUDENT_ANSWER FROM e_exam_question eeq JOIN e_question eq \
									ON eq.QUES_ID = eeq.QUES_ID  AND (eq.QUES_TYPE=4 OR eq.QUES_TYPE=5 OR eq.QUES_TYPE=6 OR -1=:QUES_TYPE) LEFT JOIN e_test_record_detail etrd ON etrd.TEST_REC_ID = :TEST_REC_ID AND etrd.QUES_ID = eeq.QUES_ID WHERE eeq.EXAM_ID = :EXAM_ID ) sa ON sa.QUES_ID = cp.QUES_ID \
									JOIN e_ques_type eqt ON eqt.TYPE_ID = sa.TYPE_ID LEFT JOIN e_option eo ON eo.QUES_ID = sa.QUES_ID LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( SELECT err.QUES_ID, err.OPT_NO, err.ERROR_NUM, \
									IF ( @quesId = err.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := err.QUES_ID FROM ( SELECT eeq.QUES_ID, eo.OPT_NO, \
									SUM( IF ( etrd.STUDENT_ANSWER LIKE CONCAT("%", eo.OPT_NO, "%"), 1, 0 )) ERROR_NUM FROM e_exam_question eeq JOIN e_question eq ON eq.QUES_ID = eeq.QUES_ID \
									JOIN e_option eo ON eo.QUES_ID = eeq.QUES_ID LEFT JOIN e_test_record_detail etrd ON etrd.QUES_ID = eeq.QUES_ID WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_TYPE IN (1, 2) AND eo.OPT_REFER <> 1 \
									GROUP BY eeq.QUES_ID, eo.OPT_NO ORDER BY eeq.QUES_ID, ERROR_NUM DESC) err, ( SELECT @rankNo := 0, @quesId := NULL ) rn ) easyerr WHERE RANK_NO = 1 ) eaerr ON eaerr.QUES_ID = cp.QUES_ID WHERE ee.EXAM_ID = :EXAM_ID ORDER BY eqt.ORDER_NUM, sa.M_TOPIC, eo.OPT_NO

examsystem.before.show.error.questions= SELECT ee.B_TOPIC_NUM, ee.M_TOPIC_NUM, sa.TYPE_ID, sa.SCORE, sa.O_SCORE, sa.M_TOPIC, sa.QUES_ID, sa.QUES_CONTENT, sa.OPTION_NUM, sa.QUES_TYPE, sa.REMARK, sa.KNOWLEDGE_POINT, sa.KEYWORD, sa.STU_OSCORE, sa.STU_SCORE, sa.QUES_REFER, \
										sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, sa.QUES_REC, sa.COMMENT_REC, sa.DIFFICULTY, cp.ANSWER_TOTAL, IF ( cp.ANSWER_TOTAL = 0, 0, CONCAT( TRUNCATE ( cp.CORRECT_NUM / cp.ANSWER_TOTAL, 2 ) * 100, "%" )) CORRECT_PERCENT, \
										eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, eqt.TYPE_NAME, eqt.TYPE, eo.OPT_CONTENT, eo.OPT_ID, eo.OPT_REFER, eo.OPT_NO \
										FROM e_exam ee JOIN ( \
											SELECT eeq.EXAM_ID, eeq.QUES_ID, SUM( IF ( IFNULL(etrd.SCORE, 0) >= eeq.SCORE, 1, 0 )) CORRECT_NUM, SUM( IF ( ISNULL(etrd.STUDENT_ANSWER) = 1, 0, 1 )) ANSWER_TOTAL \
											FROM e_exam_question eeq LEFT JOIN e_test_record_detail etrd ON etrd.QUES_ID = eeq.QUES_ID WHERE eeq.EXAM_ID = :EXAM_ID GROUP BY eeq.QUES_ID) cp ON cp.EXAM_ID = ee.EXAM_ID \
										JOIN ( \
											SELECT eeq.EXAM_ID, eeq.QUES_ID, eeq.TYPE_ID, eeq.SCORE, eeq.O_SCORE, eeq.M_TOPIC, eq.QUES_CONTENT, eq.OPTION_NUM, eq.QUES_TYPE, eq.REMARK, eq.KNOWLEDGE_POINT, eq.KEYWORD, eq.QUES_REFER, eq.QUES_REC, eq.DIFFICULTY, etrd.COMMENT_REC, etrd.SCORE STU_SCORE, \
											etrd.O_SCORE STU_OSCORE, etrd.TEACHER_COMMENT, etrd.ANSWER, IF ( etrd.SCORE >= eeq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), etrd.STUDENT_ANSWER, "@#@#" ), etrd.STUDENT_ANSWER ) STUDENT_ANSWER \
											FROM e_exam_question eeq JOIN e_question eq ON eq.QUES_ID = eeq.QUES_ID LEFT JOIN e_test_record_detail etrd ON etrd.TEST_REC_ID = :TEST_REC_ID AND etrd.QUES_ID = eeq.QUES_ID \
											WHERE eeq.EXAM_ID = :EXAM_ID AND ( etrd.SCORE < eeq.SCORE OR ISNULL(etrd.TEST_REC_ID) = 1 )) sa ON sa.QUES_ID = cp.QUES_ID \
										JOIN e_ques_type eqt ON eqt.TYPE_ID = sa.TYPE_ID LEFT JOIN e_option eo ON eo.QUES_ID = sa.QUES_ID \
										LEFT JOIN ( \
										SELECT QUES_ID, OPT_NO, ERROR_NUM \
											FROM \
												(SELECT err.QUES_ID, err.OPT_NO, err.ERROR_NUM, IF ( @quesId = err.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := err.QUES_ID \
												FROM \
													(SELECT eeq.QUES_ID, eo.OPT_NO, SUM( IF ( etrd.STUDENT_ANSWER LIKE CONCAT("%", eo.OPT_NO, "%"), 1, 0 )) ERROR_NUM \
														FROM e_exam_question eeq JOIN e_question eq ON eq.QUES_ID = eeq.QUES_ID JOIN e_option eo ON eo.QUES_ID = eeq.QUES_ID \
														LEFT JOIN e_test_record_detail etrd ON etrd.QUES_ID = eeq.QUES_ID \
														WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_TYPE IN (1, 2) AND eo.OPT_REFER <> 1 \
														GROUP BY eeq.QUES_ID, eo.OPT_NO ORDER BY eeq.QUES_ID, ERROR_NUM DESC \
													) err,(SELECT @rankNo := 0, @quesId := NULL) rn \
												) easyerr \
											WHERE RANK_NO = 1 \
										) eaerr ON eaerr.QUES_ID = cp.QUES_ID \
										WHERE ee.EXAM_ID = :EXAM_ID ORDER BY sa.M_TOPIC, eo.OPT_NO

examsystem.all.select.code.name=SELECT CODE FROM s_code WHERE CODE_CATE=:CODE_CATE AND NAME=:NAME

examsystem.all.select.code=SELECT CODE,NAME FROM s_code WHERE CODE_CATE=:CODE_CATE 
								 
examsystem.after.quesType.save= INSERT INTO e_ques_type (TYPE_ID,EXAM_ID,TYPE_DETAIL,TYPE,ORDER_NUM,REMARK,DEFAULT_SCORE,TYPE_NAME,TS_ID) \
								VALUES (:TYPE_ID,:EXAM_ID,:TYPE_DETAIL,:TYPE,:ORDER_NUM,:REMARK,:DEFAULT_SCORE,:TYPE_NAME,:TS_ID)

network.save.questype= INSERT INTO e_ques_type(EXAM_ID, TYPE_ID, TS_ID, ORDER_NUM, TYPE, DEFAULT_SCORE, TYPE_NAME, TYPE_DETAIL) \
						SELECT :EXAM_ID, :TYPE_ID, :TS_ID, :ORDER_NUM, TYPE, 1, TS_NAME, TS_NAME FROM e_type_subject WHERE TS_ID = :TS_ID AND SUBJECT_ID=:SUBJECT_ID

network.get.random.ques.in.kpsrange= SELECT eq2.QUES_ID, eq2.QUES_TYPE, eq2.OPTION_NUM, eq2.REMARK FROM ( SELECT DISTINCT eq.QUES_ID, eq.REMARK \
									 FROM e_kp_rel ekr, e_ques_kp eqk, e_question eq WHERE ekr.KP_ID IN (:KP_ID) AND eqk.KP_ID = ekr.SUB_KP_ID \
									 AND eq.QUES_ID = eqk.QUES_ID AND eq.TS_ID = :TS_ID AND eq.SHARE_FLAG = 1 AND eq.RELEASE_FLAG = 1 \
									 AND eq.QUES_ID NOT IN (:QUES_ID) AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 && ISNULL(eq.REMARK) = 1 )) \
									 AND ( eq.DIFFICULTY >= IF ( :DIFFICULTY - 0.5 < 1.0, 1.0, :DIFFICULTY - 0.5 )) \
									 AND ( eq.DIFFICULTY <= IF ( :DIFFICULTY + 0.5 > 5.0, 5.0, :DIFFICULTY + 0.5 )) ORDER BY RAND() LIMIT :QUES_NUM ) eq1, \
									 e_question eq2 WHERE eq2.QUES_ID = eq1.QUES_ID OR IFNULL(eq2.REMARK, 0) = eq1.QUES_ID

network.get.quesids.of.exam= SELECT QUES_ID FROM e_exam_question WHERE EXAM_ID = :EXAM_ID

network.get.lastmtopic.of.exam= SELECT MAX(eeq.M_TOPIC) M_TOPIC FROM e_ques_type eqt, e_exam_question eeq WHERE eqt.EXAM_ID = :EXAM_ID AND eqt.ORDER_NUM <= :ORDER_NUM AND eeq.EXAM_ID = eqt.EXAM_ID AND eeq.TYPE_ID = eqt.TYPE_ID

network.update.topicsnum.of.exam= UPDATE e_exam ee, ( SELECT eeq.EXAM_ID, COUNT(eq.QUES_ID) TOTAL FROM e_exam_question eeq, e_question eq WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_ID = eeq.QUES_ID AND eq.QUES_TYPE <> 6 ) temp \
								SET ee.M_TOPIC_NUM = temp.TOTAL WHERE ee.EXAM_ID = temp.EXAM_ID

network.get.options.of.exam= SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_CONTENT, eo.OPT_REFER FROM e_exam_question eeq, e_option eo WHERE eeq.EXAM_ID = :EXAM_ID AND eo.QUES_ID = eeq.QUES_ID ORDER BY eeq.M_TOPIC, eeq.QUES_ID, OPT_NO

network.get.questions.of.exam= SELECT eeq.TYPE_ID, eeq.QUES_ID, eeq.SCORE, eeq.M_TOPIC, eeq.SCORE, eq.QUES_CONTENT, eq.QUES_REFER, eq.QUES_TYPE, eq.DIFFICULTY, eq.KEYWORD, eq.SHARE_FLAG, eq.REMARK FROM e_exam_question eeq, e_question eq \
								WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_ID = eeq.QUES_ID ORDER BY eeq.M_TOPIC, eeq.QUES_ID

network.get.bigquestions.of.exam= SELECT qt.TYPE_ID, qt.ORDER_NUM, qt.TYPE_NAME, qt.TYPE_DETAIL, qt.TYPE, qt.DEFAULT_SCORE, SUBSTRING_INDEX( SUBSTRING_INDEX(c.`NAME`, ",", qt.ORDER_NUM), "," ,- 1 ) INDEX_NO \
									FROM e_exam e, e_ques_type qt, s_code c WHERE e.EXAM_ID =:EXAM_ID AND qt.EXAM_ID = e.EXAM_ID AND c.CODE_CATE = 'CODETYPE' AND c.`CODE` = e.B_CODE_TYPE ORDER BY ORDER_NUM

examsystem.all.quesType.select.examId= SELECT TYPE_ID,EXAM_ID,TYPE,TYPE_DETAIL,ORDER_NUM,DEFAULT_SCORE,TYPE_NAME,TS_ID FROM e_ques_type WHERE EXAM_ID =:EXAM_ID ORDER BY ORDER_NUM 

examsystem.all.exam.bcodetype.select=SELECT NAME FROM e_exam e JOIN s_code s ON e.B_CODE_TYPE=s.CODE WHERE e.EXAM_ID=:EXAM_ID AND s.CODE_CATE='CODETYPE'

examsystem.all.exam.scodetype.select=SELECT NAME FROM e_exam e JOIN s_code s ON e.S_CODE_TYPE=s.CODE WHERE e.EXAM_ID=:EXAM_ID AND s.CODE_CATE='CODETYPE'

examsystem.all.exam.quesInfo.select= SELECT e.B_TOPIC_NUM, e.M_TOPIC_NUM, eq.TYPE_ID, q.QUES_ID, q.QUES_CONTENT, o.OPT_CONTENT, q.OPTION_NUM, q.CREATOR, q.SHARE_FLAG, q.RELEASE_FLAG, q.DIFFICULTY, eq.SCORE, eq.O_SCORE, q.QUES_TYPE, o.OPT_ID, o.OPT_REFER, o.OPT_NO, \
									q.REMARK, qt.TYPE_NAME, qt.TYPE, q.KNOWLEDGE_POINT, q.KEYWORD, q.QUES_REC, eq.M_TOPIC, etrd.STUDENT_ANSWER, etrd.REMARK MARKED_FLAG, etrd.ANSWER_TIME \
									FROM e_exam e JOIN e_exam_question eq ON e.EXAM_ID = eq.EXAM_ID JOIN e_question q ON eq.QUES_ID = q.QUES_ID JOIN e_ques_type qt ON qt.TYPE_ID = eq.TYPE_ID \
									LEFT JOIN e_test_record_detail etrd ON etrd.QUES_ID = eq.QUES_ID AND etrd.TEST_REC_ID = :TEST_REC_ID LEFT JOIN e_option o ON q.QUES_ID = o.QUES_ID \
									WHERE eq.EXAM_ID = :EXAM_ID ORDER BY qt.ORDER_NUM, eq.M_TOPIC, OPT_NO
	
examsystem.after.questype.update=UPDATE e_ques_type SET TYPE_NAME=:TYPE_NAME,TYPE_DETAIL=:TYPE_DETAIL,DEFAULT_SCORE=:DEFAULT_SCORE WHERE TYPE_ID=:TYPE_ID

examsystem.after.questype.delete.typeid=DELETE FROM e_ques_type WHERE TYPE_ID=:TYPE_ID

examsystem.after.examquestion.delete.typeid=DELETE FROM e_exam_question WHERE TYPE_ID=:TYPE_ID

examsystem.after.delete.examquestion= DELETE FROM e_exam_question WHERE EXAM_ID = :EXAM_ID AND QUES_ID=:QUES_ID

examsystem.after.save.question= INSERT INTO e_question (QUES_ID,SUBJECT_NO,QUES_TYPE,QUES_CONTENT,CREATOR,DIFFICULTY,REMARK,KNOWLEDGE_POINT,KEYWORD,OPTION_NUM,REL_FLAG,INPUT_TIME,QUES_REFER,RESOURCE,SHARE_FLAG,RELEASE_FLAG,GRADE_LEVEL,QUES_REC,TS_ID) \
								VALUES (:QUES_ID,:SUBJECT_NO,:QUES_TYPE,:QUES_CONTENT,:CREATOR,:DIFFICULTY,:REMARK,:KNOWLEDGE_POINT,:KEYWORD,:OPTION_NUM,:REL_FLAG,:INPUT_TIME,:QUES_REFER,:RESOURCE,:SHARE_FLAG,:RELEASE_FLAG,:GRADE_LEVEL,:QUES_REC,:TS_ID)
								
examsystem.after.save.option= INSERT INTO e_option (OPT_ID,QUES_ID,OPT_CONTENT,REMARK,OPT_FLAG,OPT_REFER,OPT_NO) \
							 	VALUES(:OPT_ID,:QUES_ID,:OPT_CONTENT,:REMARK,:OPT_FLAG,:OPT_REFER,:OPT_NO)

examsystem.after.save.examquestion= INSERT INTO e_exam_question (EXAM_ID,QUES_ID,TYPE_ID,M_TOPIC,SCORE,O_SCORE,REMARK) \
									VALUES(:EXAM_ID,:QUES_ID,:TYPE_ID,:M_TOPIC,:SCORE,:O_SCORE,:REMARK)
									
examsystem.after.wsort.select.two= SELECT s.SORT_NAME AS P_SORT_NAME, s.SORT_NO AS P_SORT_NO, w.SORT_ID, w.SORT_NAME, w.SORT_PARENT_ID FROM w_sort w \
									JOIN w_sort s ON LEFT (w.SORT_NO, 3) = s.SORT_NO AND RIGHT (w.SORT_NO, 3) != '000' WHERE LENGTH(w.SORT_NO) = 6 ORDER BY SORT_PARENT_ID, SORT_ID
							 
examsystem.after.save.eexam=INSERT INTO e_exam(EXAM_ID,EXAM_NAME,YEAR,SEMESTER,SUBJECT_NO,EXAM_TYPE,B_TOPIC_NUM,M_TOPIC_NUM,TOTAL,CAREAOR,COST_TIME,REMARK,Q_RANDOM,O_RANDOM,B_CODE_TYPE,S_CODE_TYPE,O_CODE_TYPE,PASS_SCORE,EXAM_AREA,RELEASE_STATUS) \
							VALUES (:EXAM_ID,:EXAM_NAME,:YEAR,:SEMESTER,:SUBJECT_NO,:EXAM_TYPE,:B_TOPIC_NUM,:M_TOPIC_NUM,:TOTAL,:CAREAOR,:COST_TIME,:REMARK,:Q_RANDOM,O_RANDOM,:B_CODE_TYPE,:S_CODE_TYPE,:O_CODE_TYPE,:PASS_SCORE,:EXAM_AREA,:RELEASE_STATUS)
							
examsystem.after.update.mtopics.after.addques= UPDATE e_exam_question eeq, e_question eq SET eeq.M_TOPIC = eeq.M_TOPIC + 1 WHERE eeq.EXAM_ID = :EXAM_ID AND M_TOPIC >= :M_TOPIC AND eq.QUES_ID = :QUES_ID AND eeq.QUES_ID <> IFNULL(eq.REMARK, 0) AND eeq.QUES_ID <> eq.QUES_ID

examsystem.after.update.examquestion.one.mtopic= UPDATE e_exam_question SET M_TOPIC = :M_TOPIC WHERE EXAM_ID =:EXAM_ID AND QUES_ID =:QUES_ID

examsystem.after.update.questype.ordernum= UPDATE e_ques_type SET ORDER_NUM=ORDER_NUM-1 WHERE ORDER_NUM>:ORDER_NUM AND EXAM_ID=:EXAM_ID							

examsystem.after.delete.article.questions= DELETE FROM e_exam_question WHERE EXAM_ID = :EXAM_ID AND QUES_ID IN(:QUES_ID)							

examsystem.after.update.article.after.mtopic= UPDATE e_exam_question SET M_TOPIC = M_TOPIC-:M_TOPIC_NUM WHERE EXAM_ID = :EXAM_ID AND M_TOPIC > :M_TOPIC

examsystem.all.get.exam.examId= SELECT EXAM_ID,M_TOPIC_NUM,CAREAOR,B_TOPIC_NUM,EXAM_NAME,YEAR,SEMESTER,CAREAOR,COST_TIME,EXAM_AREA,PASS_SCORE,TOTAL,SUBJECT_NO,RELEASE_STATUS,GRADE_LEVEL FROM e_exam WHERE EXAM_ID=:EXAM_ID

examsystem.all.get.question.remark = SELECT remark FROM e_question WHERE QUES_ID=:QUES_ID

examsystem.all.update.question.remark = UPDATE e_question SET REMARK=:REMARK WHERE QUES_ID=:QUES_ID

examsystem.all.update.article= UPDATE e_question SET QUES_CONTENT=:QUES_CONTENT, KNOWLEDGE_POINT = :KNOWLEDGE_POINT, INPUT_TIME = :INPUT_TIME, DIFFICULTY = :DIFFICULTY WHERE QUES_ID=:QUES_ID

examsystem.before.get.examtype = SELECT COUNT(e.EXAM_TYPE) AS COUNT_TYPE,c.NAME,e.EXAM_TYPE \
								FROM e_exam e JOIN f_goods g ON g.PRODUCT_ID=e.EXAM_ID JOIN s_code c ON e.EXAM_TYPE=c.CODE AND CODE_CATE='EXAMTYPE' AND g.PRODUCT_TYPE=5 \
								WHERE (LEFT(SUBJECT_NO,3)=:SUBJECT_NO OR SUBJECT_NO=:SUBJECT_NO) AND (:EXAM_AREA2 OR e.EXAM_AREA=:EXAM_AREA) AND (:EXAM_TYPE2 OR e.EXAM_TYPE=:EXAM_TYPE) \
								GROUP BY e.EXAM_TYPE
								
examsystem.before.get.examarea=SELECT COUNT(e.EXAM_AREA) AS COUNT_AREA,c.NAME,e.EXAM_AREA \
								FROM e_exam e JOIN f_goods g ON g.PRODUCT_ID=e.EXAM_ID JOIN s_code c ON e.EXAM_AREA=c.CODE AND CODE_CATE='AREA' AND g.PRODUCT_TYPE=5 \
								WHERE (LEFT(SUBJECT_NO,3)=:SUBJECT_NO OR SUBJECT_NO=:SUBJECT_NO) AND (:EXAM_AREA2 OR e.EXAM_AREA=:EXAM_AREA) AND (:EXAM_TYPE2 OR e.EXAM_TYPE=:EXAM_TYPE) \
								GROUP BY e.EXAM_AREA
								
examsystem.before.get.subjectNo=SELECT COUNT(e.SUBJECT_NO) AS COUNT_SUBJECT_NO,e.SUBJECT_NO,s.SORT_NAME \
								FROM e_exam e JOIN f_goods g ON g.PRODUCT_ID=e.EXAM_ID AND g.PRODUCT_TYPE=5 JOIN w_sort s ON e.SUBJECT_NO=s.SORT_NO AND s.SOTR_RANK=2  \
								WHERE (LEFT(SUBJECT_NO,3)=:SUBJECT_NO OR SUBJECT_NO=:SUBJECT_NO) AND (:EXAM_AREA2 OR e.EXAM_AREA=:EXAM_AREA) AND (:EXAM_TYPE2 OR e.EXAM_TYPE=:EXAM_TYPE) \
								GROUP BY e.SUBJECT_NO
								
examsystem.before.get.examInfo=SELECT GOODS_ID,EXAM_ID,EXAM_NAME,M_TOPIC_NUM,B_TOPIC_NUM,TOTAL,PASS_SCORE,COST_TIME \
								FROM e_exam e JOIN f_goods g ON g.PRODUCT_ID=e.EXAM_ID JOIN s_code c ON e.EXAM_TYPE=c.CODE AND CODE_CATE='EXAMTYPE' AND g.PRODUCT_TYPE=5 \
								WHERE (LEFT(SUBJECT_NO,3)=:SUBJECT_NO OR SUBJECT_NO=:SUBJECT_NO) AND (:EXAM_AREA2 OR e.EXAM_AREA=:EXAM_AREA) AND (:EXAM_TYPE2 OR e.EXAM_TYPE=:EXAM_TYPE)
								
examsystem.before.get.answer.examId=SELECT eq.QUES_ID,OPT_ID,O_SCORE,OPT_REFER,OPTION_NUM,QUES_TYPE FROM e_exam_question eq JOIN e_option o ON eq.QUES_ID=o.QUES_ID JOIN e_question q ON eq.QUES_ID=q.QUES_ID WHERE EXAM_ID=:EXAM_ID

examsystem.before.get.examinfo.enddate = SELECT ee.EXAM_ID, ee.M_TOPIC_NUM, ee.CAREAOR, ee.B_TOPIC_NUM, ee.EXAM_NAME, ee. YEAR, ee.SEMESTER, ee.CAREAOR, ee.EXAM_AREA, ee.COST_TIME, ee.PASS_SCORE,\
										 ee.TOTAL, ee.SUBJECT_NO, ee.RELEASE_STATUS, ea.DATE, ea.ENDDATE \
								 		 FROM e_exam AS ee, e_arrange AS ea \
								 		 WHERE ee.EXAM_ID = :EXAM_ID AND ea.CLASS_ID = :CLASS_ID AND ea.TEST_ID = :TEST_ID AND ea.SUBJECT_ID = :SUBJECT_ID

examsystem.after.delete.question.quesid=DELETE FROM e_question WHERE QUES_ID=:QUES_ID

examsystem.after.delete.option.quesid=DELETE FROM e_option WHERE QUES_ID=:QUES_ID

examsystem.before.save.etestrecord=INSERT INTO e_test_record (TEST_REC_ID,TEST_ID,USER_ID,EXAM_ID,EXAM_STATUS,COMMIT_FLAG,EXAM_TIME,SCORE,REMARK,EXAM_USE_TIME) \
									VALUES (:TEST_REC_ID,:TEST_ID,:USER_ID,:EXAM_ID,:EXAM_STATUS,:COMMIT_FLAG,:EXAM_TIME,:SCORE,:REMARK,:EXAM_USE_TIME)

examsystem.before.save.etestrecorddetail=INSERT INTO e_test_record_detail (TEST_REC_ID,QUES_ID,ANSWER,SCORE,ENTER_TIME,LEFT_TIME,ANSWER_TIME,ANSWER_LOG,REMARK,STUDENT_ANSWER) \
											VALUES	(:TEST_REC_ID,:QUES_ID,:ANSWER,:SCORE,:ENTER_TIME,:LEFT_TIME,:ANSWER_TIME,:ANSWER_LOG,:REMARK,:STUDENT_ANSWER)
							
examsystem.before.delete.etestrecorddetail.quesId=DELETE FROM e_test_record_detail WHERE QUES_ID=:QUES_ID

examsystem.before.update.etestrecord=UPDATE e_test_record SET COMMIT_FLAG=:COMMIT_FLAG,EXAM_USE_TIME=:EXAM_USE_TIME,SCORE=:SCORE,FINISHED_NUM=:FINISHED_NUM WHERE TEST_REC_ID = :TEST_REC_ID

examsystem.before.get.testrecordcount = SELECT TEST_REC_ID,EXAM_USE_TIME,FINISHED_NUM FROM e_test_record WHERE TEST_REC_ID = :TEST_REC_ID

examsystem.before.get.etestdetailinfo.examid=SELECT QUES_ID,ANSWER,td.REMARK,EXAM_USE_TIME FROM e_test_record tr JOIN e_test_record_detail td ON tr.TEST_REC_ID=td.TEST_REC_ID WHERE td.TEST_REC_ID=:TEST_REC_ID 

examsystem.before.update.exam.releasestatus = UPDATE e_exam SET RELEASE_STATUS=1, RELEASE_TIME = CURRENT_TIMESTAMP() WHERE EXAM_ID=:EXAM_ID

examsystem.before.arrangetest.testisarranged = SELECT EXAM_ID, IF ( et.test_endTime < CURRENT_TIMESTAMP, 1, 2 ) TEST_ARRANGE_FLAG FROM e_test_exam ete JOIN e_test et ON et.test_id = ete.TEST_ID WHERE EXAM_ID = :EXAM_ID

examsystem.after.update.examnum = UPDATE e_exam SET B_TOPIC_NUM=B_TOPIC_NUM+:B_TOPIC_NUM,M_TOPIC_NUM=M_TOPIC_NUM+:M_TOPIC_NUM WHERE EXAM_ID=:EXAM_ID

examsystem.before.gettypesandquestions.testrecid= SELECT eqt.TYPE_ID, eqt.TYPE_NAME, eeq.QUES_ID, eeq.M_TOPIC, \
													IF ( ISNULL(etrd.STUDENT_ANSWER) = 1, 4, \
																IF ( eq.QUES_TYPE <> 4, 2, \
																	IF ((( length(etrd.STUDENT_ANSWER) - length( REPLACE ( etrd.STUDENT_ANSWER, '@@', '' ))) / 2 + 1 < eq.OPTION_NUM ) = 1, 4, 2 ))) QUES_FLAG \
													FROM e_test_record etr \
													JOIN e_exam_question eeq ON etr.EXAM_ID = eeq.EXAM_ID \
													JOIN e_ques_type eqt ON eeq.TYPE_ID = eqt.TYPE_ID \
													JOIN e_question eq ON eeq.QUES_ID = eq.QUES_ID AND eq.QUES_TYPE<>6 \
													LEFT JOIN e_test_record_detail etrd ON etr.TEST_REC_ID = etrd.TEST_REC_ID AND eeq.QUES_ID = etrd.QUES_ID \
													WHERE etr.TEST_REC_ID = :TEST_REC_ID ORDER BY eeq.M_TOPIC
								
examsystem.before.get.automarkflag.testrecid = SELECT ete.AUTOMARK_FLAG FROM e_test_record etr, e_test_exam ete WHERE etr.TEST_REC_ID = :TEST_REC_ID AND ete.TEST_ID = etr.TEST_ID AND ete.SUBJECT_ID = etr.SUBJECT_ID

examsystem.before.get.studentscore.testrecid = SELECT etr.TEST_REC_ID, etr.EXAM_ID, etr.SCORE, ( ea.ENDDATE <= CURRENT_TIMESTAMP()) END_FLAG FROM e_test_record etr, e_arrange ea WHERE etr.TEST_REC_ID = :TEST_REC_ID AND ea.TEST_ID = etr.TEST_ID AND ea.SUBJECT_ID = etr.SUBJECT_ID
													
examsystem.before.getknowledgepoints.parentid = SELECT ek.KP_ID, ek.KP_NAME FROM e_knowledge ek WHERE ek.P_KP_ID = :P_KP_ID

examsystem.before.get.knowledgepoints.by.subjectid = SELECT KP_ID, KP_NAME FROM e_knowledge WHERE SUBJECT_ID = :SUBJECT_ID AND P_KP_ID = 0

examsystem.after.get.allknowledgepoints.examid = SELECT ek.KP_ID, ek.KP_NAME, ek.P_KP_ID FROM e_exam ee, e_knowledge ek WHERE ee.EXAM_ID = :EXAM_ID AND ek.SUBJECT_ID = ee.SUBJECT_NO

examsystem.after.update.ques.kp.by.artid.kp = UPDATE e_question SET KNOWLEDGE_POINT = :KNOWLEDGE_POINT WHERE QUES_TYPE <> 6 AND REMARK = :QUES_ID

examsystem.after.update.release.status.of.questions= UPDATE e_question eq SET eq.RELEASE_FLAG = :RELEASE_FLAG WHERE EXISTS (SELECT 1 FROM e_exam_question eeq WHERE eeq.EXAM_ID = :EXAM_ID AND eeq.QUES_ID = eq.QUES_ID) AND eq.RELEASE_FLAG = 0

examsystem.after.get.question.by.quesid= SELECT QUES_ID, SUBJECT_NO, QUES_TYPE, QUES_CONTENT, QUES_REFER, CREATOR, DIFFICULTY, REMARK, RESOURCE, SHARE_FLAG, RELEASE_FLAG, KNOWLEDGE_POINT, KEYWORD, OPTION_NUM, REL_FLAG, INPUT_TIME, GRADE_LEVEL FROM e_question WHERE QUES_ID = :QUES_ID

examsystem.after.update.ques.score.oscore= UPDATE e_exam_question  SET SCORE = :SCORE, O_SCORE = :O_SCORE WHERE EXAM_ID = :EXAM_ID AND QUES_ID = :QUES_ID

examsystem.after.update.mtopics.after.deleteques= UPDATE e_exam_question SET M_TOPIC = M_TOPIC - 1 WHERE EXAM_ID = :EXAM_ID AND M_TOPIC > :M_TOPIC

examsystem.after.delete.questions= DELETE FROM e_question WHERE QUES_ID IN (:QUES_IDS)

examsystem.after.save.ques.kps.relation= INSERT INTO e_ques_kp(QUES_ID, KP_ID) VALUES(:QUES_ID, :KP_ID)
##################################################
#
#创建试卷
#
##################################################
network.createexam.get.allgrades = SELECT `CODE`, `NAME`, REMARK FROM s_code WHERE CODE_CATE = 'GRADELEVEL' ORDER BY REMARK, `CODE`

network.createexam.get.grade= SELECT sc.`CODE`, sc.`NAME`, sc.REMARK FROM c_teacher ct, c_grade cg, s_code sc WHERE ct.USER_ID = :USER_ID AND EXISTS ( \
							SELECT 1 FROM c_lesson cl, c_lesson_class clc, c_class cc WHERE cl.SUBJECT_ID = :SUBJECT_ID AND cl.TEACHER_ID = ct.TEACHER_ID \
							AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND clc.EXIST_FLAG = 1 AND clc.CLASS_ID = cc.CLASS_ID AND cc.GRADE_ID = cg.GRADE_ID \
							) AND sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = cg.GRADE_LEVEL
													

##################################################
#
#EXAM EXTENDS
#
##################################################
esextends.examorder.get.quentity=SELECT SUBJECT_NO,SORT_NAME,COUNT(SUBJECT_NO) AS COUNT_SUB,SORT_NO, \
								(SELECT SORT_NAME FROM w_sort WHERE LEFT(r.SORT_NO,3)=SORT_NO) AS PARENT_SORT_NAME \
								FROM f_subscribe s JOIN e_exam e ON s.TEACHER_ID=e.CAREAOR JOIN w_sort r ON SUBJECT_NO=SORT_ID WHERE USER_ID=:USER_ID \
								GROUP BY SORT_NO
								
esextends.teacherorder.get.quentity=SELECT CAREAOR,SORT_NAME,COUNT(DISTINCT CAREAOR) AS COUNT_NUM,SUBJECT_NO FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR JOIN w_sort w ON e.SUBJECT_NO=w.SORT_ID \
									WHERE s.USER_ID=:USER_ID AND NOW()<=date_add(SUB_TIME, interval SUB_LENGTH month) AND t.AUTHEN_STATUS=1 \
									GROUP BY SORT_NO
									
esextends.teacher.get.orderby=SELECT TEACHER_NAME,PHOTO,SCHOOL_NAME,SORT_NAME,COUNT(SUBJECT_NO) AS COUNT_SUB,su.USER_ID,t.TEACHER_ID,  \
							 (SELECT SORT_NAME FROM w_sort WHERE LEFT(w.SORT_NO,3)=SORT_NO) AS PARENT_SORT_NAME \
							 FROM c_teacher t JOIN c_school s ON t.SCHOOL_ID=s.SCHOOL_ID JOIN e_exam e ON e.CAREAOR=t.USER_ID JOIN w_sort w ON w.SORT_ID=e.SUBJECT_NO JOIN s_user su ON su.USER_ID=t.USER_ID WHERE t.USER_ID!=:USER_ID AND t.AUTHEN_STATUS=1 \
							 GROUP BY su.USER_ID,SORT_NO ORDER BY RELEASE_TIME DESC
							
esextends.exam.releaseorder.quentity=SELECT COUNT(EXAM_ID) AS COUNT_EXAM,RELEASE_STATUS FROM e_exam WHERE CAREAOR=:USER_ID GROUP BY RELEASE_STATUS

esextends.get.commit.quentity=SELECT COUNT(DISTINCT e.EXAM_ID) AS COUNT_EXAM FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR LEFT JOIN e_test_record tr ON e.EXAM_ID=tr.EXAM_ID \
							  WHERE s.USER_ID=:USER_ID AND COMMIT_FLAG=1 AND t.AUTHEN_STATUS=1	
							  
esextends.get.examinfo.now=SELECT  DISTINCT e.EXAM_ID,e.EXAM_NAME,e.B_TOPIC_NUM,e.M_TOPIC_NUM,COST_TIME,TOTAL,COMMIT_FLAG,SUBJECT_NO, \
							COALESCE(AVG(SCORE),0) AS AVG_SCORE,COALESCE(MAX(SCORE),0) AS MAX_SCORE,COALESCE(COUNT(tr.TEST_REC_ID),0) AS COUNT_TEST,COALESCE(COUNT(a.EXAM_ID),0) AS COUNT_ASSESS \
							FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR LEFT JOIN e_test_record tr ON e.EXAM_ID=tr.EXAM_ID LEFT JOIN e_assess a ON a.EXAM_ID=e.EXAM_ID \
							WHERE s.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1 AND (:SUBJECT_NO=-1 OR SUBJECT_NO=:SUBJECT_NO) AND ( :COMMIT_FLAG=-1 OR 	

esextends.get.testrecord.now=SELECT  e.EXAM_ID,COMMIT_FLAG,TEST_REC_ID,COALESCE(SCORE,0) AS SCORE,COALESCE(EXAM_USE_TIME,'00:00:00') AS EXAM_USE_TIME,COALESCE(tr.REMARK,0) AS COUNT_TEST \
							 FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR LEFT JOIN e_test_record tr ON e.EXAM_ID=tr.EXAM_ID \
							 WHERE s.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1 \
							 ORDER BY EXAM_TIME ASC
								
esextends.get.teacher.islose=SELECT COUNT(DISTINCT CAREAOR) AS COUNT_LOSE,IS_LOSE FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR JOIN w_sort w ON e.SUBJECT_NO=w.SORT_ID \
							 WHERE s.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1 \
							 GROUP BY IS_LOSE

esextends.get.teacher.info=SELECT DISTINCT TEACHER_NAME,COUNT(EXAM_ID) AS COUNT_EXAM,SCHOOL_NAME,t.TEACHER_ID,GOODS_ID,PHOTO,TEACH FROM f_subscribe s JOIN c_teacher t ON s.TEACHER_ID=t.TEACHER_ID JOIN e_exam e ON t.USER_ID=e.CAREAOR JOIN w_sort w ON e.SUBJECT_NO=w.SORT_ID JOIN c_school sc ON t.SCHOOL_ID=sc.SCHOOL_ID \
						   JOIN f_goods ON PRODUCT_ID=t.TEACHER_ID AND PRODUCT_TYPE=7 JOIN s_user us ON t.USER_ID=us.USER_ID \
						   WHERE s.USER_ID=:USER_ID AND (:IS_LOSE=-1 OR IS_LOSE=:IS_LOSE) AND (:SUBJECT_NO=-1 OR SUBJECT_NO=:SUBJECT_NO) AND t.AUTHEN_STATUS=1 \
						   GROUP BY CAREAOR		
						   
esextends.get.teacher.info.one=SELECT DISTINCT TEACHER_NAME,COUNT(EXAM_ID) AS COUNT_EXAM,SCHOOL_NAME,t.TEACHER_ID,GOODS_ID,PHOTO,TEACH \
								FROM c_teacher t JOIN e_exam e ON t.USER_ID=e.CAREAOR JOIN w_sort w ON e.SUBJECT_NO=w.SORT_ID JOIN c_school sc ON t.SCHOOL_ID=sc.SCHOOL_ID JOIN f_goods ON PRODUCT_ID=t.TEACHER_ID AND PRODUCT_TYPE=7 JOIN s_user us ON t.USER_ID=us.USER_ID \
								WHERE t.TEACHER_ID=:TEACHER_ID AND t.AUTHEN_STATUS=1 \
								GROUP BY CAREAOR
							
esextends.save.assess.goods=INSERT INTO g_assess (GOODS_ID,USER_NO,ASS_TIME,ASS_TYPE,ASS_CONTENT,REMARK) \
						 VALUES(:GOODS_ID,:USER_NO,:ASS_TIME,:ASS_TYPE,:ASS_CONTENT,:REMARK)

esextends.get.teacher.assess=SELECT ASS_ID,ASS_TIME,u.USER_NO,PHOTO,ASS_TYPE,ASS_CONTENT \
						    FROM g_assess a JOIN s_user u ON a.USER_NO=u.USER_ID JOIN c_teacher t ON t.USER_ID=u.USER_ID \
							WHERE GOODS_ID=:GOODS_ID AND (:ASS_TYPE=-1 OR ASS_TYPE=:ASS_TYPE) AND t.AUTHEN_STATUS=1 \
							GROUP BY a.ASS_TIME DESC

esextends.get.assess.quentity=SELECT COUNT(ASS_ID) AS COUNT_TYPE,ASS_TYPE FROM g_assess WHERE GOODS_ID=:GOODS_ID GROUP BY ASS_TYPE

esextends.get.release.exam=SELECT e.EXAM_ID,M_TOPIC_NUM,EXAM_NAME,COST_TIME,TOTAL,COUNT(TEST_REC_ID) AS COUNT_REC,COUNT(ASS_ID) AS COUNT_ASS,RELEASE_STATUS \
						   FROM e_exam e LEFT JOIN e_test_record tr ON e.EXAM_ID=tr.EXAM_ID LEFT JOIN e_assess a ON e.EXAM_ID=a.EXAM_ID \
					       WHERE CAREAOR=:CAREAOR AND (:RELEASE_STATUS=-1 OR RELEASE_STATUS=:RELEASE_STATUS) \
						   GROUP BY e.EXAM_ID		
						 
esextends.get.exam.subjectNo.quen=SELECT SORT_NAME,COUNT(SUBJECT_NO) AS COUNT_SUB,SORT_ID \
								FROM f_goods g JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID  LEFT JOIN e_exam e ON e.CAREAOR=t.USER_ID JOIN w_sort s ON e.SUBJECT_NO=s.SORT_ID \
								WHERE SORT_PARENT_ID=:SORT_PARENT_ID  AND t.TEACHER_ID NOT IN (SELECT TEACHER_ID FROM f_subscribe WHERE USER_ID=:USER_ID) AND CAREAOR!=:USER_ID AND t.AUTHEN_STATUS=1 \
								GROUP BY e.SUBJECT_NO
								
esextends.get.exam.examarea.quen=SELECT c.NAME,EXAM_AREA,COUNT(EXAM_AREA) AS COUNT_AREA \
								FROM f_goods g JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID  LEFT JOIN e_exam e ON e.CAREAOR=t.USER_ID JOIN w_sort s ON e.SUBJECT_NO=s.SORT_ID JOIN s_code c ON e.EXAM_AREA=c.CODE AND CODE_CATE='AREA' \
								WHERE SORT_PARENT_ID=:SORT_PARENT_ID AND t.AUTHEN_STATUS=1 AND t.TEACHER_ID NOT IN (SELECT TEACHER_ID FROM f_subscribe WHERE USER_ID=:USER_ID) AND CAREAOR!=:USER_ID \
								GROUP BY EXAM_AREA
								
esextends.get.teacher.pinfo=SELECT TEACHER_NAME,SCHOOL_NAME,TEACH,GOODS_DETAIL,t.USER_ID,GOODS_ID,t.TEACHER_ID,PHOTO, \
						  (SELECT COUNT(ASS_ID) FROM g_assess WHERE GOODS_ID=g.GOODS_ID) AS COUNT_ASS \
						  FROM  c_teacher t JOIN c_school h ON t.SCHOOL_ID=h.SCHOOL_ID JOIN f_goods g ON t.TEACHER_ID=g.PRODUCT_ID AND g.PRODUCT_TYPE=7 JOIN s_user us ON t.USER_ID=us.USER_ID \
						  WHERE t.TEACHER_ID=:TEACHER_ID AND t.AUTHEN_STATUS=1
													  
esextends.get.teacher.teach=SELECT SORT_NAME FROM w_sort WHERE SORT_ID IN 
								
esextends.get.order.teacher.all=SELECT g.GOODS_ID,t.TEACHER_ID,SCHOOL_NAME,TEACH,PHOTO,COUNT(a.GOODS_ID) AS COUNT_ASS,MIN(UNIT_PRICE) AS MIN_PRICE,COUNT(DISTINCT e.EXAM_ID) AS COUNT_EXAM,t.USER_ID,COUNT(DISTINCT s.TEACHER_ID) AS COUNT_ORDER,	TEACHER_NAME \
							  FROM f_goods g JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID JOIN c_school h ON t.SCHOOL_ID=h.SCHOOL_ID \
							  JOIN s_user u ON t.USER_ID=u.USER_ID LEFT JOIN e_exam e ON e.CAREAOR=t.USER_ID \
							  LEFT JOIN g_assess a ON g.GOODS_ID=a.GOODS_ID JOIN f_good_model gm ON g.GOODS_ID=gm.GOODS_ID LEFT JOIN f_subscribe s ON t.TEACHER_ID=s.TEACHER_ID \
							  JOIN w_sort rt ON rt.SORT_ID=e.SUBJECT_NO \
							  WHERE PRODUCT_TYPE=7 AND t.AUTHEN_STATUS=1 AND RELEASE_STATUS=1 AND t.USER_ID!=:USER_ID AND t.TEACHER_ID NOT IN (SELECT TEACHER_ID FROM f_subscribe WHERE USER_ID=:USER_ID) AND FOR_SALE=1 \
							  AND (:SUBJECT_NO=-1 OR e.SUBJECT_NO=:SUBJECT_NO ) AND (:EXAM_AREA=-1 OR e.EXAM_AREA=:EXAM_AREA) AND SORT_PARENT_ID=:SORT_PARENT_ID \
							  GROUP BY g.GOODS_ID \
						   
esextends.get.trade.teacher=SELECT MONEY,TRADE_TIME,USER_NO,MODEL_NAME \
						  FROM f_trade t JOIN f_goods g ON t.GOODS_ID=g.GOODS_ID JOIN s_user u ON t.USER_ID=u.USER_ID \
						  JOIN f_good_model m ON t.MODEL_ID=m.MODEL_ID \
						  WHERE g.PRODUCT_ID=:PRODUCT_ID AND g.PRODUCT_TYPE='7' AND t.TRADE_STATUS=2 \
						  
esextends.get.release.teacher=SELECT e.EXAM_ID, EXAM_NAME,COUNT(ASS_ID) AS COUNT_ASS,RELEASE_TIME \
							FROM e_exam e LEFT JOIN e_assess a ON e.EXAM_ID=a.EXAM_ID JOIN c_teacher t ON t.USER_ID=CAREAOR \
							WHERE TEACHER_ID=:TEACHER_ID AND RELEASE_STATUS=1 AND t.AUTHEN_STATUS=1 \
							GROUP BY e.EXAM_ID
							
esextends.get.exam.model=SELECT MODEL_ID,MODEL_NAME,UNIT_PRICE FROM f_goods g JOIN f_good_model m ON g.GOODS_ID=m.GOODS_ID WHERE g.PRODUCT_ID=:PRODUCT_ID AND g.PRODUCT_TYPE=7

esextends.save.trade.no=INSERT INTO f_trade (TRADE_ID,USER_ID,TRADE_TYPE,TRADE_VARIETY,GOODS_ID,MODEL_ID,TRADE_STATUS,TRADE_TIME,REMARK,MONEY,TRADE_NAME) \
					  VALUES(:TRADE_ID,:USER_ID,:TRADE_TYPE,:TRADE_VARIETY,:GOODS_ID,:MODEL_ID,:TRADE_STATUS,:TRADE_TIME,:REMARK,:MONEY,:TRADE_NAME)
					  
esextends.get.ugid.tradeid=SELECT r.USER_ID,g.GOODS_ID,r.TEACHER_ID,MODEL_NAME FROM f_trade t JOIN f_goods g ON t.GOODS_ID=g.GOODS_ID \
						JOIN c_teacher r ON r.TEACHER_ID=g.PRODUCT_ID AND PRODUCT_TYPE=7 JOIN f_good_model gm ON t.MODEL_ID=gm.MODEL_ID \
						WHERE t.TRADE_ID=:TRADE_ID AND r.AUTHEN_STATUS=1
		
esextends.update.faccount.userid=UPDATE f_account SET CASH=CASH+:CASH WHERE USER_ID=:USER_ID

esextends.update.trade.tradeid=UPDATE f_trade SET TRADE_STATUS=:TRADE_STATUS,TRADE_TIME=:TRADE_TIME,MONEY=:MONEY,SNAP_ID=:SNAP_ID,REMARK=:REMARK WHERE TRADE_ID=:TRADE_ID

esextends.get.cash.userid=SELECT CASH  FROM f_account WHERE USER_ID=:USER_ID

esextends.get.coupon.userid=SELECT SUM(LEFT_MONEY) AS COUNT_COUPON FROM f_coupon WHERE END_DAY>=NOW() AND USER_ID=:USER_ID

esextends.save.tradelog=INSERT INTO f_trade_log (TRADE_LOG_ID,TRADE_ID,USER_ID,TRADE_TYPE,TRADE_TIME,CASH,COUPON,CASH_BEFORE,CASH_AFTER,COUPON_BEFORE,COUPON_AFTER,REMARK) \
					  VALUES(:TRADE_LOG_ID,:TRADE_ID,:USER_ID,:TRADE_TYPE,:TRADE_TIME,:CASH,COUPON,:CASH_BEFORE,:CASH_AFTER,:COUPON_BEFORE,:COUPON_AFTER,:REMARK)
					  
esextends.get.subscribe.tuid=SELECT SUB_ID,SUB_LENGTH,IS_LOSE,SUB_TIME FROM f_subscribe WHERE TEACHER_ID=:TEACHER_ID AND USER_ID=:USER_ID

esextends.update.subscribe.tuid=UPDATE f_subscribe SET SUB_TIME=:SUB_TIME,SUB_LENGTH=:SUB_LENGTH,IS_LOSE=:IS_LOSE WHERE TEACHER_ID=:TEACHER_ID AND USER_ID=:USER_ID

esextends.save.subscribe=INSERT INTO f_subscribe (USER_ID,TEACHER_ID,SUB_TIME,SUB_LENGTH,IS_LOSE,REMARK) \
						VALUES (:USER_ID,:TEACHER_ID,:SUB_TIME,:SUB_LENGTH,:IS_LOSE,:REMARK)
						
		
esextends.update.forsale.teacher=UPDATE f_goods g JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID AND g.PRODUCT_TYPE=7 SET FOR_SALE=:FOR_SALE WHERE t.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1

esextends.get.cfinfor.teacher=SELECT COUNT(EXAM_ID) AS COUNT_REL,FOR_SALE FROM e_exam e JOIN c_teacher t ON e.CAREAOR=t.USER_ID LEFT JOIN f_goods g ON g.PRODUCT_ID=t.TEACHER_ID AND g.PRODUCT_TYPE=7 WHERE CAREAOR=:USER_ID AND RELEASE_STATUS=1 AND t.AUTHEN_STATUS=1

esextends.save.goodmodel.tacher=INSERT INTO f_good_model (GOODS_ID,MODEL_NAME,UNIT_PRICE,STOCK,REMARK) VALUES(:GOODS_ID,:MODEL_NAME,:UNIT_PRICE,:STOCK,:REMARK)

esextends.get.gooodsId.now=SELECT GOODS_ID,TEACHER_NAME,TEACHER_ID FROM f_goods g RIGHT JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID AND PRODUCT_TYPE=7 WHERE t.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1

esextends.get.goodmodel.now=SELECT MODEL_ID,g.GOODS_ID,STOCK,MODEL_NAME,UNIT_PRICE FROM f_goods g JOIN c_teacher t ON g.PRODUCT_ID=t.TEACHER_ID AND PRODUCT_TYPE=7 JOIN f_good_model m ON g.GOODS_ID=m.GOODS_ID WHERE t.USER_ID=:USER_ID AND t.AUTHEN_STATUS=1

esextends.update.goodmodel.now=UPDATE f_good_model SET UNIT_PRICE=:UNIT_PRICE WHERE MODEL_ID=:MODEL_ID	

esextends.delete.goodmodel.now=DELETE FROM f_good_model WHERE MODEL_ID=:MODEL_ID	

esextends.save.goods.userid=INSERT INTO f_goods (GOODS_ID,USER_ID,GOODS_DETAIL,START_TIME,END_TIME,PRODUCT_TYPE,PRODUCT_ID,PAY_TYPE,FOR_SALE,REMARK) \
						  VALUES  (:GOODS_ID,:USER_ID,:GOODS_DETAIL,:START_TIME,:END_TIME,:PRODUCT_TYPE,:PRODUCT_ID,:PAY_TYPE,:FOR_SALE,:REMARK)
						  
esextends.delete.exam.userid=DELETE FROM e_exam WHERE CAREAOR=:USER_ID AND EXAM_ID=:EXAM_ID
##################################################

#
#TEACHER AUTHEN
#
##################################################
authen.save.teacher=INSERT INTO c_teacher (TEACHER_NAME,SCHOOL_ID,BIRTH_DATE,IDENTITYID,GENDER,TEACHER_LEVEL,CONTACT_PHONE,ADDRESS,EDUCATION,MARRIAGE,POLI_LAND,TEACH,LICENSE,REMARK,USER_ID,TEACHER_INTRO,AUTHEN_STATUS,AUTHEN_TIME) \
					VALUES (:TEACHER_NAME,:SCHOOL_ID,:BIRTH_DATE,:IDENTITYID,:GENDER,:TEACHER_LEVEL,:CONTACT_PHONE,:ADDRESS,:EDUCATION,:MARRIAGE,:POLI_LAND,:TEACH,:LICENSE,:REMARK,:USER_ID,:TEACHER_INTRO,:AUTHEN_STATUS,:AUTHEN_TIME)

authen.update.teacher=UPDATE c_teacher SET AUTHEN_STATUS=:AUTHEN_STATUS WHERE TEACHER_ID=:TEACHER_ID

authen.delete.teacher=DELETE FROM c_teacher WHERE USER_ID=:USER_ID

authen.save.school=INSERT INTO c_school (SCHOOL_NAME,ORG_NO,RESP_DIST,SCHOOL_LEVEL,SCHOOL_TYPE,ADDRESS,CONTACT_PHONE,CONTACTOR,SCHOOLMASTER,REMARK) \
					VALUES (:SCHOOL_NAME,:ORG_NO,:RESP_DIST,:SCHOOL_LEVEL,:SCHOOL_TYPE,:ADDRESS,:CONTACT_PHONE,:CONTACTOR,:SCHOOLMASTER,:REMARK)
					
authen.update.photo.userId=UPDATE s_user SET PHOTO=:PHOTO WHERE USER_ID=:USER_ID

authen.get.authenstatus.userid=SELECT AUTHEN_STATUS FROM c_teacher WHERE USER_ID=:USER_ID GROUP BY AUTHEN_TIME DESC LIMIT 1
authen.get.authenInfo.bystatus=SELECT t.TEACHER_ID, t.TEACHER_NAME, u.user_no, t.AUTHEN_TIME , t.AUTHEN_STATUS FROM c_teacher AS t, s_user AS u WHERE t.USER_ID = u.user_id AND (t.AUTHEN_STATUS =:STATUS OR -1=:STATUS) ORDER BY t.AUTHEN_TIME DESC
##################################################
#
#ARTICLE
#
##################################################
article.query.key=  SELECT CONCAT(IFNULL(b.LAST_NAME, ''), ' ', IFNULL(b.FIRST_NAME, '')) AUTHOR, \
						b.AUTHOR_ID, a.ARTICLE_ID, a.ARTICLE_NAME, a.PUBLICATION_DATE, CONTENT \
						FROM @@TABLE_NAME, AS a \
						INNER JOIN l_author AS b ON a.AUTHOR_ID = b.AUTHOR_ID \
						JOIN (SELECT ARTICLE_ID FROM @@TABLE_NAME, \
						      WHERE (ARTICLE_NAME = :ARTICLE_NAME OR :ARTICLE_NAME = '-1' ) \
						      AND ( PUBLICATION_DATE > :STARTDATE OR :STARTDATE = '-1' ) \
						      AND ( PUBLICATION_DATE < :ENDDATE OR :ENDDATE = '-1' ) \
						      AND (AUTHOR_ID IN(@@AUTHORS,) OR '@@AUTHORS,' = '-1') \
						      ORDER BY RAND() LIMIT :SEARCHLIMIT ) c ON a.ARTICLE_ID = c.article_id \
						WHERE a.CONTENT REGEXP :KEY
article.query.author = SELECT l.ARTICLE_ID,l.ARTICLE_NAME,l.PUBLICATION_DATE, l.PUBLISHER \
  						FROM l_article l \
					   WHERE l.AUTHOR_ID = :AUTHOR_ID
#\u8BED\u6599\u5E74\u4EE3\u5206\u5E03
article.query.distribute = SELECT '\u4E0A\u53E4\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 1)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE \
			UNION ALL \
			SELECT '\u53E4\u5178\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 2)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE \
			UNION ALL \
			SELECT '\u4E2D\u53E4\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 3)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE \
			UNION ALL \
			SELECT '\u8FD1\u4EE3\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 4)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE \
			UNION ALL \
			SELECT '\u662D\u548C\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 5)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE \
			UNION ALL \
			SELECT '\u8FD1\u73B0\u4EE3\u6587\u5B66' NAME,COUNT(1) COUNT \
			  FROM l_article A, (SELECT LEFT(REMARK,8) LDATE, RIGHT(REMARK,8) RDATE,NAME FROM S_CODE WHERE CODE_CATE = 'PERIOD_JP' AND CODE = 6)B \
			 WHERE A.PUBLICATION_DATE BETWEEN B.LDATE AND B.RDATE 

##################################################
#
#KEYWORD
#
##################################################
keyword.query.keyname = SELECT k.KEYWORD_ID, k.KEYWORD_NAME, k.`LANGUAGE`, k.BUFFER_FILE, k.STATUS_FLAG, K.REP_TYPE FROM l_keyword AS k WHERE k.KEYWORD_NAME = :NAME AND k.LANGUAGE = :LANGUAGE AND REP_TYPE=:REP_TYPE
keyword.insert = INSERT into l_keyword(KEYWORD_NAME,BUFFER_FILE,`LANGUAGE`,STATUS_FLAG, REP_TYPE) VALUES (:KEYWORD_NAME,:BUFFER_FILE,:LANGUAGE,:STATUS_FLAG, :REP_TYPE)
keyword.query.all = SELECT k.KEYWORD_ID, k.KEYWORD_NAME, k.`LANGUAGE`, k.BUFFER_FILE, k.STATUS_FLAG, K.REP_TYPE FROM l_keyword AS k WHERE k.STATUS_FLAG = 10
keyword.update = update l_keyword k set k.KEYWORD_NAME = :KEYWORD_NAME, k.`LANGUAGE` = :LANGUAGE, k.BUFFER_FILE = :BUFFER_FILE, k.STATUS_FLAG=:STATUS_FLAG, REP_TYPE=:REP_TYPE where k.KEYWORD_ID = :KEYWORD_ID

##################################################
#
#AUTHOR
#
##################################################
author.get.all = SELECT l.AUTHOR_ID, substr(l.LAST_NAME_OR, 1, 1) NAME_CODE, l.LAST_NAME, l.FIRST_NAME, \
                      l.LAST_NAME_EN, l.LAST_NAME_OR, l.FIRST_NAME_OR, l.FIRST_NAME_EN FROM l_author AS l \
                 ORDER BY l.LAST_NAME_OR, l.FIRST_NAME_OR
author.get.report = SELECT DISTINCT l.AUTHOR_ID, substr(l.LAST_NAME_OR, 1, 1) NAME_CODE, l.LAST_NAME, l.FIRST_NAME, \
                      l.LAST_NAME_EN, l.LAST_NAME_OR, l.FIRST_NAME_OR, l.FIRST_NAME_EN FROM l_author AS l, \
                      @@REPORT_NAME, b WHERE L.AUTHOR_ID = B.AUTHOR_ID \
                 ORDER BY l.LAST_NAME_OR, l.FIRST_NAME_OR
author.get.all.articlenum = SELECT l.AUTHOR_ID, substr(l.LAST_NAME_OR, 1, 1) NAME_CODE, l.LAST_NAME, l.FIRST_NAME, \
				l.LAST_NAME_EN, l.LAST_NAME_OR, l.FIRST_NAME_OR, l.FIRST_NAME_EN, b.ARTICLE_NUM FROM l_author AS l, \
				( SELECT a.author_id, count(article_id) article_num FROM l_article a GROUP BY a.AUTHOR_ID ) b  \
				WHERE l.AUTHOR_ID = b.author_id ORDER BY b.article_num DESC
author.get.namecode=SELECT s.`CODE`, s.`NAME`, s.REMARK FROM s_code AS s WHERE s.CODE_CATE = 'KANA'
author.query.article.top=SELECT CONCAT(au.LAST_NAME,' ',au.FIRST_NAME) AS NAME,COUNT(ar.AUTHOR_ID) AS COUNT \
			FROM l_article ar JOIN l_author au ON ar.AUTHOR_ID = au.AUTHOR_ID \
			GROUP BY ar.AUTHOR_ID \
			ORDER BY COUNT(ar.AUTHOR_ID) DESC limit 0,10
##################################################
#
#TEACHER
#
##################################################
teacher.load = SELECT t.TEACHER_ID, t.TEACHER_NAME, t.SCHOOL_ID, t.USER_ID FROM c_teacher AS t 
teacher.load.userid = ${teacher.load} WHERE t.USER_ID = :USER_ID
teacher.load.teacherid = ${teacher.load} WHERE t.TEACHER_ID = :TEACHER_ID
teacher.user.phone = SELECT u.phone, u.user_id FROM c_teacher AS t, s_user_detail AS u WHERE u.phone =:PHONE AND u.user_id = t.USER_ID AND t.AUTHEN_STATUS = 1
teacher.authen.userid = SELECT t.TEACHER_NAME, t.REMARK, t.TEACHER_INTRO, t.IDENTITYID, t.TEACH, t.LICENSE, t.AUTHEN_STATUS FROM c_teacher AS t WHERE t.USER_ID = :USER_ID
##################################################
#
#CLASS
#
##################################################
class.query.teacherid = SELECT c.CLASS_ID, c.CLASS_NAME, c.GRADE_ID, c.CLASS_TYPE, c.TEACHER_ID, c.START_TIME, c.END_TIME, c.EXIST_FLAG \
                       FROM c_class AS c WHERE c.TEACHER_ID = :TEACHER_ID AND EXIST_FLAG = 1
##################################################
#
#STUDENT
#
##################################################
student.load = SELECT s.STUDENT_ID, s.USER_ID, s.STUDENT_NAME, s.STUDENT_NO, cs.CLASS_ID, d.SEAT_NO,s.GENDER, s.GUARDIAN, s.GUARDIAN_PHONE \
                        FROM c_student AS s LEFT JOIN c_class_student AS cs ON s.STUDENT_ID = cs.STUDENT_ID \
                        LEFT JOIN c_seat AS d ON s.STUDENT_ID = d.STUDENT_ID
student.load.userid = ${student.load} WHERE s.USER_ID = :USER_ID AND cs.EXIST_FLAG = 1 AND D.EXIST_FLAG = 1
student.load.studentid = ${student.load} WHERE  s.STUDENT_ID = :STUDENT_ID AND cs.EXIST_FLAG = 1 AND D.EXIST_FLAG = 1
student.query.class = ${student.load} WHERE cs.CLASS_ID = :CLASS_ID AND cs.EXIST_FLAG = 1 AND D.EXIST_FLAG = 1
student.query.phone = ${student.load} WHERE s.GUARDIAN_PHONE = :PHONE
##################################################
#
#S_LINK
#
##################################################
link.create = INSERT INTO s_link(USER_ID, LINK_NO,CREATE_DATE,LINK_STATUS) VALUES (:USER_ID, :LINK_NO, :CREATE_DATE, :LINK_STATUS)                        
link.update = UPDATE s_link SET LINK_STATUS = :LINK_STATUS, USE_DATE = :USE_DATE WHERE LINK_NO = :LINK_NO  
link.get.linkno = SELECT LINK_ID, USER_ID, LINK_NO,CREATE_DATE,LINK_STATUS, USE_DATE from s_link where LINK_NO = :LINK_NO                    
##################################################
#
#E_ANALY_CLASS
#
##################################################
analy.class.query.base=SELECT c.CLASS_NAME, c.CLASS_TYPE, t.test_name, ac.CLASS_ID, ac.GRADE_ID, ac.SCHOOL_ID, \
ac.TEACHER_ID, ac.TEST_ID, ac.STUDENT_NUM, ac.SEX_RATIO, ac.SCORE_AVG, ac.SCORE_AVG_G, ac.SCORE_AVG_GR, ac.SCORE_MAX, \
ac.SCORE_MIN, ac.TOTAL, ac.TOP_NUM, ac.IMPROVE_NUM, ac.FALL_NUM, ac.STABLE_NUM, ac.HIGH_NUM, ac.LOW_NUM, \
ac.EXCELLENT, ac.GOOD, ac.PASS, ac.`WEEK`, ac.TERRIBLE, ac.SUBJECT_ID, w.sort_name FROM e_analy_class AS ac, c_class c, \
(SELECT t.TEST_ID, t.test_name, t.test_time FROM e_test t, c_class c WHERE t.GRADE_ID = c.GRADE_ID AND c.TEACHER_ID = :TEACHER_ID ORDER BY t.test_time LIMIT 1) t, w_sort w
analy.class.query.class=${analy.class.query.base} WHERE ac.CLASS_ID = :CLASS_ID AND c.CLASS_ID = ac.CLASS_ID  \
                                                    AND t.TEST_ID = ac.TEST_ID \
                                                    AND w.sort_id = ac.subject_id
analy.class.query.teacher=${analy.class.query.base} WHERE ac.TEACHER_ID = :TEACHER_ID \
													AND t.TEST_ID = ac.TEST_ID \
													AND c.CLASS_ID = ac.CLASS_ID \
													AND w.sort_id = ac.SUBJECT_ID
analy.class.query.teacher.class=${analy.class.query.base} WHERE ac.TEACHER_ID = :TEACHER_ID \
													AND t.TEST_ID = ac.TEST_ID \
													AND c.CLASS_ID = ac.CLASS_ID \
													AND w.sort_id = ac.SUBJECT_ID \
													AND c.CLASS_ID = :CLASS_ID									
analy.student.query.teacher=SELECT DISTINCT p.USER_ID, s.STUDENT_NAME, s.STUDENT_NO, t.test_name, p.SCORE, p.SCORE_CR, \
                            p.SCORE_GR, p.TEST_ID, p.SUBJECT_ID, w.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, t1.score_cr totalcr, t1.score_gr totalgr  \
                            FROM e_analy_person AS p, c_student AS s, e_test AS t, c_class AS c, w_sort AS w, \
                            (select user_id, score_cr, score_gr from e_analy_person ap where ap.TEST_ID = :TEST_ID and ap.CLASS_ID = :CLASS_ID and ap.SUBJECT_ID in (4,5,6)) t1 \
                            WHERE p.STUDENT_ID = s.STUDENT_ID AND p.USER_ID = t1.user_id \
                            AND p.TEST_ID = t.TEST_ID AND p.CLASS_ID = c.CLASS_ID AND c.TEACHER_ID = :TEACHER_ID \
                            AND t.TEST_ID = :TEST_ID  AND C.CLASS_ID = :CLASS_ID  AND p.SUBJECT_ID = w.SORT_ID  \
                            AND p.SUBJECT_ID IN (:SUBJECT)
analy.class.grade.test = SELECT c.CLASS_NAME, t.TEACHER_NAME, ac.SCORE_MAX, ac.SCORE_MIN, ac.SCORE_AVG, ac.HIGH_AVG, ac.HIGH_NUM, ac.LOW_AVG, ac.LOW_NUM FROM c_class AS c, c_teacher AS t, e_analy_class AS ac WHERE c.CLASS_ID = :CLASS_ID AND c.CLASS_ID = ac.CLASS_ID AND ac.TEACHER_ID = t.TEACHER_ID AND t.TEACHER_ID = :TEACHER_ID AND ac.SUBJECT_ID = :SUBJECT AND ac.TEST_ID = :TEST_ID \
						 UNION ALL \
						 SELECT '\u5168\u5E74\u7EA7' AS CLASS_NAME, '' AS TEACHER_NAME, ag.SCORE_MAX, ag.SCORE_MIN, ag.SCORE_AVG, ag.HIGH_AVG, ag.HIGH_NUM, ag.LOW_AVG, ag.LOW_NUM FROM e_analy_grade AS ag, c_class c WHERE ag.TEST_ID = :TEST_ID AND ag.SUBJECT_ID = :SUBJECT AND ag.GRADE_ID = c.GRADE_ID AND c.CLASS_ID = :CLASS_ID
############################################
#
#TEST
#
############################################
test.get.semester.teacher = SELECT DISTINCT t.`year` YEAR, t.SEMESTER, IF ( t.SEMESTER = 1, '\u7B2C\u4E00\u5B66\u671F', '\u7B2C\u4E8C\u5B66\u671F' ) SEMESTER_NAME \
             FROM e_test AS t, c_class AS c WHERE t.GRADE_ID = c.GRADE_ID AND c.TEACHER_ID = :TEACHER_ID
 
test.get.subject.teacher = SELECT DISTINCT t.TEST_ID, t.test_name, te.subject_id, w.SORT_NAME, c.CLASS_ID, c.CLASS_NAME FROM e_analy_class AS ac, e_test AS t, e_test_exam AS te, w_sort AS w, c_class AS c WHERE ac.TEST_ID = t.TEST_ID AND ac.TEACHER_ID = :TEACHER_ID AND t.TEST_ID = te.TEST_ID AND c.CLASS_ID = ac.CLASS_ID AND te.subject_id = w.SORT_ID
############################################
#
#LESSON
#
############################################
lesson.get.today.teacher = SELECT l.LESSON_NAME, l.LESSON_TIME, l.WEEKDAY, lc.CLASS_ID, c.CLASS_NAME, l.TEACHER_ID FROM c_lesson AS l, c_lesson_class AS lc, c_class AS c WHERE l.TEACHER_ID = :TEACHER_ID AND c.CLASS_ID = lc.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID AND l.WEEKDAY = DATE_FORMAT(now(), '%w') AND l.EXIST_FLAG = 1 AND lc.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME
lesson.get.all.teacher = SELECT l.LESSON_NAME, l.LESSON_TIME, l.WEEKDAY, lc.CLASS_ID, c.CLASS_NAME, l.TEACHER_ID FROM c_lesson AS l, c_lesson_class AS lc, c_class AS c WHERE l.TEACHER_ID = :TEACHER_ID AND c.CLASS_ID = lc.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID AND l.EXIST_FLAG = 1 AND lc.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME
lesson.get.today.student = SELECT l.LESSON_NAME, l.LESSON_TIME, l.WEEKDAY, lc.CLASS_ID, c.CLASS_NAME, l.TEACHER_ID FROM c_lesson AS l, c_lesson_class AS lc, c_class AS c, c_student AS s, c_class_student AS cs WHERE s.STUDENT_ID = :STUDENT_ID AND s.STUDENT_ID = cs.STUDENT_ID AND c.CLASS_ID = cs.CLASS_ID AND c.CLASS_ID = lc.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID AND l.START_DATE <= NOW() \
						   AND l.END_DATE >= NOW() AND l.WEEKDAY = DATE_FORMAT(now(), '%w') AND l.EXIST_FLAG = 1 AND lc.EXIST_FLAG = 1 AND cs.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME
lesson.get.all.student = SELECT c.CLASS_ID, c.CLASS_NAME, l.SUBJECT_ID, l.LESSON_NAME, lc.LESSON_TIME, lc.WEEKDAY FROM \
							c_class_student AS cs, c_class AS c, c_lesson_class AS lc, c_lesson AS l WHERE cs.STUDENT_ID = :STUDENT_ID \
							AND c.CLASS_ID = cs.CLASS_ID AND lc.CLASS_ID = c.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID \
							AND cs.EXIST_FLAG = 1 AND lc.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME, l.WEEKDAY

############################################
#
#F_GOOD_MODEL
#
############################################
good.model.corpus = SELECT gm.MODEL_ID, gm.MODEL_NAME, gm.UNIT_PRICE, gm.GOODS_ID, gm.REMARK FROM f_good_model AS gm WHERE gm.GOODS_ID = :GOODS_ID
trade.get.tradeno = SELECT t.TRADE_ID, t.USER_ID, t.TRADE_TYPE, t.TRADE_TIME, t.MONEY, t.GOODS_ID, t.MODEL_ID, t.TRADE_STATUS, t.REMARK FROM f_trade AS t WHERE t.TRADE_ID = :TRADE_ID
trade.update.status = update f_trade set TRADE_STATUS = :STATUS where TRADE_ID = :TRADE_ID
good.model.get.trade = SELECT m.MODEL_ID, m.MODEL_NAME, m.UNIT_PRICE, m.GOODS_ID, m.REMARK, m.STOCK FROM f_good_model AS m, f_trade AS t WHERE m.GOODS_ID = t.GOODS_ID AND m.MODEL_ID = t.MODEL_ID AND t.TRADE_ID = :TRADE_NO
############################################
#
#L_SUBSCRIBE
#
############################################
lsubscribe.insert = INSERT INTO L_SUBSCRIBE(USER_ID,START_DATETIME,END_DATETIME,REMARK) \
                    VALUES (:USER_ID, :START_DATETIME, :END_DATETIME, :REMARK)
lsubscribe.update = update l_subscribe set START_DATETIME=:START_DATETIME, END_DATETIME = :END_DATETIME, REMARK=:REMARK \
					where USER_ID = :USER_ID
lsubscribe.get.user = SELECT LS.USER_ID, LS.START_DATETIME, LS.END_DATETIME, LS.REMARK FROM L_SUBSCRIBE AS LS WHERE LS.USER_ID = :USER_ID

############################################
#
#S_PARAMETER
#
############################################
parameter.get.all = SELECT p.PARAMETER_ID, p.PARAMETER_NAME, p.PARAMETER_VALUE, p.REMARK FROM s_parameter AS p
      
############################################
#
#L_SEARCH_LOG
#
############################################
search.log.save = INSERT INTO l_search_log (KEYWORD,USER_ID,SEARCH_TIME,OTHER_KEYWORD,TABLE_NAME) \
                  VALUES (:KEYWORD, :USER_ID, :SEARCH_TIME, :OTHER_KEYWORD,:TABLE_NAME) 

############################################
#
#S_MESSAGE
#
############################################
message.insertmessage = INSERT INTO s_message(MESSAGE_USER_ID, MESSAGE_CONTENT, MESSAGE_DATE, MESSAGE_IP) \
                        VALUES(:MESSAGE_USER_ID, :MESSAGE_CONTENT, :MESSAGE_DATE, :MESSAGE_IP)
message.update = UPDATE s_message SET RE_CONTENT=:RE_CONTENT, RE_DATE=:RE_DATE, RE_USER_ID=:RE_USER_ID, STATE=:STATE WHERE MESSAGE_ID = :MESSAGE_ID
message.update.state = UPDATE s_message SET STATE=:STATE WHERE MESSAGE_ID = :MESSAGE_ID
message.get.all.bystate = SELECT m.MESSAGE_ID, u.USER_NO MESSAGE_USER_NO, u.PHOTO, m.MESSAGE_CONTENT, m.MESSAGE_DATE, m.MESSAGE_IP, m.RE_USER_ID, \
                          m.RE_CONTENT, m.RE_DATE, m.STATE \
                          FROM s_message AS m LEFT JOIN s_user AS  u ON u.USER_ID=m.MESSAGE_USER_ID \
                          WHERE STATE <>2 ORDER BY MESSAGE_ID DESC
message.get.bymessageuserid = SELECT m.MESSAGE_ID, u.USER_NO MESSAGE_USER_NO, u.PHOTO, m.MESSAGE_CONTENT, m.MESSAGE_DATE, m.MESSAGE_IP, m.RE_USER_ID, m.RE_CONTENT, \
                              m.RE_DATE, m.STATE FROM s_message AS m LEFT JOIN s_user AS  u ON u.USER_ID=m.MESSAGE_USER_ID \
                              WHERE STATE <>2  AND  MESSAGE_USER_ID=:MESSAGE_USER_ID ORDER BY MESSAGE_ID DESC
message.get.bystate = SELECT m.MESSAGE_ID, u.USER_NO MESSAGE_USER_NO, u.PHOTO, m.MESSAGE_CONTENT, m.MESSAGE_DATE, m.MESSAGE_IP, m.RE_USER_ID, m.RE_CONTENT, m.RE_DATE, m.STATE \
					  FROM s_message AS m LEFT JOIN s_user AS  u ON u.USER_ID=m.MESSAGE_USER_ID \
					  WHERE STATE=:STATE ORDER BY MESSAGE_ID DESC
message.update.reContent = UPDATE s_message set RE_CONTENT=:RE_CONTENT WHERE MESSAGE_ID = :MESSAGE_ID 
message.get.usermessage = SELECT m.MESSAGE_ID, m.MESSAGE_USER_ID, m.MESSAGE_CONTENT, m.MESSAGE_DATE, m.RE_USER_ID, m.MESSAGE_IP, m.RE_CONTENT, m.RE_DATE, m.STATE, u.USER_NO, u.USER_NAME, u.PHOTO  FROM s_message as m \
                          LEFT JOIN s_user as u ON m.message_user_id = u.user_id WHERE (m.message_id = :USER_NO or m.message_user_id = :USER_NO or u.user_no = :USER_NO or message_content like :LUSER_NO) ORDER BY MESSAGE_DATE DESC
        
############################################
#
#E_ANALY_PERSON
#
############################################
analy.person.ability.basicinfo = SELECT s.STUDENT_NAME, c.CLASS_NAME, t.TEACHER_NAME, eap1.SCORE_CR, eap1.SCORE_GR, eac.STUDENT_NUM STUDENT_NUM_C, eag.STUDENT_NUM STUDENT_NUM_G, eap1.SCORE FROM e_analy_person AS eap1, c_student AS s, c_class AS c, c_teacher AS t, e_test AS te1, e_analy_class AS eac, e_analy_grade AS eag \
								 WHERE eap1.USER_ID = :USER_ID AND s.STUDENT_ID = eap1.STUDENT_ID AND c.CLASS_ID = eap1.CLASS_ID AND c.EXIST_FLAG = 1 AND t.TEACHER_ID = c.TEACHER_ID AND te1.test_time = ( SELECT MAX(TEST_TIME) FROM e_test te2 JOIN e_analy_person eap2 ON eap2.TEST_ID = te2.TEST_ID AND eap2.USER_ID = :USER_ID ) \
								 AND te1.TEST_ID = eap1.TEST_ID AND eap1.SUBJECT_ID IN (4, 5, 6) AND eac.TEST_ID = eap1.TEST_ID AND eac.CLASS_ID = c.CLASS_ID AND eac.SUBJECT_ID = eap1.SUBJECT_ID AND eag.TEST_ID = eap1.TEST_ID AND eag.GRADE_ID = eac.GRADE_ID AND eag.SUBJECT_ID = eap1.SUBJECT_ID

analy.person.ability.closedtest = SELECT eap2.TEST_ID, et2.TEST_NAME, eap2.SUBJECT_ID, ws.SORT_NAME, eap2.SCORE, eap2.SCORE_CR, eap2.SCORE_GR, eac.SCORE_AVG, eac.JOIN_NUM JOIN_CR, eag.JOIN_NUM JOIN_GR, eap2.TOTAL \
								  FROM e_analy_person AS eap2, e_analy_class AS eac, e_analy_grade AS eag, w_sort AS ws, c_class AS c, \
								  ( SELECT DISTINCT et1.TEST_ID, et1.TEST_NAME FROM e_test et1 JOIN e_analy_person eap1 ON eap1.TEST_ID = et1.TEST_ID \
								  WHERE eap1.USER_ID = :USER_ID ORDER BY et1.TEST_TIME DESC LIMIT 0, 1 ) AS et2 WHERE eap2.USER_ID = :USER_ID AND eap2.TEST_ID = et2.TEST_ID AND c.CLASS_ID = eap2.CLASS_ID \
								  AND c.EXIST_FLAG = 1 AND ws.SORT_ID = eap2.SUBJECT_ID AND eac.CLASS_ID = eap2.CLASS_ID AND eac.TEST_ID = eap2.TEST_ID AND eac.SUBJECT_ID = eap2.SUBJECT_ID \
								  AND eag.TEST_ID = eap2.TEST_ID AND eag.SUBJECT_ID = eap2.SUBJECT_ID

analy.person.ability.lasttest = SELECT eap2.TEST_ID, et2.TEST_NAME, eap2.SUBJECT_ID, ws.SORT_NAME, eap2.SCORE, eap2.SCORE_CR, eap2.SCORE_GR, eac.SCORE_AVG, eac.JOIN_NUM JOIN_CR, eag.JOIN_NUM JOIN_GR \
								  FROM e_analy_person AS eap2, e_analy_class AS eac, e_analy_grade AS eag, w_sort AS ws, c_class AS c, \
								  ( SELECT DISTINCT et1.TEST_ID, et1.TEST_NAME FROM e_test et1 JOIN e_analy_person eap1 ON eap1.TEST_ID = et1.TEST_ID \
								  WHERE eap1.USER_ID = :USER_ID ORDER BY et1.TEST_TIME DESC LIMIT 1, 1 ) AS et2 WHERE eap2.USER_ID = :USER_ID AND eap2.TEST_ID = et2.TEST_ID AND c.CLASS_ID = eap2.CLASS_ID \
								  AND c.EXIST_FLAG = 1 AND ws.SORT_ID = eap2.SUBJECT_ID AND eac.CLASS_ID = eap2.CLASS_ID AND eac.TEST_ID = eap2.TEST_ID AND eac.SUBJECT_ID = eap2.SUBJECT_ID \
								  AND eag.TEST_ID = eap2.TEST_ID AND eag.SUBJECT_ID = eap2.SUBJECT_ID
analy.person.exam.testsort = SELECT DISTINCT et.TEST_ID,et.test_name,ws.SORT_ID,ws.SORT_NAME FROM e_test et,e_analy_person eap,w_sort ws,e_analy_class eac WHERE eap.USER_ID=:USER_ID AND et.TEST_ID=eap.TEST_ID AND eap.SUBJECT_ID=ws.SORT_ID AND eac.CLASS_ID=eap.CLASS_ID

analy.person.exam.sortscore = SELECT et.test_name,ws.SORT_ID,ws.SORT_NAME,eap.SCORE,eap.SCORE_CR,eap.SCORE_GR FROM w_sort ws,e_analy_person eap,e_test et WHERE eap.USER_ID=:USER_ID AND eap.SUBJECT_ID IN(:SUBJECT_ID) AND eap.TEST_ID=1 AND eap.SUBJECT_ID=ws.SORT_ID AND et.TEST_ID=eap.TEST_ID \
							  WHERE eap.USER_ID=:USER_ID AND eap.SUBJECT_ID IN(:SUBJECT_ID) AND eap.TEST_ID=1 AND eap.SUBJECT_ID=ws.SORT_ID AND et.TEST_ID=eap.TEST_ID

analy.person.exam.fourtimes = SELECT DISTINCT et.test_time FROM e_test et, e_analy_person eap WHERE eap.USER_ID =：USER_ID AND et.test_time <= ( SELECT DISTINCT et.test_time FROM e_test et JOIN e_analy_person eap ON eap.TEST_ID = et.TEST_ID WHERE eap.USER_ID = :USER_ID AND et.TEST_ID = :TEST_ID ) AND eap.TEST_ID = et.TEST_ID ORDER BY et.test_time DESC LIMIT 0, 4

analy.person.exam.fourtests = SELECT et.test_name, ws.SORT_NAME, eap.SCORE, eap.SCORE_CR, eap.SCORE_GR FROM e_test et, e_analy_person eap, w_sort ws WHERE eap.USER_ID = :USER_ID AND et.test_time IN(:TEST_TIME) AND ws.SORT_ID IN (:SUBJECTS) AND et.TEST_ID = eap.TEST_ID AND eap.SUBJECT_ID = ws.SORT_ID

analy.person.exam.onetest = SELECT t.test_name, s.SORT_NAME, ap.SCORE, ap.SCORE_CR, ap.SCORE_GR FROM e_test AS t, e_analy_person AS ap, w_sort AS s WHERE t.TEST_ID =:TEST_ID AND ap.USER_ID =:USER_ID AND s.SORT_ID = ap.SUBJECT_ID AND t.TEST_ID = ap.TEST_ID AND ap.SUBJECT_ID IN(:SUBJECT_ID)

analy.person.lesson.student.all = SELECT l.LESSON_NAME, l.LESSON_TIME, l.WEEKDAY, lc.CLASS_ID, c.CLASS_NAME, l.TEACHER_ID FROM c_lesson AS l, c_lesson_class AS lc, c_class AS c, c_student AS cs, c_class_student AS ccs WHERE cs.STUDENT_ID = :STUDENT_ID AND ccs.CLASS_ID = c.CLASS_ID AND ccs.STUDENT_ID = cs.STUDENT_ID AND c.CLASS_ID = lc.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID AND l.EXIST_FLAG = 1 \
								  AND lc.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME

analy.person.lesson.student.today = SELECT l.LESSON_NAME, l.LESSON_TIME, l.WEEKDAY, lc.CLASS_ID, c.CLASS_NAME, l.TEACHER_ID FROM c_lesson AS l, c_lesson_class AS lc, c_class AS c, c_student AS cs, c_class_student AS ccs WHERE cs.STUDENT_ID = :STUDENT_ID AND ccs.CLASS_ID = c.CLASS_ID \
									AND ccs.STUDENT_ID = cs.STUDENT_ID AND c.CLASS_ID = lc.CLASS_ID AND l.LESSON_ID = lc.LESSON_ID AND l.WEEKDAY = DATE_FORMAT(now(), '%w') \
									AND l.EXIST_FLAG = 1 AND lc.EXIST_FLAG = 1 ORDER BY l.LESSON_TIME

analy.person.subject.all = SELECT DISTINCT ws.SORT_ID,ws.SORT_NAME FROM w_sort ws,e_analy_person eap WHERE eap.STUDENT_ID=:STUDENT_ID AND eap.SUBJECT_ID=ws.SORT_ID

analy.person.subject.single = SELECT et.test_name,ws.SORT_NAME,eap.SCORE,eap.SCORE_CR,eap.SCORE_GR FROM e_test et,w_sort ws,e_analy_person eap WHERE eap.STUDENT_ID=:STUDENT_ID AND et.test_time>=:TEST_TIME1 AND et.test_time<=:TEST_TIME2 \
							  AND eap.SUBJECT_ID=:SUBJECT_ID AND et.TEST_ID=eap.TEST_ID AND ws.SORT_ID=eap.SUBJECT_ID ORDER BY et.test_time DESC
						
analy.person.exam.fourtest = SELECT DISTINCT ap.TEST_ID, t.test_time, t.test_name FROM e_analy_person AS ap, c_class AS c, e_test AS t WHERE ap.USER_ID = :USER_ID AND ap.CLASS_ID = c.CLASS_ID AND c.EXIST_FLAG = 1 AND t.TEST_ID = ap.TEST_ID ORDER BY t.test_time DESC LIMIT 0, 4	  
#######################################################
#
#CRAWLER
#
#######################################################
crawler.get.init.url = SELECT L.AUTHOR_ID, L.URL, L.`LEVEL`, L.TITLETAG, L.CONTENTTAG, L.DATETAG, L.DATEFORMAT, L.FILTERREG, L.MAXLEVEL, L.TABLENAME, L.CHARSET FROM L_CRAWLER AS L WHERE MAXLEVEL > 0
crawler.insert.visited.url = INSERT INTO L_VISITEDURL(URL,DATE) VALUES(:URL,:DATE)
crawler.query.url.count = SELECT URL FROM L_VISITEDURL WHERE URL = :URL
crawler.queue.queueurl.count = SELECT URL FROM l_queueurl WHERE URL = :URL
crawler.insert.news = INSERT INTO @@TABLE_NAME,(ARTICLE_NAME, CONTENT, PUBLICATION_DATE, AUTHOR_ID, URL, ENTERING_DATE) VALUES(:TITLE, :CONTENT, :DATE, :AUTHOR, :URL, :ENTERING_DATE) 
crawler.insert.url = INSERT INTO l_queueurl_temp (author_id, url, `level`, titleTag, contentTag, dateTag, dateFormat, filterReg, maxLevel, tableName, charSet) \
                       VALUES (:AUTHORID, :URL, :LEVEL, :TITLETAG, :CONTENTTAG, :DATETAG, :DATEFORMAT, :FILTERREG, :MAXLEVEL, :TABLENAME, :CHARSET)							
crawler.delete.url = DELETE FROM l_queueurl WHERE URL = :URL
crawler.get.queue.url = SELECT L.AUTHOR_ID, L.URL, L.`LEVEL`, L.TITLETAG, L.CONTENTTAG, L.DATETAG, L.DATEFORMAT, L.FILTERREG, L.MAXLEVEL, L.TABLENAME, L.CHARSET FROM l_queueurl AS L limit 0, 1000
############################################
#
#F_DRAWMONEY_RECORD
#
############################################
drawmoney.create = INSERT INTO f_drawmoney_record(BANKNAME,RECEIVER,ACCOUNT,AMOUNT,USER_ID,DRAWMONEY_TIME) VALUES(:BANKNAME,:RECEIVER,:ACCOUNT,:AMOUNT,:USER_ID,:DRAWMONEY_TIME)
drawmoney.get.allrecords.byuserid = SELECT DRAWMONEY_ID, BANKNAME, ACCOUNT, RECEIVER, AMOUNT, DRAWMONEY_TIME, USER_ID, STATE,TRANSFER_TIME,TRANSFER_USER_ID,TRANSFER_EVIDENCE,REMARK FROM f_drawmoney_record WHERE USER_ID = :USER_ID ORDER BY drawmoney_time DESC
drawmoney.update.drawstate = UPDATE f_drawmoney_record SET STATE=:STATE,TRANSFER_TIME=:TRANSFER_TIME,TRANSFER_USER_ID=:TRANSFER_USER_ID,TRANSFER_EVIDENCE=:TRANSFER_EVIDENCE,REMARK=:REMARK WHERE DRAWMONEY_ID=:DRAWMONEY_ID
drawmoney.get.currentaccount = SELECT CASH FROM f_account WHERE USER_ID=:USER_ID
drawmoney.update.accountcash = UPDATE f_account SET CASH=CASH-:DRAWAMOUNT WHERE USER_ID=:USER_ID   
drawmoney.get.onerecord = SELECT f.DRAWMONEY_ID, f.USER_ID, c.`NAME`, f.ACCOUNT, f.RECEIVER, f.AMOUNT, f.DRAWMONEY_TIME, u1.USER_NO APPLICANT, f.STATE, f.TRANSFER_TIME, u2.USER_NO TRANSFER_USER_NO, f.TRANSFER_EVIDENCE,f.REMARK FROM f_drawmoney_record f JOIN s_code c ON c.`CODE` = f.BANKNAME \
						  JOIN s_user u1 ON u1.user_id = f.user_id LEFT JOIN s_user u2 ON f.transfer_user_id = u2.user_id \
						  WHERE f.DRAWMONEY_ID =:DRAWMONEY_ID AND c.CODE_CATE = "BANKNAME"
drawmoney.get.bystate = SELECT f.DRAWMONEY_ID, f.BANKNAME, f.ACCOUNT, f.RECEIVER, f.AMOUNT, f.DRAWMONEY_TIME, u1.user_no applicant, f.STATE, f.TRANSFER_TIME, u2.user_no transfer_user_no,f.REMARK FROM f_drawmoney_record f JOIN s_user u1 ON u1.USER_ID = f.USER_ID LEFT JOIN s_user u2 ON f.TRANSFER_USER_ID = u2.USER_ID WHERE (f.STATE=:STATE OR -1=:STATE) ORDER BY f.DRAWMONEY_TIME DESC
drawmoney.get.allrecords = SELECT f.DRAWMONEY_ID, f.BANKNAME, f.ACCOUNT, f.RECEIVER, f.AMOUNT, f.DRAWMONEY_TIME, u1.user_no applicant, f.STATE, f.TRANSFER_TIME, u2.user_no transfer_user_no,f.REMARK FROM f_drawmoney_record f JOIN s_user u1 ON u1.user_id = f.user_id LEFT JOIN s_user u2 ON f.transfer_user_id = u2.user_id ORDER BY f.drawmoney_time DESC
drawmoney.get.bank.code = SELECT c.`NAME` FROM s_code c WHERE c.CODE_CATE = "bankname" AND c.`CODE` =:CODE
drawmoney.get.freezemoney.amount = SELECT SUM(amount) freezemoney FROM f_drawmoney_record WHERE USER_ID =:USER_ID AND state=0
############################################
#
#F_TRADE
#
############################################
trade.get.all = SELECT t.TRADE_ID, t.TRADE_TIME, t.MONEY, t.TRADE_STATUS, g.GOODS_DETAIL, gm.MODEL_NAME FROM f_trade t, f_goods g, f_good_model gm WHERE t.TRADE_STATUS=2 AND g.GOODS_ID = t.GOODS_ID AND gm.MODEL_ID = t.MODEL_ID ORDER BY t.TRADE_TIME DESC
trade.get.all.byuserid = SELECT t.TRADE_ID, t.TRADE_TIME, t.MONEY, t.TRADE_STATUS, t.TRADE_NAME, t.TRADE_TYPE FROM f_trade t WHERE t.USER_ID =:USER_ID AND t.TRADE_STATUS = 2 ORDER BY t.TRADE_TIME DESC
############################################
#
#S_CODE
#
############################################
scode.query.codecate = SELECT s.CODE_CATE, s.`CODE`, s.`NAME`, s.REMARK FROM s_code AS s WHERE s.CODE_CATE = :CODE_CATE
scode.query.all = SELECT s.CODE_CATE, s.`CODE`, s.`NAME`, s.REMARK FROM s_code AS s Order By ORDER_NO
############################################
#
#E_TEST
#
############################################
scorerecord.teacher.classes = SELECT DISTINCT c.CLASS_ID, c.CLASS_NAME FROM c_teacher AS t, c_class AS c, c_lesson AS l, c_lesson_class AS lc \
							 WHERE t.USER_ID = :USER_ID AND l.TEACHER_ID = t.TEACHER_ID AND lc.LESSON_ID = l.LESSON_ID AND c.CLASS_ID = lc.CLASS_ID AND c.EXIST_FLAG = 1
						  
scorerecord.teacher.sorts = SELECT DISTINCT s.SORT_ID, s.SORT_NAME FROM c_teacher AS t, c_lesson AS l, c_lesson_class AS lc, w_sort AS s \
						   WHERE t.USER_ID =:USER_ID AND l.TEACHER_ID = t.TEACHER_ID AND lc.LESSON_ID = l.LESSON_ID AND lc.EXIST_FLAG = 1 AND s.SORT_ID = l.SUBJECT_ID

scorerecord.grade.test.closed = SELECT DISTINCT t.TEST_ID, t.test_name, t.test_time FROM e_test AS t, e_analy_grade AS g, c_class AS c WHERE c.CLASS_ID =:CLASS_ID AND g.GRADE_ID = c.GRADE_ID AND t.TEST_ID = g.TEST_ID LIMIT 0, 1

inforecord.grade.exam = SELECT EXAM_ID, EXAM_NAME FROM e_exam WHERE TEST_ID =:TEST_ID AND SUBJECT_NO=:SUBJECT_NO
							   
inforecord.etest.create = INSERT INTO e_test ( TEST_ID, TEST_NAME, TEST_TIME, YEAR, SEMESTER, SCHOOL_ID, GRADE_ID ) VALUES ( :TEST_ID, :TEST_NAME, :TEST_TIME, :YEAR, :SEMESTER, :SCHOOL_ID, :GRADE_ID )		

inforecord.eexam.create = INSERT INTO e_exam ( EXAM_ID, EXAM_NAME, YEAR, SEMESTER, SUBJECT_NO, TOTAL ) VALUES ( :EXAM_ID, :EXAM_NAME, :YEAR, :SEMESTER, :SUBJECT_NO, :TOTAL )

inforecord.teacher.class.all = SELECT DISTINCT s.SCHOOL_ID, g.GRADE_ID, g.GRADE_NAME, c.CLASS_ID, c.CLASS_NAME \
										   FROM c_teacher AS t, c_grade AS g, c_class AS c, c_school AS s \
										   WHERE t.USER_ID =:USER_ID AND g.SCHOOL_ID = t.SCHOOL_ID AND g.EXIST_FLAG = 1 AND c.GRADE_ID = g.GRADE_ID AND s.SCHOOL_ID = t.SCHOOL_ID ORDER BY g.GRADE_ID, c.CLASS_ID
										   
inforecord.get.grade.school = SELECT g.GRADE_ID, s.SCHOOL_ID FROM c_class AS c, c_grade AS g, c_school AS s WHERE c.CLASS_ID =:CLASS_ID AND g.GRADE_ID = c.CLASS_ID AND g.SCHOOL_ID = s.SCHOOL_ID
############################################
#
#hefan
#
############################################	
article.get.all=SELECT a.AUTHOR_ID,CONCAT(a.LAST_NAME,' ',a.FIRST_NAME) name,ar.ARTICLE_NAME,ar.PUBLICATION_DATE \
FROM l_author a  \
JOIN l_article ar \
ON a.AUTHOR_ID=ar.AUTHOR_ID \
WHERE (a.AUTHOR_ID=:AUTHOR_ID or -1 = :AUTHOR_ID) AND (ar.ARTICLE_NAME=:ARTICLE_NAME or  '-1' = :ARTICLE_NAME) \
ORDER BY ar.PUBLICATION_DATE DESC 

############################################
#
#s_user,c_teacher,c_warranty
#老师所在的学校是否已经授权
############################################	
teacher.user.byuserId = SELECT t.TEACHER_ID ,t.SCHOOL_ID \
						FROM c_teacher t,c_warranty w \
						WHERE t.USER_ID = :USER_ID \
						AND t.SCHOOL_ID = w.SCHOOL_ID \
						AND w.END_DATETIME > SYSDATE() \
						AND w.START_DATETIME <SYSDATE() \
						AND w.SERVICE_TYPE = 1

############################################
#
#c_student,c_class_student,c_class,c_grade,c_warranty
#学生所在的学校是否已经授权
############################################
student.user.byuserId = SELECT t.USER_ID \
						FROM c_student t,c_class_student cc,c_class c,c_grade g,c_warranty w \
						WHERE t.USER_ID = :USER_ID \
						AND t.STUDENT_ID = cc.STUDENT_ID \
						AND cc.CLASS_ID = c.CLASS_ID \
						AND c.GRADE_ID = g.GRADE_ID \
						AND g.SCHOOL_ID = w.SCHOOL_ID \
						AND w.END_DATETIME > SYSDATE() \
						AND w.START_DATETIME < SYSDATE() \
						AND w.SERVICE_TYPE = 1

############################################
#
#教师创建试卷获得已授权的科目
############################################	
teacher.get.SubByTeach = SELECT ws2.SORT_ID, ws1.SORT_NAME PARENT_SORT, ws1.SORT_NO, ws2.SORT_NAME FROM w_sort ws1, \
							(SELECT ws.SORT_ID, ws.SORT_NAME, ws.SORT_PARENT_ID FROM w_sort ws, \
							( SELECT ct.TEACH FROM c_teacher ct WHERE ct.user_id = :USER_ID ) techsub \
							WHERE techsub.TEACH LIKE CONCAT('%,', ws.SORT_ID, ',%') OR techsub.TEACH LIKE CONCAT(ws.SORT_ID, ',%') \
							) ws2 WHERE ws2.SORT_PARENT_ID = ws1.SORT_ID

############################################
#
#E_EXAM
#通过用户编号	获得	试卷信息
############################################	
exam.get.all = SELECT u.user_id,SUM(IF(ee.RELEASE_STATUS=0,1,0)) AS UNRELEASED_NO, \
				SUM(IF(ee.RELEASE_STATUS=1,1,0)) AS UNDELETED_EXAM, \
				SUM(IF(ee.RELEASE_STATUS=1,ee.M_TOPIC_NUM,0)) AS TOTAL_NUM \
				FROM s_user u LEFT JOIN e_exam ee ON (u.user_id = ee.CAREAOR) \
				WHERE u.user_id =:USER_ID \
				GROUP BY u.user_id

############################################
#
#E_TEST
#通过老师编号查询考试信息
############################################
test.get.byuser=SELECT  c.GRADE_ID,te.TEST_ID,te.test_name \
FROM c_teacher t,c_lesson l,c_lesson_class lc,c_class c,c_grade cg,e_test te \
where t.USER_ID=:USER_ID \
and t.TEACHER_ID=l.TEACHER_ID \
and l.LESSON_ID=lc.LESSON_ID \
and lc.CLASS_ID=c.CLASS_ID  \
and te.GRADE_ID=c.GRADE_ID  \
and lc.EXIST_FLAG=1   \
AND c.GRADE_ID=cg.GRADE_ID  \
and te.test_time>SYSDATE()  \
GROUP BY  c.GRADE_ID,te.TEST_ID,te.test_name

############################################
#
#E_TEST
#通过老师编号和试卷得到考试
############################################
test.get.byExamId = SELECT te.GRADE_ID, te.TEST_ID, te.test_name, IF(IFNULL(etex.TEST_ID,-1)=-1,0,1) EXISTS_FLAG, t.USER_ID FROM c_teacher t JOIN e_test te ON te.test_time > SYSDATE() JOIN e_exam ee ON ee.EXAM_ID = :EXAM_ID LEFT JOIN e_test_exam etex ON etex.TEST_ID = te.test_id AND etex.SUBJECT_ID = ee.SUBJECT_NO \
					WHERE t.USER_ID = :USER_ID AND EXISTS ( SELECT 1 FROM c_lesson l, c_lesson_class lc, c_class c WHERE t.TEACHER_ID = l.TEACHER_ID AND l.LESSON_ID = lc.LESSON_ID AND l.SUBJECT_ID = ee.SUBJECT_NO AND lc.EXIST_FLAG = 1 AND lc.CLASS_ID = c.CLASS_ID AND c.GRADE_ID = te.GRADE_ID ) \
					AND NOT EXISTS ( SELECT 1 FROM e_test_exam ete, e_exam eex WHERE te.TEST_ID = ete.TEST_ID AND ete.exam_id = :EXAM_ID ) GROUP BY te.GRADE_ID, te.TEST_ID, te.test_name

network.save.eexam = INSERT INTO e_exam(EXAM_ID,EXAM_NAME,YEAR,SEMESTER,SUBJECT_NO,EXAM_TYPE,B_TOPIC_NUM,M_TOPIC_NUM,TOTAL,CAREAOR,COST_TIME,REMARK,Q_RANDOM,O_RANDOM,B_CODE_TYPE,S_CODE_TYPE,O_CODE_TYPE,PASS_SCORE,EXAM_AREA,RELEASE_STATUS,TEST_ID,RELEASE_TIME,E_STATUS,GRADE_LEVEL) \
					VALUES (:EXAM_ID,:EXAM_NAME,:YEAR,:SEMESTER,:SUBJECT_NO,:EXAM_TYPE,:B_TOPIC_NUM,:M_TOPIC_NUM,:TOTAL,:CAREAOR,:COST_TIME,:REMARK,:Q_RANDOM,O_RANDOM,:B_CODE_TYPE,:S_CODE_TYPE,:O_CODE_TYPE,:PASS_SCORE,:EXAM_AREA,:RELEASE_STATUS,:TEST_ID,:RELEASE_TIME,:E_STATUS,:GRADE_LEVEL)
############################################
#c_greade
#获得老师所教的年级
#
############################################

greate.all.byteacher = SELECT DISTINCT c.GRADE_ID, g.GRADE_NAME, g.SCHOOL_ID, g.GRADE_LEVEL FROM c_teacher t, c_lesson l, c_lesson_class lc, c_class c, c_grade g \
						WHERE t.USER_ID =:USER_ID AND t.TEACHER_ID = l.TEACHER_ID AND l.LESSON_ID = lc.LESSON_ID AND lc.CLASS_ID = c.CLASS_ID \
						AND g.GRADE_ID = c.GRADE_ID AND lc.EXIST_FLAG = 1 ORDER BY GRADE_NAME

############################################
#s_code
#获得考试类型
#
############################################		
network.getTestTypes=SELECT `CODE`,`NAME` \
FROM s_code s \
WHERE s.CODE_CATE=:CODE_CATE
############################################
#e_test
#新建考试####
#
############################################
network.test.insert = INSERT INTO e_test(TEST_ID,TEST_NAME,YEAR,SEMESTER,SCHOOL_ID,GRADE_ID,TEST_TYPE,REMARK,test_time,TEST_ENDTIME) \
					VALUES(:TEST_ID,:TEST_NAME,:YEAR,:SEMESTER,:SCHOOL_ID,:GRADE_ID,:TEST_TYPE,:REMARK,:TEST_TIME,:TEST_ENDTIME)

network.eTtestExam.insert = INSERT INTO e_test_exam(TEST_ID,EXAM_ID,SUBJECT_ID,HIS_FLAG) \
					VALUES(:TEST_ID,:EXAM_ID,:SUBJECT_ID,:HIS_FLAG)
					
network.delete.testexamrelation.testid.examid = DELETE FROM e_test_exam WHERE TEST_ID = :TEST_ID AND SUBJECT_ID = (SELECT SUBJECT_NO FROM e_exam WHERE EXAM_ID = :EXAM_ID)
############################################
#e_exam
#查询老师未发布的试卷###
#
############################################
network.e_exam.releasestatus = SELECT DISTINCT eex.e_status,eex.EXAM_NAME,eex.EXAM_ID,eex.M_TOPIC_NUM,eex.TOTAL,eex.PASS_SCORE,eex.RELEASE_STATUS,COST_TIME,ws.SORT_NAME \
								FROM e_exam eex,w_sort ws \
								WHERE eex.CAREAOR=:USER_ID \
								AND eex.RELEASE_STATUS=0  \
								AND ws.SORT_ID=eex.SUBJECT_NO

#############################################
##e_exam
##删除考卷
##
#############################################
network.e_exam.queryByexamId=SELECT QUES_ID FROM e_exam_question WHERE EXAM_ID=:EXAM_ID   

############################################
#
#删除试卷#####
#
############################################
network.e_exams.get=SELECT * FROM e_exam where e_exam.EXAM_ID=:EXAM_ID
network.e_exam.updataByDel=UPDATE e_exam ex SET ex.RELEASE_STATUS=2 WHERE ex.EXAM_ID=:EXAM_ID

############################################
#
#查看试卷库 我的试卷(0.未发布1。已发布)
#
############################################
network.e_exam.getExamStatues = SELECT eex.EXAM_ID, eex.EXAM_NAME, eex.SUBJECT_NO, ws.SORT_NAME, eex.RELEASE_TIME, eex.B_TOPIC_NUM, eex.M_TOPIC_NUM, eex.TOTAL, eex.E_status, coun.USE_TIMES FROM e_exam eex \
								JOIN w_sort ws ON ws.SORT_ID = eex.SUBJECT_NO LEFT JOIN ( SELECT EXAM_ID, COUNT(EXAM_ID) USE_TIMES FROM e_test_exam GROUP BY EXAM_ID ) coun ON coun.EXAM_ID = eex.EXAM_ID \
								WHERE eex.CAREAOR = :USER_ID AND YEAR (eex.RELEASE_TIME) >= :RELEASE_TIME AND eex.RELEASE_STATUS = 1 AND ws.SORT_ID = eex.SUBJECT_NO ORDER BY eex.RELEASE_TIME DESC
								
############################################
#exam
#查询考卷信息
#
############################################
network.e_exam.getExamsbyUp = SELECT * FROM e_exam WHERE EXAM_ID=:EXAM_ID
############################################
#exam
#分享
#
############################################
network.e_exam.upExam=UPDATE e_exam ex SET ex.E_status=1 WHERE ex.EXAM_ID=:EXAM_ID
############################################
#school
#查询分享考卷
#
############################################
network.share.getschools = SELECT SCHOOL_ID, SCHOOL_NAME FROM c_school WHERE RESP_DIST = :RESP_DIST
############################################
#exam
#查询分享考卷###
#
############################################
network.e_exam.selectExamStatusOne = SELECT DISTINCT eex.EXAM_ID, eex.EXAM_NAME, eex.SUBJECT_NO, ws.SORT_NAME, eex.RELEASE_TIME, su.user_no, eex.B_TOPIC_NUM, eex.M_TOPIC_NUM, eex.TOTAL \
										FROM e_exam eex, c_teacher ct, c_school csc, w_sort ws, s_user su \
										WHERE eex.RELEASE_TIME >= :RELEASE_TIME \
										AND ct.USER_ID = eex.CAREAOR \
										AND ct.SCHOOL_ID = :SCHOOL_ID \
										AND eex.SUBJECT_NO = :SUBJECT_ID \
										AND	eex.E_STATUS = 1 \
										AND eex.RELEASE_STATUS = 1 \
										AND ct.USER_ID <> :USER_ID \
										AND ws.SORT_ID = eex.SUBJECT_NO \
										AND su.user_id = eex.CAREAOR \
										ORDER BY eex.RELEASE_TIME DESC
############################################
#exam
#取消共享
#
############################################ 
network.e_exam.updateExamEStatue=UPDATE e_exam ex SET ex.E_status=0 WHERE ex.EXAM_ID=:EXAM_ID
		
############################################
#s_code,c_school
#地区和学校的级联操作
#
############################################		
network.school.byCode = SELECT sc.`CODE`,sc.`NAME`,cs.SCHOOL_ID,cs.SCHOOL_NAME \
						FROM s_code sc,c_school cs \
						WHERE sc.`CODE`=cs.RESP_DIST \
						AND CODE_CATE='AREA' \
						AND sc.`CODE`=:CODE

############################################
#查询当前考场共有多少学生在考试
############################################
network.school.stu=SELECT COUNT(net.test_subj) AS countSub \
FROM  \
(SELECT  CONCAT(et.test_name,'-',ws.SORT_NAME) AS test_subj,arr.test_Id  \
		FROM c_teacher ct,c_class_student ccs,c_class cc,c_grade cg,e_test et,w_sort ws,e_arrange arr \
		WHERE ct.USER_ID = :USER_ID and arr.grade_Id=cg.GRADE_ID AND arr.test_Id = et.TEST_ID	AND arr.class_Id = cc.CLASS_ID \
		and cc.GRADE_ID=cg.GRADE_ID  \
		AND cc.class_Id = ccs.CLASS_ID AND arr.date <= SYSDATE() AND arr.endDate >= SYSDATE() \
		AND arr.SUBJECT_ID = ws.SORT_ID \
		AND EXISTS ( \
			SELECT 1 FROM	c_lesson cle,c_lesson_class clc \
			WHERE ct.TEACHER_ID = cle.TEACHER_ID AND cle.LESSON_ID = clc.LESSON_ID AND clc.EXIST_FLAG = 1 \
			AND clc.CLASS_ID = cc.CLASS_ID AND cc.EXIST_FLAG = 1 AND cle.SUBJECT_ID = arr.SUBJECT_ID) \
		GROUP BY test_subj,arr.test_Id ) net
############################################
#查询当前考场共有多少学生参加过考试
############################################
network.school.stus = SELECT count( DISTINCT ea.test_id, ea.SUBJECT_ID ) AS stus FROM c_teacher AS ct, e_arrange AS ea \
						WHERE ct.USER_ID = :USER_ID AND ea.ENDDATE < CURRENT_TIMESTAMP () \
						AND EXISTS ( SELECT 1 FROM c_lesson AS cl, c_lesson_class AS clc \
						WHERE cl.TEACHER_ID = ct.TEACHER_ID AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND clc.EXIST_FLAG = 1 AND ea.CLASS_ID = clc.CLASS_ID AND ea.SUBJECT_ID = cl.SUBJECT_ID )

############################################
#查询当前共有多少考试未安排考场
############################################
network.school.noplan = SELECT count(et.TEST_ID) as noplan FROM c_teacher ct,e_exam eex,e_test_exam ete,w_sort ws,c_grade cg,e_test et \
						WHERE  ct.USER_ID=:USER_ID AND cg.GRADE_ID=et.GRADE_ID AND ete.TEST_ID=et.TEST_ID AND eex.EXAM_ID=ete.exam_id AND ws.SORT_ID=eex.SUBJECT_NO \
						AND EXISTS (SELECT 1 FROM c_lesson cle,c_lesson_class clc,c_class ccl WHERE ct.TEACHER_ID=cle.TEACHER_ID AND cle.LESSON_ID=clc.LESSON_ID \
						AND clc.EXIST_FLAG=1 AND clc.CLASS_ID=ccl.CLASS_ID AND ccl.EXIST_FLAG=1 AND cle.SUBJECT_ID=ete.SUBJECT_ID AND ccl.GRADE_ID=cg.GRADE_ID) \
						and not EXISTS (select 1 from e_arrange arr where  arr.test_Id=et.TEST_ID and arr.subject_id=eex.SUBJECT_NO ) AND et.test_time>SYSDATE()
						
############################################
#e_arrange 
#待安排考试###
#
############################################		
settle.test.getTests= SELECT CONCAT( et.test_name, '-', ws.SORT_NAME ) AS test_subj, et.test_name, ws.SORT_NAME, cg.GRADE_NAME, et.GRADE_ID, ws.SORT_ID, \
						et.TEST_ID, ct.USER_ID AS CAREAOR, count(ccl.CLASS_ID) AS countClass, date_format(et.TEST_TIME, '%c.%d') START_TIME, \
						CONCAT( date_format(et.TEST_TIME, '%c.%d'), '-', date_format(et.TEST_Endtime, '%c.%d')) AS test_time, eex.EXAM_NAME, \
						IF ( et.test_time > SYSDATE(), "notstart", IF ( et.test_endTime < CURRENT_TIMESTAMP (), "over", "started" )) STARTFLAG \
						FROM c_teacher ct, e_exam eex, e_test_exam ete, w_sort ws, c_class ccl, c_grade cg, e_test et WHERE ct.USER_ID = :USER_ID \
						AND ccl.GRADE_ID = cg.GRADE_ID AND cg.GRADE_ID = et.GRADE_ID AND ete.TEST_ID = et.TEST_ID AND eex.EXAM_ID = ete.exam_id AND eex.RELEASE_STATUS = 1 AND ws.SORT_ID = eex.SUBJECT_NO \
						AND EXISTS ( SELECT 1 FROM c_lesson cle, c_lesson_class clc WHERE ct.TEACHER_ID = cle.TEACHER_ID AND cle.LESSON_ID = clc.LESSON_ID AND clc.EXIST_FLAG = 1 \
						AND clc.CLASS_ID = ccl.CLASS_ID AND ccl.EXIST_FLAG = 1 AND cle.SUBJECT_ID = ete.SUBJECT_ID) AND et.test_time <= ADDDATE(CURRENT_TIMESTAMP(), 14) \
						AND et.test_time >= SUBDATE(CURRENT_TIMESTAMP(), 14) AND NOT EXISTS ( SELECT 1 FROM e_arrange arr WHERE arr.test_Id = et.TEST_ID AND arr.subject_id = eex.SUBJECT_NO \
						) GROUP BY et.GRADE_ID, ws.SORT_ID, et.TEST_ID, test_time

############################################
#e_arrange
#查询老师所带的班级 提供安排或编辑###
#
############################################
############################################
#查询老师所安排的考试对应的年级下的所有班级
#
############################################
settle.class.getClasszz = SELECT cc.CLASS_ID, cc.CLASS_NAME, ea.ARRANGE_ID, ea.GRADE_ID, ea.DATE, ea.ENDDATE, ea.COST_TIME, ea.NETWORK_ADDR, ea.NETWORK_STATUS, ea.TEACHER_NAME \
							FROM e_test et JOIN c_class cc ON cc.GRADE_ID = et.GRADE_ID AND cc.EXIST_FLAG = 1 \
							LEFT JOIN e_arrange ea ON ea.CLASS_ID = cc.CLASS_ID AND ea.TEST_ID = et.test_id AND ea.SUBJECT_ID = :SUBJECT_ID \
							WHERE et.test_id = :TEST_ID
							
settle.currentinfo.sortid.testid = SELECT et.test_id, et.GRADE_ID, ws.SORT_ID, et.test_name, ws.SORT_NAME, et.test_time, et.test_endTime, ee.EXAM_NAME, ee.COST_TIME \
									FROM e_test et, e_test_exam ete, e_exam ee, w_sort ws \
									WHERE et.TEST_ID = :TEST_ID \
									AND ete.TEST_ID = et.test_id \
									AND ete.SUBJECT_ID = :SORT_ID \
									AND ee.EXAM_ID = ete.EXAM_ID \
									AND ws.SORT_ID = ete.SUBJECT_ID
############################################
#已安排的修改
#
############################################
settle.class.getClass = SELECT c.USER_ID,ete.subject_id,cla.CLASS_NAME,cla.CLASS_ID,cg.GRADE_ID,et.TEST_ID,ete.exam_id, \
						nar.netWork_Status,nar.teacher_Name,nar.date,nar.netWork_Addr,nar.user_Id ,nar.arrange_Id,nar.endDate \
						FROM c_teacher c,c_class cla,c_grade cg,e_test et,e_test_exam ete,e_arrange nar \
						WHERE  c.USER_ID=:USER_ID \
						AND cg.GRADE_ID=cla.GRADE_ID \
						AND cg.GRADE_ID=:GRADE_ID \
						AND et.TEST_ID=:TEST_ID \
						AND et.TEST_ID=ete.TEST_ID \
						AND ete.subject_id=:SUBJECT_ID \
						and nar.test_Id=et.TEST_ID \
						AND nar.class_Id=cla.CLASS_ID \
						AND nar.subject_Id=ete.SUBJECT_ID

###安排班级###
settle.save.arrange=INSERT INTO e_arrange(arrange_Id,date,teacher_Name,class_Id,test_Id,subject_Id,grade_Id,netWork_Addr,netWork_Status,USER_ID,ENDDATE,COST_TIME) \
VALUES(:ARRANGE_ID,:DATE,:TEACHER_NAME,:CLASS_ID,:TEST_ID,:SUBJECT_ID,:GRADE_ID,:NETWORK_ADDR,:NETWORK_STATUS,:USER_ID,:ENDDATE,:COST_TIME)
###已经安排的考试班级信息  #
settle.get.planTest= SELECT CONCAT( et.test_name, '-', ws.SORT_NAME ) AS test_subj, et.test_name, ws.SORT_NAME, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) AS stu, ear.netWork_Addr, ex.EXAM_ID, \
					et.TEST_ID, ear.class_Id, ear.grade_Id, ear.user_Id, ws.SORT_ID, DATE_FORMAT(ear.date, '%c.%e %k:%i') AS date, ear.date AS datetime, ex.EXAM_NAME, \
					IF ( ear.DATE > SYSDATE(), "notstart", IF ( ear.ENDDATE < CURRENT_TIMESTAMP (), "over", "started" )) STARTFLAG FROM c_teacher ct, e_exam ex, e_test et, e_test_exam ete, w_sort ws, \
					e_arrange ear, c_class cc, c_class_student ccs WHERE ct.USER_ID = :USER_ID AND ex.SUBJECT_NO = ws.SORT_ID AND ete.exam_id = ex.EXAM_ID AND ete.TEST_ID = et.TEST_ID \
					AND ete.subject_id = ex.SUBJECT_NO AND ear.test_Id = ete.TEST_ID AND cc.CLASS_ID = ear.class_Id AND ear.grade_Id = cc.GRADE_ID AND ear.subject_Id = ete.subject_id \
					AND ccs.CLASS_ID = ear.class_Id AND et.test_time <= ADDDATE(CURRENT_TIMESTAMP(), 14) AND et.test_time >= SUBDATE(CURRENT_TIMESTAMP(), 14) AND EXISTS ( SELECT 1 FROM c_lesson cle, c_lesson_class clc \
					WHERE ct.TEACHER_ID = cle.TEACHER_ID AND cle.LESSON_ID = clc.LESSON_ID AND clc.EXIST_FLAG = 1 AND clc.CLASS_ID = cc.CLASS_ID AND cc.EXIST_FLAG = 1 AND cle.SUBJECT_ID = ete.SUBJECT_ID) \
					GROUP BY et.test_name, ws.SORT_NAME, cc.CLASS_NAME, ear.netWork_Addr, ex.EXAM_ID, et.TEST_ID, ear.class_Id, ear.grade_Id ORDER BY et.test_time DESC, et.test_name, ws.SORT_NAME, cc.CLASS_NAME

settle.get.oldPlan= SELECT * FROM e_arrange nar WHERE nar.test_Id=:TEST_ID AND nar.subject_Id=:SUBJECT_ID AND nar.class_Id=:CLASS_ID
					
settle.get.automarkflag.testid.sortid= SELECT ete.AUTOMARK_FLAG, \
										EXISTS ( \
											SELECT * FROM e_test_exam ete, e_exam_question eeq, e_question eq \
											WHERE ete.TEST_ID = :TEST_ID AND ete.SUBJECT_ID = :SORT_ID AND eeq.EXAM_ID = ete.EXAM_ID AND eq.QUES_ID = eeq.QUES_ID AND ( eq.QUES_TYPE = 4 OR eq.QUES_TYPE = 5 ) \
										) DISABLEDAUTOMARK \
										FROM e_test_exam ete WHERE ete.TEST_ID = :TEST_ID AND ete.SUBJECT_ID = :SORT_ID
										
settle.update.automarkflag = UPDATE e_test_exam SET AUTOMARK_FLAG = :AUTOMARK_FLAG WHERE TEST_ID = :TEST_ID AND SUBJECT_ID = :SORT_ID

############################################
#如果更新班级已存在更新安排信息
#e_arrange
############################################
settle.update.arrange= UPDATE e_arrange nar SET nar.date =:DATE, nar.endDate =:ENDDATE, nar.netWork_Addr =:NETWORK_ADDR, nar.teacher_Name =:TEACHER_NAME WHERE nar.test_Id =:TEST_ID AND nar.subject_Id =:SUBJECT_ID AND nar.class_Id =:CLASS_ID
############################################
#删除考试安排信息
############################################
settle.delete.narrange=DELETE FROM e_arrange WHERE e_arrange.arrange_Id=:ARRANGE_ID

############################################
#\u667A\u80FD\u9009\u9898
############################################
exam.intelligentlychoose.get.knowledgepoints.in.fav= SELECT k.P_KP_ID, k.KP_ID, k.KP_NO, k.KP_NAME, COUNT(k.KP_ID) TOTAL FROM ( SELECT DISTINCT ekr.KP_ID, eq.QUES_ID FROM s_user_fav suf, e_question eq, e_ques_kp eqk, \
													 e_kp_rel ekr WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID AND eq.QUES_ID = suf.OBJ_ID AND eq.TS_ID = :TS_ID AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) \
													 AND eq.SUBJECT_NO = :SUBJECT_ID AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) \
													 AND eqk.QUES_ID = eq.QUES_ID AND ekr.SUB_KP_ID = eqk.KP_ID ) temp, e_knowledge k WHERE k.KP_ID = temp.KP_ID GROUP BY k.KP_ID

exam.intelligentlychoose.get.knowledgepoints.in.my= SELECT ek.KP_ID, ek.KP_NAME, ek.P_KP_ID, COUNT(ek.KP_ID) TOTAL FROM ( SELECT DISTINCT ekr.KP_ID, eq.QUES_ID FROM e_question eq, e_ques_kp eqk, e_kp_rel ekr WHERE eq.TS_ID = :TS_ID \
													AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) AND eq.CREATOR = :USER_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND eq.RELEASE_FLAG = 1 \
													AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) \
													AND eqk.QUES_ID = eq.QUES_ID AND ekr.SUB_KP_ID = eqk.KP_ID ) temp, e_knowledge ek WHERE ek.KP_ID = temp.KP_ID GROUP BY ek.KP_ID

exam.intelligentlychoose.get.knowledgepoints.in.all= SELECT ek.P_KP_ID, ek.KP_ID, ek.KP_NO, ek.KP_NAME, COUNT(ek.KP_ID) TOTAL FROM ( SELECT DISTINCT ekr.KP_ID, eqk.QUES_ID FROM e_question eq, e_ques_kp eqk, e_kp_rel ekr \
													 WHERE eq.TS_ID = :TS_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND eq.RELEASE_FLAG = 1 AND ( eq.CREATOR = :USER_ID OR eq.SHARE_FLAG = 1 ) AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) \
													 AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND eqk.QUES_ID = eq.QUES_ID \
													 AND ekr.SUB_KP_ID = eqk.KP_ID ) temp, e_knowledge ek WHERE ek.KP_ID = temp.KP_ID GROUP BY ek.KP_ID

exam.intelligentlychoose.get.sortnameinfo.by.subjectid= SELECT ws1.SORT_ID, ws2.SORT_NAME SCHOOLlEVEL, ws1.SORT_NAME FROM w_sort ws1, w_sort ws2 WHERE ws1.SORT_ID = :SUBJECT_ID AND ws2.SORT_ID = ws1.SORT_PARENT_ID

exam.intelligentlychoose.get.typeinfo.by.examid.typeid= SELECT eqt.TYPE_ID, eqt.TYPE_NAME, eqt.ORDER_NUM, eqt.DEFAULT_SCORE, IFNULL(SUM(1), 0) QUES_NUM, IFNULL(SUM(eeq.SCORE), 0) TYPE_SCORE, SUBSTRING_INDEX( SUBSTRING_INDEX( sc.`NAME`, ",", eqt.ORDER_NUM ), "," ,-1 ) TYPE_NUM \
														FROM e_ques_type eqt, e_exam_question eeq, e_question eq, s_code sc WHERE eqt.TYPE_ID = :TYPE_ID AND eeq.EXAM_ID = :EXAM_ID AND eeq.TYPE_ID = eqt.TYPE_ID AND eq.QUES_ID = eeq.QUES_ID AND eq.QUES_TYPE <> 6 AND sc.CODE_CATE = 'CODETYPE' AND sc.`CODE` = '1'

exam.intelligentlychoose.get.page.in.fav= SELECT eq.QUES_ID FROM s_user_fav suf, e_question eq, e_ques_kp eqk, e_kp_rel ekr WHERE suf.USER_ID = :USER_ID AND suf.FAV_TYPE = '10' AND eq.QUES_ID = suf.OBJ_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND eq.TS_ID = :TS_ID AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) \
											AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND eqk.QUES_ID = eq.QUES_ID AND ekr.SUB_KP_ID = eqk.KP_ID AND ekr.KP_ID = :KP_ID ORDER BY eq.INPUT_TIME DESC

exam.intelligentlychoose.get.page.in.my= SELECT eq.QUES_ID FROM e_question eq, e_ques_kp eqk, e_kp_rel ekr WHERE eq.TS_ID = :TS_ID AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) AND eq.CREATOR = :USER_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND eq.RELEASE_FLAG = 1 \
										AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND eqk.QUES_ID = eq.QUES_ID AND ekr.SUB_KP_ID = eqk.KP_ID AND ekr.KP_ID = :KP_ID ORDER BY eq.INPUT_TIME DESC

exam.intelligentlychoose.get.page.in.all= SELECT eq.QUES_ID FROM e_question eq, e_ques_kp eqk, e_kp_rel ekr WHERE eq.TS_ID = :TS_ID AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) AND eq.SUBJECT_NO = :SUBJECT_ID AND eq.RELEASE_FLAG = 1 AND ( eq.CREATOR = :USER_ID OR eq.SHARE_FLAG = 1 ) \
											AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND eqk.QUES_ID = eq.QUES_ID AND ekr.SUB_KP_ID = eqk.KP_ID AND ekr.KP_ID = :KP_ID ORDER BY eq.INPUT_TIME DESC

exam.intelligentlychoose.get.easyerror= SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo := @rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn ) easy_error_opt WHERE RANK_NO = 1

exam.intelligentlychoose.get.ques.in.fav.for.exam= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
													IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, IF (ISNULL(eeq.EXAM_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES \
													FROM (${exam.intelligentlychoose.get.page.in.fav} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID \
													LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = equ.QUES_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN e_exam_question eeq ON eeq.EXAM_ID = :EXAM_ID \
													AND eeq.QUES_ID = equ.QUES_ID LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.ques.in.fav.for.hw= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
													IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, IF (ISNULL(ehq.HW_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES \
													FROM (${exam.intelligentlychoose.get.page.in.fav} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID \
													LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = c.QUES_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN e_hw_question ehq ON ehq.HW_ID = :HW_ID \
													AND ehq.QUES_ID = c.QUES_ID LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.ques.in.my.for.exam= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
													IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, IF (ISNULL(eeq.EXAM_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES \
													FROM (${exam.intelligentlychoose.get.page.in.my} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID \
													LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = equ.QUES_ID LEFT JOIN e_exam_question eeq ON eeq.EXAM_ID = :EXAM_ID \
													AND eeq.QUES_ID = equ.QUES_ID LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.ques.in.my.for.hw= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
												IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, IF (ISNULL(ehq.HW_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES \
												FROM (${exam.intelligentlychoose.get.page.in.my} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID \
												LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = equ.QUES_ID LEFT JOIN e_hw_question ehq ON ehq.HW_ID = :HW_ID AND ehq.QUES_ID = equ.QUES_ID \
												LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.ques.in.all.for.exam= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
													IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, IF (ISNULL(eeq.EXAM_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES \
													FROM (${exam.intelligentlychoose.get.page.in.all} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID \
													LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = equ.QUES_ID LEFT JOIN e_exam_question eeq ON eeq.EXAM_ID = :EXAM_ID \
													AND eeq.QUES_ID = equ.QUES_ID LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.ques.in.all.for.hw= SELECT DISTINCT equ.RESOURCE, equ.INPUT_TIME, equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
													IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, \
													eaerr.ERROR_NUM, IF (ISNULL(ehq.HW_ID) = 1, 0, 1) JOIN_FLAG, quv.USE_TIMES FROM ( ${exam.intelligentlychoose.get.page.in.all} LIMIT :PAGE_START, :PAGE_SIZE ) c \
													JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID \
													LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = equ.QUES_ID LEFT JOIN e_hw_question ehq ON ehq.HW_ID = :HW_ID AND ehq.QUES_ID = equ.QUES_ID \
													LEFT JOIN ( ${exam.intelligentlychoose.get.easyerror} ) eaerr ON eaerr.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.opts.in.fav= SELECT DISTINCT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM (${exam.intelligentlychoose.get.page.in.fav} LIMIT :PAGE_START, :PAGE_SIZE ) c \
										  JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID JOIN e_option eo ON eo.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.opts.in.my= SELECT DISTINCT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM (${exam.intelligentlychoose.get.page.in.my} LIMIT :PAGE_START, :PAGE_SIZE ) c \
										 JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID JOIN e_option eo ON eo.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.get.opts.in.all= SELECT DISTINCT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( ${exam.intelligentlychoose.get.page.in.all} LIMIT :PAGE_START, :PAGE_SIZE ) c \
										  JOIN e_question equ ON equ.QUES_ID = c.QUES_ID OR equ.REMARK = c.QUES_ID JOIN e_option eo ON eo.QUES_ID = equ.QUES_ID ORDER BY equ.INPUT_TIME DESC, equ.QUES_ID

exam.intelligentlychoose.update.mtopics.for.exam= UPDATE e_exam_question SET M_TOPIC = M_TOPIC + :COUNT WHERE EXAM_ID = :EXAM_ID AND M_TOPIC > :M_TOPIC

exam.intelligentlychoose.update.mtopics.for.hw= UPDATE e_hw_question SET M_TOPIC = M_TOPIC + :COUNT WHERE HW_ID = :HW_ID AND M_TOPIC > :M_TOPIC

exam.intelligentlychoose.get.quesinfo.of.exam= SELECT eeq.QUES_ID, eeq.M_TOPIC, eq.REMARK FROM e_exam_question eeq, e_question eq WHERE eeq.QUES_ID = :QUES_ID AND eeq.EXAM_ID = :EXAM_ID AND eq.QUES_ID = eeq.QUES_ID

exam.intelligentlychoose.get.quesinfo.of.hw= SELECT ehq.QUES_ID, ehq.M_TOPIC, eq.REMARK FROM e_hw_question ehq, e_question eq WHERE ehq.QUES_ID = :QUES_ID AND ehq.HW_ID = :HW_ID AND eq.QUES_ID = ehq.QUES_ID

exam.intelligentlychoose.delete.questions.of.exam= DELETE FROM e_exam_question WHERE EXAM_ID = :EXAM_ID AND (( M_TOPIC >=:M_TOPIC AND M_TOPIC <(:M_TOPIC +:COUNT)) OR QUES_ID = :REMARK )

exam.intelligentlychoose.delete.questions.of.hw= DELETE FROM e_hw_question WHERE HW_ID = :HW_ID AND M_TOPIC >=:M_TOPIC AND M_TOPIC < (:M_TOPIC +:COUNT)

############################################
#\u4E2A\u4EBA\u9898\u5E93
############################################
personalwharehouse.get.kps= SELECT KP_ID, KP_NAME, P_KP_ID, COUNT(QUES_ID) TOTAL FROM ( SELECT DISTINCT k.KP_ID, k.KP_NO, k.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, k.P_KP_ID FROM e_question eq, e_ques_kp qk, e_kp_rel kr, e_knowledge k \
							WHERE eq.TS_ID = :TS_ID AND eq.CREATOR = :USER_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND ( eq.SHARE_FLAG = :SHARE_FLAG OR - 1 = :SHARE_FLAG ) AND ( eq.RELEASE_FLAG = :RELEASE_FLAG OR - 1 = :RELEASE_FLAG ) \
							AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) \
							AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND qk.QUES_ID = eq.QUES_ID AND kr.SUB_KP_ID = qk.KP_ID AND k.KP_ID = kr.KP_ID ) c GROUP BY KP_ID, KP_NAME, P_KP_ID

personalwharehouse.get.page= SELECT DISTINCT k.KP_ID, k.KP_NO, k.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, k.P_KP_ID FROM e_question eq, e_ques_kp qk, e_kp_rel kr, e_knowledge k WHERE eq.TS_ID = :TS_ID AND eq.CREATOR = :USER_ID \
							 AND eq.SUBJECT_NO = :SUBJECT_ID AND ( eq.SHARE_FLAG = :SHARE_FLAG OR - 1 = :SHARE_FLAG ) AND ( eq.RELEASE_FLAG = :RELEASE_FLAG OR - 1 = :RELEASE_FLAG ) AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) \
							 AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(seq.REMARK, 0) = eq.QUES_ID ) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND qk.QUES_ID = eq.QUES_ID AND kr.SUB_KP_ID = qk.KP_ID \
							 AND k.KP_ID = kr.KP_ID AND k.KP_ID = :KP_ID

personalwharehouse.get.ques= SELECT eq.RESOURCE, IF(LENGTH(eq.RESOURCE)>31, CONCAT(left(eq.RESOURCE,10), '...'), eq.RESOURCE) FORMAT_RESOURCE, eq.GRADE_LEVEL, eq.INPUT_TIME, eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, eq.RELEASE_FLAG, eq.SHARE_FLAG, \
							eq.QUES_REC, eq.DIFFICULTY, eq.REMARK, eq.TS_ID, IFNULL(qs.QUES_TOTAL_NUM, 0) QUES_TOTAL_NUM, IFNULL(qs.QUES_RIGHT_NUM, 0) QUES_RIGHT_NUM, \
							quv.USE_TIMES, IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, IFNULL(eaerr.ERROR_NUM, 0) ERROR_NUM \
							FROM (${personalwharehouse.get.page} LIMIT :PAGE_START, :PAGE_SIZE ) c JOIN e_question eq ON c.QUES_ID = eq.QUES_ID OR c.QUES_ID = IFNULL(eq.REMARK, 0) LEFT JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID \
							LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = eq.QUES_ID LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = eq.QUES_ID ORDER BY eq.INPUT_TIME DESC, eq.QUES_ID
							
personalwharehouse.get.opts= SELECT DISTINCT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM (${personalwharehouse.get.page} LIMIT :PAGE_START, :PAGE_SIZE ) c, e_question eq, e_option eo WHERE (eq.QUES_ID = c.QUES_ID OR c.QUES_ID = IFNULL(eq.REMARK,0)) AND eo.QUES_ID = eq.QUES_ID ORDER BY eq.INPUT_TIME DESC, eq.QUES_ID

personalwharehouse.update.quesflag= UPDATE e_question SET RELEASE_FLAG = :RELEASE_FLAG, SHARE_FLAG = :SHARE_FLAG WHERE QUES_ID = :QUES_ID

personalwharehouse.get.relation.existflag= SELECT DISTINCT eq.QUES_ID FLAG FROM e_question eq, e_hw_question ehq, e_exam_question eeq WHERE eq.QUES_ID = :QUES_ID AND ( ehq.QUES_ID = eq.QUES_ID OR eeq.QUES_ID = eq.QUES_ID )

personalwharehouse.update.article.flag= UPDATE e_question SET RELEASE_FLAG = :RELEASE_FLAG, SHARE_FLAG = :SHARE_FLAG WHERE QUES_ID = :QUES_ID OR REMARK = CONCAT(:QUES_ID, '')

personalwharehouse.delete.article.questions= DELETE FROM e_question WHERE QUES_ID = :QUES_ID OR REMARK = CONCAT(:QUES_ID,'')

personalwharehouse.update.article.questions.resource.gradelevel= UPDATE e_question SET RESOURCE = :RESOURCE, GRADE_LEVEL = :GRADE_LEVEL WHERE QUES_ID = :QUES_ID OR REMARK = CONCAT(:QUES_ID, '')

personalwharehouse.get.relation.of.ques.and.exam.or.hw= SELECT qhv.TYPE, IFNULL(eh.HW_NAME, ee.EXAM_NAME) TYPE_NAME FROM ques_hworexam_view qhv \
														LEFT JOIN e_homework eh ON qhv.TYPE = 1 AND eh.HW_ID = qhv.HWOREXAM_ID LEFT JOIN e_exam ee ON qhv.TYPE = 2 AND ee.EXAM_ID = qhv.HWOREXAM_ID WHERE QUES_ID = :QUES_ID

############################################
#查询即将考试的信息
#e_arrange
############################################
settle.about.tests=	SELECT CONCAT(et.test_name,'-',ws.SORT_NAME) AS test_subj, et.test_name, ws.SORT_NAME, cc.CLASS_NAME,DATE_FORMAT(arr.date, '%c.%e %k:%i') AS date, \
					arr.netWork_Addr,arr.grade_Id,arr.test_Id,arr.CLASS_ID,arr.SUBJECT_ID,COUNT(ccs.STUDENT_ID) stu \
					FROM c_teacher ct,c_class_student ccs,c_class cc,e_test et,w_sort ws,e_arrange arr \
					WHERE ct.USER_ID = :USER_ID AND arr.test_Id = et.TEST_ID AND arr.class_Id = cc.CLASS_ID \
					AND cc.class_Id = ccs.CLASS_ID AND arr.date > SYSDATE() \
					AND arr.SUBJECT_ID = ws.SORT_ID \
					AND EXISTS ( \
					SELECT 1 FROM c_lesson cle,c_lesson_class clc \
					WHERE ct.TEACHER_ID = cle.TEACHER_ID AND cle.LESSON_ID = clc.LESSON_ID AND clc.EXIST_FLAG = 1 \
					AND clc.CLASS_ID = cc.CLASS_ID AND cc.EXIST_FLAG = 1 AND cle.SUBJECT_ID = arr.SUBJECT_ID) \
					GROUP BY test_subj,cc.CLASS_NAME,arr.date,arr.netWork_Addr,arr.grade_Id,arr.test_Id,arr.CLASS_ID,arr.SUBJECT_ID

############################################
#
#查找正在考试的信息
#e_test_record
############################################
settle.testing.get=SELECT net.*,COUNT(net.STUDENT_ID) stu,SUM(IF (ISNULL(etr.USER_ID), 0, 1)) comStu \
					FROM \
					(SELECT CONCAT(et.test_name,'-',ws.SORT_NAME) AS test_subj, et.test_name, ws.SORT_NAME, DATE_FORMAT(arr.date, '%c.%e %k:%i') AS date, cc.CLASS_NAME, \
							arr.netWork_Addr,arr.grade_Id,arr.test_Id,arr.CLASS_ID,arr.SUBJECT_ID,ccs.STUDENT_ID \
						FROM c_teacher ct,c_class_student ccs,c_class cc,e_test et,w_sort ws,e_arrange arr \
						WHERE ct.USER_ID = :USER_ID AND arr.test_Id = et.TEST_ID	AND arr.class_Id = cc.CLASS_ID \
						AND cc.class_Id = ccs.CLASS_ID AND arr.date <= SYSDATE() AND arr.endDate >= SYSDATE()  \
						AND arr.SUBJECT_ID = ws.SORT_ID \
						AND EXISTS ( \
							SELECT 1 FROM	c_lesson cle,c_lesson_class clc \
							WHERE ct.TEACHER_ID = cle.TEACHER_ID AND cle.LESSON_ID = clc.LESSON_ID AND clc.EXIST_FLAG = 1 \
							AND clc.CLASS_ID = cc.CLASS_ID AND cc.EXIST_FLAG = 1 AND cle.SUBJECT_ID = arr.SUBJECT_ID) \
					) net \
					LEFT JOIN e_test_record AS etr ON (etr.TEST_ID = net.TEST_ID AND etr.SUBJECT_ID = net.SUBJECT_ID \
					AND etr.CLASS_ID = net.CLASS_ID AND etr.STUDENT_ID = net.STUDENT_ID) \
					GROUP BY net.test_subj,net.CLASS_NAME,net.date,net.netWork_Addr,net.grade_Id,net.test_Id,net.CLASS_ID,net.SUBJECT_ID
############################################
#
#考试结果查看
#
############################################
settle.arrange.getResult=SELECT net.*,COUNT(etr.CLASS_ID) AS comStu FROM  \
(SELECT CONCAT(et.test_name,'-',ws.SORT_NAME) AS test_subj,cc.CLASS_NAME,COUNT(ccs.STUDENT_ID)  AS stu,arr.arrange_Id,arr.date,arr.netWork_Addr,arr.user_Id,arr.grade_Id,ws.SORT_ID,arr.test_Id,cc.CLASS_ID  \
FROM e_test et,e_exam eex,e_test_exam ete,w_sort ws,c_class cc,c_class_student ccs,e_arrange arr  \
WHERE arr.user_Id=:USER_ID \
AND arr.test_Id=et.TEST_ID  \
AND arr.class_Id=cc.CLASS_ID  \
AND arr.class_Id=ccs.CLASS_ID  \
AND arr.endDate<SYSDATE()  \
AND et.TEST_ID=ete.TEST_ID \
AND ete.subject_id=eex.SUBJECT_NO \
AND eex.SUBJECT_NO=ws.SORT_ID  \
GROUP BY et.test_name,ws.SORT_NAME,cc.CLASS_NAME,arr.arrange_Id,arr.netWork_Addr  \
) AS net   \
LEFT JOIN e_test_record AS etr    \
ON etr.TEST_ID=net.TEST_ID   \
AND etr.SUBJECT_ID=net.SORT_ID    \
AND etr.CLASS_ID=net.CLASS_ID  \
GROUP BY net.USER_ID,net.test_subj,net.SORT_ID,net.CLASS_ID,net.CLASS_NAME,net.GRADE_ID,net.TEST_ID,net.netWork_Addr,net.date 
############################################
#
#学生查看教师安排的考试
#
############################################
network.student.getTest= SELECT cs.USER_ID, t.TEST_ID, cs.STUDENT_ID, cs.STUDENT_NO, ccs.CLASS_ID, nar.arrange_Id, \
							CONCAT( t.test_name, "-", ws.SORT_NAME ) AS test_sub, t.test_name, ws.SORT_NAME, e.SUBJECT_NO, e.EXAM_ID, e.M_TOPIC_NUM, e.COST_TIME, \
							e.TOTAL, etr.EXAM_USE_TIME, nar.user_Id AS createUser, nar.NETWORK_ADDR, nar.TEACHER_NAME, etr.COMMIT_FLAG, etr.TEST_REC_ID, \
							DATE_FORMAT(nar.date, '%c.%e %k:%i') START_TIME, DATE_FORMAT(nar.date, '%Y-%m-%d %T') BEGIN_DATE, DATE_FORMAT(nar.enddate, '%Y-%m-%d %T') END_DATE \
							FROM c_student cs \
							JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID AND ccs.EXIST_FLAG = 1 \
							JOIN e_arrange nar ON nar.class_Id = ccs.CLASS_ID \
							AND DATE_SUB(CURDATE(), INTERVAL 1 WEEK) <= nar.date \
							AND DATE_ADD(CURDATE(), INTERVAL 1 WEEK) >= nar.date \
							JOIN e_test t ON t.TEST_ID = nar.TEST_ID \
							JOIN e_test_exam ete ON ete.TEST_ID = nar.TEST_ID \
							JOIN e_exam e ON e.EXAM_ID = ete.exam_id AND e.SUBJECT_NO = nar.SUBJECT_ID \
							JOIN w_sort ws ON ws.SORT_ID = e.SUBJECT_NO \
							LEFT JOIN e_test_record etr ON ( etr.EXAM_ID = ete.EXAM_ID AND etr.STUDENT_ID = cs.STUDENT_ID AND etr.TEST_ID = nar.TEST_ID) \
							WHERE cs.USER_ID = :USER_ID ORDER BY nar.DATE DESC

network.student.save.etestrecord=INSERT INTO e_test_record (TEST_REC_ID,TEST_ID,USER_ID,EXAM_ID,EXAM_STATUS,COMMIT_FLAG,EXAM_TIME,SCORE,REMARK,EXAM_USE_TIME,SUBJECT_ID,CLASS_ID,CREATOR_ID,STUDENT_ID) \
									VALUES (:TEST_REC_ID,:TEST_ID,:USER_ID,:EXAM_ID,:EXAM_STATUS,:COMMIT_FLAG,:EXAM_TIME,:SCORE,:REMARK,:EXAM_USE_TIME,:SUBJECT_ID,:CLASS_ID,:CREATOR_ID,:STUDENT_ID)

network.student.get.testrecid.by.testid.subjectid.examid.userid = SELECT TEST_REC_ID FROM e_test_record WHERE TEST_ID = :TEST_ID AND SUBJECT_ID = :SUBJECT_ID AND EXAM_ID = :EXAM_ID AND USER_ID = :USER_ID

############################################
#
#S_CARD
#ool
############################################		
card.get.card.cardnopassword = SELECT CARD_ID, CARD_NO, CARD_NAME, CARD_PASSWORD, CARD_TYPE, CARD_OWNER, CARD_USER, CARD_STATUS, REMARK, LOCK_STATUS FROM s_card WHERE CARD_NO =:CARD_NO AND CARD_PASSWORD=:CARD_PASSWORD

card.get.service.cardid = SELECT CARDSERVICE_ID, CARD_ID, SERVICE_TYPE, SERVICE_TYPE, SERVICE_CONTENT, REMARK, USE_STATUS FROM s_cardservice WHERE CARD_ID =:CARD_ID AND USE_STATUS=0

card.get.service.cardid.servicetype = SELECT CARDSERVICE_ID, CARD_ID, SERVICE_TYPE, SERVICE_TYPE, SERVICE_CONTENT, REMARK, USE_STATUS FROM s_cardservice WHERE CARD_ID =:CARD_ID AND SERVICE_TYPE =:SERVICE_TYPE AND USE_STATUS=0
			
card.update.status.user.cardid = UPDATE s_card SET CARD_STATUS=1,CARD_USER=:CARD_USER WHERE CARD_ID=:CARD_ID	

card.update.service.serviceid = UPDATE s_cardservice SET USE_STATUS=:USE_STATUS WHERE CARDSERVICE_ID=:CARDSERVICE_ID 

############################################
#e_exam
#修改试卷   	查询试卷状态为发布的信息###
#
############################################
network.e_exam.releasestatusIsOne = SELECT eex.EXAM_ID,eex.EXAM_NAME,eex.SUBJECT_NO,eex.RELEASE_TIME,eex.RELEASE_STATUS, \
									       etet.test_time,etet.test_name,etet.TEST_ID,eex.TEST_ID AS t,ws.SORT_NAME,eex.TOTAL \
									FROM w_sort ws,e_exam eex \
									LEFT JOIN (SELECT et.test_time,et.test_name,ete.TEST_ID,ete.exam_id FROM e_test_exam ete,e_test et \
									           WHERE et.TEST_ID = ete.TEST_ID) etet ON (eex.EXAM_ID = etet.exam_id) \
									WHERE	ws.SORT_ID = eex.SUBJECT_NO AND eex.CAREAOR = :USER_ID AND eex.RELEASE_STATUS = 1 \
									ORDER BY eex.RELEASE_TIME DESC,etet.test_time DESC
############################################
#e_exam
#安排考试
#
############################################
network.e_exam.updateExamTest=UPDATE e_exam e SET e.TEST_ID=:TEST_ID WHERE e.EXAM_ID=:EXAM_ID

############################################
#
#POINT_RECORD
#
############################################	
score.get.all.student.classid = SELECT s.USER_ID, s.STUDENT_ID, s.STUDENT_NO, s.STUDENT_NAME, s.GENDER, tr.SCORE, tr.EXAM_STATUS FROM c_class_student AS cs JOIN c_student AS s ON s.STUDENT_ID = cs.STUDENT_ID LEFT JOIN e_test_record AS tr ON tr.USER_ID = s.USER_ID AND tr.TEST_ID = :TEST_ID AND tr.SUBJECT_ID = :SUBJECT_ID WHERE cs.CLASS_ID = :CLASS_ID

score.insert.testscore = INSERT INTO e_test_record(TEST_REC_ID, USER_ID, SUBJECT_ID, TEST_ID, EXAM_STATUS, SCORE, STUDENT_ID, CLASS_ID, CREATOR_ID) VALUES(:TEST_REC_ID, :USER_ID, :SUBJECT_ID, :TEST_ID, :EXAM_STATUS, :SCORE, :STUDENT_ID, :CLASS_ID, :CREATOR_ID)

score.update.score = UPDATE e_test_record SET SCORE =:SCORE, EXAM_STATUS =:EXAM_STATUS, CREATOR_ID=:CREATOR_ID WHERE STUDENT_ID =:STUDENT_ID AND TEST_ID =:TEST_ID AND SUBJECT_ID =:SUBJECT_ID

score.get.all.grade.userid = SELECT DISTINCT g.GRADE_ID, g.GRADE_NAME FROM c_grade AS g, c_teacher AS t WHERE t.USER_ID =:USER_ID AND t.SCHOOL_ID = g.SCHOOL_ID AND g.EXIST_FLAG = 1 ORDER BY g.GRADE_LEVEL

############################################
#
#VIEW_EXAM
#
############################################
viewexam.exam.get.basicinfo = SELECT e.EXAM_NAME, e.TOTAL, e.COST_TIME, e.PASS_SCORE, e.M_TOPIC_NUM, tr.TEST_REC_ID, tr.SCORE, tr.EXAM_TIME, tr.EXAM_USE_TIME, ADDTIME(tr.EXAM_TIME,STR_TO_DATE(tr.EXAM_USE_TIME,'%H:%i:%s')) AS COMMIT_TIME, COUNT(trd.QUES_ID) AS ANSWER_QUESTION \
							  FROM e_test_record AS tr, e_exam AS e, e_test_record_detail AS trd WHERE tr.USER_ID =:USER_ID AND tr.EXAM_ID =:EXAM_ID AND e.EXAM_ID = tr.EXAM_ID AND trd.TEST_REC_ID = tr.TEST_REC_ID ORDER BY tr.EXAM_TIME DESC LIMIT 0, 1

viewexam.student.get.all = SELECT tr.USER_ID, MAX(tr.EXAM_TIME) AS EXAM_TIME, tr.SCORE FROM e_test_record AS tr WHERE tr.COMMIT_FLAG = 1 AND tr.EXAM_ID =:EXAM_ID GROUP BY tr.USER_ID ORDER BY tr.SCORE	DESC												 
 
viewexam.question.score = SELECT qt.TYPE_ID, qt.TYPE_NAME, trd.QUES_ID, q.OPTION_NUM, trd.SCORE, eq.O_SCORE, trd.ANSWER_TIME, trd.ANSWER, o.OPT_ID, o.OPT_REFER \
						  FROM e_test_record_detail AS trd, e_exam_question AS eq, e_question AS q, e_ques_type AS qt, e_option AS o \
						  WHERE trd.TEST_REC_ID =:TEST_REC_ID AND eq.EXAM_ID =:EXAM_ID AND eq.QUES_ID = trd.QUES_ID AND q.QUES_ID = trd.QUES_ID AND qt.TYPE_ID = eq.TYPE_ID AND o.QUES_ID = q.QUES_ID ORDER BY trd.QUES_ID, o.OPT_ID
										
viewexam.question.percent = SELECT trd.QUES_ID, q.QUES_TYPE, trd.ANSWER, q.OPTION_NUM, o.OPT_ID, o.OPT_REFER FROM e_test_record_detail AS trd, e_test_record AS tr, e_question AS q, e_option AS o WHERE tr.EXAM_ID = :EXAM_ID AND trd.TEST_REC_ID = tr.TEST_REC_ID AND q.QUES_ID = trd.QUES_ID AND o.QUES_ID = q.QUES_ID ORDER BY q.QUES_ID, o.OPT_ID

viewexam.record.statistics= SELECT ex.EXAM_ID, ex.TOTAL, ex.EXAM_NAME, ex.COST_TIME, rk.EXAM_USE_TIME, ex.PASS_SCORE, ex.M_TOPIC_NUM, rk.SCORE, \
								ADDTIME( rk.EXAM_TIME, STR_TO_DATE( rk.EXAM_USE_TIME, '%H:%i:%s' )) COMMIT_TIME, rk.RANK_ALL, qt.CT, avgp.PNUM, \
								avgp.AVGSCORE, TRUNCATE(rk.RANK_ALL/avgp.PNUM,1) SURPASS \
							 FROM e_exam ex LEFT JOIN ( \
							 		SELECT tr.TEST_REC_ID, tr.USER_ID, tr.EXAM_ID, tr.EXAM_TIME, tr.EXAM_USE_TIME, tr.SCORE, COUNT(tr1.TEST_REC_ID)-1 RANK_ALL \
							 		FROM e_test_record tr, e_test_record tr1 WHERE tr.EXAM_ID = :EXAM_ID AND tr.TEST_REC_ID = :TEST_REC_ID \
							 		AND tr.USER_ID = :USER_ID AND tr1.EXAM_ID = tr.EXAM_ID AND tr.SCORE >= tr1.SCORE \
							 		GROUP BY tr.TEST_REC_ID, tr.USER_ID, tr.EXAM_ID, tr.EXAM_TIME, tr.EXAM_USE_TIME, tr.SCORE ) rk \
							 ON (ex.EXAM_ID = rk.EXAM_ID) LEFT JOIN ( \
							 		SELECT trd.TEST_REC_ID, COUNT(trd.QUES_ID) CT FROM e_test_record_detail trd \
							 		WHERE trd.TEST_REC_ID = :TEST_REC_ID AND trd.STUDENT_ANSWER IS NOT NULL GROUP BY trd.TEST_REC_ID ) qt \
							 ON ( rk.TEST_REC_ID = qt.TEST_REC_ID ) LEFT JOIN ( \
							 		SELECT EXAM_ID, COUNT(TEST_REC_ID) PNUM, SUM(SCORE)/COUNT(TEST_REC_ID) AVGSCORE FROM e_test_record WHERE EXAM_ID = :EXAM_ID ) avgp \
							 ON (avgp.EXAM_ID = ex.EXAM_ID) WHERE ex.EXAM_ID = :EXAM_ID

viewexam.type.score.time = SELECT trd.TEST_REC_ID, eq.TYPE_ID, qt.TYPE_NAME, SUM( CAST(trd.ANSWER_TIME AS DECIMAL)) TYPE_ANSWER_TIME_MS, \
								SEC_TO_TIME( SUM( CAST(trd.ANSWER_TIME AS DECIMAL))) TYPE_ANSWER_TIME_HMS, SUM(trd.SCORE) TYPE_STU_SCORE, SUM(eq.SCORE) TYPE_SCORE \
							FROM e_test_record_detail AS trd, e_test_record AS tr, e_exam_question AS eq, e_ques_type AS qt \
							WHERE trd.TEST_REC_ID = :TEST_REC_ID AND tr.TEST_REC_ID = trd.TEST_REC_ID AND eq.EXAM_ID = tr.EXAM_ID \
							AND eq.QUES_ID = trd.QUES_ID AND qt.TYPE_ID = eq.TYPE_ID GROUP BY eq.TYPE_ID ORDER BY qt.ORDER_NUM

viewexam.question.score.time = SELECT eq.TYPE_ID, eq.QUES_ID, eq.M_TOPIC, trd.SCORE STU_SCORE, eq.SCORE, \
									SEC_TO_TIME( CAST(trd.ANSWER_TIME AS DECIMAL)) ANSWER_TIME, \
									IF ( ISNULL(trd.STUDENT_ANSWER) = 1, 4, IF (trd.SCORE = eq.SCORE, 3, 1)) QUES_FLAG \
								FROM e_test_record_detail AS trd, e_test_record AS tr, e_exam_question AS eq \
								WHERE trd.TEST_REC_ID = :TEST_REC_ID AND tr.TEST_REC_ID = trd.TEST_REC_ID AND eq.EXAM_ID = tr.EXAM_ID AND eq.QUES_ID = trd.QUES_ID ORDER BY eq.M_TOPIC

viewexam.recorddetail.update.score = UPDATE e_test_record_detail SET SCORE = :SCORE,O_SCORE = :O_SCORE,TEACHER_COMMENT = :TEACHER_COMMENT WHERE QUES_ID = :QUES_ID AND TEST_REC_ID = :TEST_REC_ID

viewexam.record.update.markflagandscore = UPDATE e_test_record etr SET MARK_FLAG = :MARK_FLAG, CREATOR_ID = :CREATOR_ID, SCORE = ( SELECT SUM(IF(etrd.score=-1, 0, etrd.score)) FROM e_test_record_detail etrd WHERE etrd.TEST_REC_ID = etr.TEST_REC_ID ) WHERE TEST_REC_ID = :TEST_REC_ID

viewexam.record.update.markflag = UPDATE e_test_record SET MARK_FLAG = :MARK_FLAG WHERE TEST_REC_ID = :TEST_REC_ID

viewexam.get.marknum.recid= SELECT COUNT(q.QUES_ID) SUBJECTIVE_NUM, SUM(IF(trd.SCORE =- 1, 0, 1)) MARKED_NUM, tr.MARK_FLAG, cs.STUDENT_NAME FROM e_test_record AS tr, e_exam_question AS eq, e_question AS q, e_test_record_detail AS trd, c_student cs \
							WHERE tr.TEST_REC_ID = :TEST_REC_ID AND eq.EXAM_ID = tr.EXAM_ID AND q.QUES_ID = eq.QUES_ID AND q.QUES_TYPE IN (4, 5) AND trd.TEST_REC_ID = tr.TEST_REC_ID AND q.QUES_ID = trd.QUES_ID AND cs.STUDENT_ID = tr.STUDENT_ID

viewexam.get.commited.info= SELECT tr.TEST_REC_ID, tr.EXAM_ID, DATE_FORMAT(a.DATE, '%c.%e %k:%i') START_TIME, t.test_name, s.SORT_NAME FROM e_test_record AS tr, e_test AS t, w_sort AS s, e_arrange AS a \
							WHERE tr.USER_ID = :USER_ID AND tr.COMMIT_FLAG = 1 AND tr.MARK_FLAG = 2 AND t.test_id = tr.TEST_ID AND s.SORT_ID = tr.SUBJECT_ID AND a.CLASS_ID = tr.CLASS_ID AND a.TEST_ID = tr.TEST_ID AND a.SUBJECT_ID = tr.SUBJECT_ID ORDER BY a.DATE DESC

viewexam.update.ordernum= UPDATE e_ques_type SET ORDER_NUM = :ORDER_NUM WHERE TYPE_ID = :TYPE_ID

network.editexam.update.normal.mtopic= UPDATE e_exam_question AS eq INNER JOIN ( SELECT (@rowNO := @rowNo + 1) AS rowno, QUES_ID FROM ( SELECT qt.ORDER_NUM, qt.TYPE_NAME, eq.QUES_ID, eq.M_TOPIC \
										FROM e_exam_question AS eq, e_question AS q, e_ques_type AS qt WHERE eq.EXAM_ID = :EXAM_ID AND q.QUES_ID = eq.QUES_ID AND q.QUES_TYPE <> 6 AND qt.TYPE_ID = eq.TYPE_ID \
										ORDER BY qt.ORDER_NUM, eq.M_TOPIC) oderresult,(SELECT @rowNO := 0) b) orderques ON orderques.QUES_ID = eq.QUES_ID SET eq.M_TOPIC = orderques.rowno

network.editexam.update.art.mtopic= UPDATE e_exam_question eeq, ( SELECT eq.QUES_ID, MIN(seeq.M_TOPIC) M_TOPIC FROM e_exam_question eeq, e_exam_question seeq, e_question eq, e_question seq \
									WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_ID = eeq.QUES_ID AND eq.QUES_TYPE = 6 AND seeq.EXAM_ID = eeq.EXAM_ID AND seeq.QUES_ID = seq.QUES_ID \
									AND seq.REMARK = eq.QUES_ID GROUP BY eq.QUES_ID) c SET eeq.M_TOPIC = c.M_TOPIC WHERE eeq.EXAM_ID = :EXAM_ID AND eeq.QUES_ID = c.QUES_ID
								 
viewexam.get.examinfo.examid= SELECT EXAM_ID, EXAM_NAME, EXAM_TYPE, EXAM_AREA, SUBJECT_NO, e.`YEAR`, TOTAL, PASS_SCORE, B_TOPIC_NUM, M_TOPIC_NUM, E_status, O_RANDOM, Q_RANDOM, sc1.`NAME` B_CODES, \
								sc2.`NAME` M_CODES, CONCAT( s2.SORT_NAME, "#", s1.SORT_NAME ) SORT_NAME, COST_TIME FROM e_exam AS e, w_sort AS s1, w_sort AS s2, s_code AS sc1, s_code AS sc2 \
								WHERE EXAM_ID = :EXAM_ID AND s1.SORT_ID = e.SUBJECT_NO AND s2.SORT_ID = s1.SORT_PARENT_ID AND sc1.CODE_CATE = 'CODETYPE' AND sc2.CODE_CATE = 'CODETYPE' \
								AND sc1.`CODE` = e.B_CODE_TYPE AND sc2.`CODE` = e.S_CODE_TYPE

viewexam.update.examinfo.examid= UPDATE e_exam SET EXAM_NAME = :EXAM_NAME, YEAR = :YEAR, EXAM_AREA = :EXAM_AREA, EXAM_TYPE = :EXAM_TYPE, TOTAL = :TOTAL, PASS_SCORE = :PASS_SCORE, COST_TIME = :COST_TIME, REMARK = :REMARK WHERE EXAM_ID = :EXAM_ID

network.get.exam.previewsets= SELECT EXAM_ID, SEAL_FLAG, MARKTAG_FLAG, MARKTAG_CONTENT, EXAMINFO_FLAG, EXAMINFO_CONTENT, STUDENTINPUT_FLAG, STUDENTINPUT_CONTENT, SCORE_FLAG, NOTICE_FLAG, NOTICE_CONTENT FROM e_exam_preview WHERE EXAM_ID = :EXAM_ID

network.update.exam.previewsets= UPDATE e_exam_preview SET SEAL_FLAG =:SEAL_FLAG, MARKTAG_FLAG =:MARKTAG_FLAG, MARKTAG_CONTENT =:MARKTAG_CONTENT,EXAMINFO_FLAG =:EXAMINFO_FLAG, \
								EXAMINFO_CONTENT =:EXAMINFO_CONTENT, STUDENTINPUT_FLAG =:STUDENTINPUT_FLAG, STUDENTINPUT_CONTENT =:STUDENTINPUT_CONTENT, SCORE_FLAG =:SCORE_FLAG, \
								NOTICE_FLAG =:NOTICE_FLAG, NOTICE_CONTENT =:NOTICE_CONTENT WHERE EXAM_ID =:EXAM_ID

network.insert.exam.previewsets= INSERT INTO e_exam_preview (EXAM_ID, EXAMINFO_CONTENT) SELECT EXAM_ID, CONCAT( '\u603B\u5206\uFF1A', e.TOTAL, '\u5206\uFF1B\u8003\u8BD5\u65F6\u95F4\uFF1A', \
								 e.COST_TIME, '\u5206\u949F\uFF1B\u547D\u9898\u4EBA\uFF1A', u.user_no ) EXAMINFO_CONTENT FROM e_exam e, s_user u WHERE e.EXAM_ID = :EXAM_ID AND u.user_id = e.CAREAOR

network.get.typesubjects.by.subjectid= select TS_ID, TS_NAME, TYPE FROM e_type_subject WHERE SUBJECT_ID = :SUBJECT_ID ORDER BY TS_ID

network.update.prev.ques.mtopic= UPDATE e_exam_question eeq1, e_exam_question eeq2 SET eeq1.M_TOPIC = eeq1.M_TOPIC + 1 WHERE eeq2.EXAM_ID = :EXAM_ID AND eeq2.QUES_ID = :QUES_ID \
								 AND eeq1.EXAM_ID = eeq2.EXAM_ID AND eeq1.M_TOPIC < eeq2.M_TOPIC AND eeq1.M_TOPIC >= eeq2.M_TOPIC - :MOVE_NUM AND eeq1.QUES_ID <> IFNULL(eeq2.REMARK, 0)

network.update.ques.mtopic= UPDATE e_exam_question SET M_TOPIC = M_TOPIC-:MOVE_NUM WHERE EXAM_ID = :EXAM_ID AND QUES_ID = :QUES_ID

network.update.next.ques.mtopic= UPDATE e_exam_question eeq1, e_exam_question eeq2 SET eeq1.M_TOPIC = eeq1.M_TOPIC - 1 WHERE eeq2.EXAM_ID = :EXAM_ID AND eeq2.QUES_ID = :QUES_ID \
								 AND eeq1.EXAM_ID = eeq2.EXAM_ID AND eeq1.M_TOPIC > eeq2.M_TOPIC AND eeq1.M_TOPIC <= eeq2.M_TOPIC - :MOVE_NUM
								 
network.get.kps.by.subjectid= SELECT P_KP_ID, KP_ID, KP_NAME FROM e_knowledge WHERE SUBJECT_ID = :SUBJECT_ID

############################################
#
#GRADEPAPER
#
############################################
gradepaper.enterexam.studentsinfo.classid.subjectid= SELECT tr.CLASS_ID, tr.TEST_ID, tr.SUBJECT_ID, s.STUDENT_NO, s.STUDENT_NAME, tr.SCORE, tr.MARK_FLAG, tr.EXAM_ID, tr.TEST_REC_ID, su.photo FROM e_test_record AS tr, c_student AS s, s_user su WHERE tr.SUBJECT_ID = :SUBJECT_ID AND tr.CLASS_ID = :CLASS_ID AND tr.TEST_ID = :TEST_ID AND s.STUDENT_ID = tr.STUDENT_ID AND su.user_id = s.USER_ID ORDER BY s.STUDENT_NO

gradepaper.get.markinginfo.of.oneclass= SELECT c.test_id, c.test_name, c.test_time, c.ENDDATE, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM, CONCAT( c.test_name, "-", c.SORT_NAME ) TEST_SUBJECT, \
										SUM( IF ( ISNULL(etre.TEST_REC_ID), 0, 1 )) ACTUAL_NUM, SUM( IF ( IFNULL(etre.MARK_FLAG, 0) = 2, 1, 0 )) MARKED_NUM, SUM( IF ( ISNULL(etre.MARK_FLAG) = 1, 0, IF (etre.MARK_FLAG = 2, 0, 1))) UNMARKED_NUM \
										FROM ( SELECT et.test_id, et.test_name, et.test_time, ea.ENDDATE, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM FROM c_teacher AS ct, e_arrange AS ea, \
										c_class AS cc, w_sort AS ws, e_test AS et, c_class_student AS ccs WHERE ct.USER_ID = :USER_ID AND et.test_id = ea.TEST_ID AND ea.TEST_ID = :TEST_ID AND ea.SUBJECT_ID = :SUBJECT_ID \
										AND ws.SORT_ID = ea.SUBJECT_ID AND ccs.CLASS_ID = cc.CLASS_ID AND cc.CLASS_ID = ea.CLASS_ID AND ea.ENDDATE < NOW() \
										AND EXISTS ( SELECT 1 FROM c_lesson AS cl, c_lesson_class AS clc WHERE cl.TEACHER_ID = ct.TEACHER_ID AND ea.SUBJECT_ID = cl.SUBJECT_ID AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND ea.CLASS_ID = clc.CLASS_ID ) \
										GROUP BY et.test_id, et.test_name, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME) c LEFT JOIN e_test_record etre ON ( etre.CLASS_ID = c.CLASS_ID AND etre.TEST_ID = c.test_id AND etre.SUBJECT_ID = c.SORT_ID ) \
										GROUP BY c.test_id, c.test_name, c.test_time, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM ORDER BY c.ENDDATE DESC, c.test_time DESC, c.SORT_ID, c.c.CLASS_NAME

gradepaper.unmakedpaper.info.userid= SELECT c.test_id, c.test_name, c.test_time, c.ENDDATE, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM, CONCAT(c.test_name,"-",c.SORT_NAME) TEST_SUBJECT, SUM( IF ( ISNULL(etre.TEST_REC_ID), 0, 1 )) ACTUAL_NUM, SUM( IF ( IFNULL(etre.MARK_FLAG, 0) = 2, 1, 0 )) MARKED_NUM, SUM( IF(ISNULL(etre.MARK_FLAG)=1, 0, IF(etre.MARK_FLAG=2, 0, 1)) ) UNMARKED_NUM \
										FROM ( SELECT et.test_id, et.test_name, et.test_time, ea.ENDDATE, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM FROM c_teacher AS ct, e_arrange AS ea, c_class AS cc, w_sort AS ws, e_test AS et, c_class_student AS ccs WHERE ct.USER_ID = :USER_ID \
										AND et.test_id = ea.TEST_ID AND ws.SORT_ID = ea.SUBJECT_ID AND ccs.CLASS_ID = cc.CLASS_ID AND cc.CLASS_ID = ea.CLASS_ID AND ea.ENDDATE < NOW() AND EXISTS ( SELECT 1 FROM c_lesson AS cl, c_lesson_class AS clc WHERE cl.TEACHER_ID = ct.TEACHER_ID AND ea.SUBJECT_ID = cl.SUBJECT_ID \
										AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND ea.CLASS_ID = clc.CLASS_ID ) GROUP BY et.test_id, et.test_name, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME ) c LEFT JOIN e_test_record etre ON ( etre.CLASS_ID = c.CLASS_ID AND etre.TEST_ID = c.test_id AND etre.SUBJECT_ID = c.SORT_ID ) \
										GROUP BY c.test_id, c.test_name, c.test_time, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM ORDER BY c.ENDDATE DESC, c.test_time DESC, c.SORT_ID, c.c.CLASS_NAME

gradepaper.get.next.unmarked= SELECT etr2.TEST_REC_ID, etr2.EXAM_ID, cs1.STUDENT_NO, cs1.STUDENT_NAME, etr1.SCORE FROM e_test_record etr1 JOIN c_student cs1 ON cs1.STUDENT_ID = etr1.STUDENT_ID LEFT JOIN e_test_record etr2 ON etr2.CLASS_ID = etr1.CLASS_ID AND etr2.TEST_ID = etr1.TEST_ID AND etr2.SUBJECT_ID = etr1.SUBJECT_ID AND etr2.TEST_REC_ID <> etr1.TEST_REC_ID \
								LEFT JOIN c_student cs2 ON cs2.STUDENT_ID = etr2.STUDENT_ID AND etr2.MARK_FLAG <> 2 AND cs2.STUDENT_NO > cs1.STUDENT_NO WHERE etr1.TEST_REC_ID = :TEST_REC_ID LIMIT 0, 1
								
gradepaper.unmaked.info.userid.classid= SELECT c.test_id, c.test_name, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM, SUM( IF ( ISNULL(etre.TEST_REC_ID), 0, 1 )) ACTUAL_NUM, SUM( IF ( IFNULL(etre.MARK_FLAG, 0) = 2, 1, 0 )) MARKED_NUM, SUM( IF ( IFNULL(etre.MARK_FLAG, 0) <> 2, 1, 0 )) UNMARKED_NUM \
										FROM ( SELECT et.test_id, et.test_name, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM FROM e_arrange AS ea, c_class AS cc, w_sort AS ws, e_test AS et, c_class_student AS ccs WHERE ea.CLASS_ID = :CLASS_ID AND ea.TEST_ID = :TEST_ID \
										AND ea.SUBJECT_ID = :SUBJECT_ID AND ea.ENDDATE < NOW() AND et.test_id = ea.TEST_ID AND ws.SORT_ID = ea.SUBJECT_ID AND ccs.CLASS_ID = cc.CLASS_ID AND cc.CLASS_ID = ea.CLASS_ID GROUP BY et.test_id, et.test_name, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME ) c \
										JOIN e_test_record etre ON ( etre.CLASS_ID = c.CLASS_ID AND etre.TEST_ID = c.test_id AND etre.SUBJECT_ID = c.SORT_ID ) GROUP BY c.test_id, c.test_name, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM
											
gradepaper.typesandquestions.testrecid= SELECT eqt.TYPE_ID, eqt.TYPE_NAME, eeq.QUES_ID, eeq.M_TOPIC, IF (etrd.SCORE = -1, 4, 2) QUES_FLAG \
										FROM e_test_record etr \
										JOIN e_exam_question eeq ON eeq.EXAM_ID = etr.EXAM_ID \
										JOIN e_ques_type eqt ON eqt.TYPE_ID = eeq.TYPE_ID \
										JOIN e_question eq ON eq.QUES_TYPE <> 6 AND eq.QUES_ID = eeq.QUES_ID \
										LEFT JOIN e_test_record_detail etrd ON etrd.QUES_ID = eeq.QUES_ID AND etrd.TEST_REC_ID = etr.TEST_REC_ID \
										WHERE etr.TEST_REC_ID = :TEST_REC_ID ORDER BY eeq.M_TOPIC

gradepaper.get.typeinfo.by.examid= SELECT eeq.TYPE_ID, SUM(eeq.SCORE) SCORE, SUM(1) QUES_NUM FROM e_exam_question eeq, e_question eq WHERE eeq.EXAM_ID = :EXAM_ID AND eq.QUES_ID = eeq.QUES_ID AND eq.QUES_TYPE <> 6 GROUP BY eeq.TYPE_ID
										
gradepaper.update.testrecdetail.commentrec= UPDATE e_test_record_detail SET COMMENT_REC = :COMMENT_REC WHERE TEST_REC_ID = :TEST_REC_ID AND QUES_ID = :QUES_ID

############################################
#
#HOMEWORK-TEACHER
#
############################################
homework.insert.ehomeworkquestion= INSERT INTO e_hw_question(HW_ID, QUES_ID, M_TOPIC, SCORE, O_SCORE, REMARK) VALUES(:HW_ID, :QUES_ID, :M_TOPIC, :SCORE, :O_SCORE, :REMARK)

homework.insert.ehomework= INSERT INTO e_homework(HW_ID, HW_NAME, SUBJECT_ID, HW_TYPE, TOPIC_NUM, CREATOR, CREATE_TIME, RELEASE_STATUS, RELEASE_TIME, REFER_HWID, REMARK, GRADE_LEVEL) \
							VALUES(:HW_ID, :HW_NAME, :SUBJECT_ID, :HW_TYPE, :TOPIC_NUM, :CREATOR, :CREATE_TIME, :RELEASE_STATUS, :RELEASE_TIME, :REFER_HWID, :REMARK, :GRADE_LEVEL)
							
homework.update.ehomework= UPDATE e_homework SET HW_NAME = :HW_NAME, SUBJECT_ID = :SUBJECT_ID WHERE HW_ID = :HW_ID

homework.get.hwinfo.hwid= SELECT eh.HW_ID, eh.HW_NAME, eh.TOPIC_NUM, eh.SUBJECT_ID, eh.REFER_HWID, ws.SORT_NAME, eh.GRADE_LEVEL, sc.`NAME` \
							FROM e_homework eh JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID LEFT JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = eh.GRADE_LEVEL WHERE HW_ID = :HW_ID

homework.get.all.hwinfo.hwid.hwrecid= SELECT q.QUES_ID, q.QUES_TYPE, q.QUES_CONTENT, o.OPT_CONTENT, q.OPTION_NUM, q.CREATOR, q.RELEASE_FLAG, ehq.SCORE, ehq.O_SCORE, o.OPT_ID, o.OPT_REFER, o.OPT_NO, q.REMARK, \
										q.KNOWLEDGE_POINT, q.KEYWORD, q.QUES_REC, q.DIFFICULTY, ehq.M_TOPIC, ehrd.STUDENT_ANSWER, ehrd.REMARK MARKED_FLAG, ehrd.ANSWER_TIME, q.TS_ID FROM e_homework eh \
										JOIN e_hw_question ehq ON ehq.HW_ID = eh.HW_ID JOIN e_question q ON ehq.QUES_ID = q.QUES_ID \
										LEFT JOIN e_hw_record_detail ehrd ON ehrd.QUES_ID = ehq.QUES_ID AND ehrd.HW_REC_ID = :HW_REC_ID LEFT JOIN e_option o ON q.QUES_ID = o.QUES_ID \
										WHERE eh.HW_ID = :HW_ID ORDER BY ehq.M_TOPIC, OPT_NO
										
homework.delete.hwques= DELETE FROM e_hw_question WHERE HW_ID = :HW_ID AND QUES_ID = :QUES_ID

homework.teacher.update.homeworkname.by.hwid.hwname= UPDATE e_homework SET HW_NAME = :HW_NAME WHERE HW_ID = :HW_ID

homework.update.mtopics= UPDATE e_hw_question ehq SET ehq.M_TOPIC = ehq.M_TOPIC + :ADD_NUM WHERE ehq.HW_ID = :HW_ID AND ehq.M_TOPIC >= :M_TOPIC AND ehq.QUES_ID <> :QUES_ID AND ehq.QUES_ID <> ( SELECT IFNULL(eq.REMARK, 0) FROM e_question eq WHERE eq.QUES_ID = :QUES_ID )

homework.delete.articleandquestions= DELETE FROM e_hw_question WHERE HW_ID = :HW_ID AND QUES_ID IN(:QUES_ID)

homework.update.mtopics.afterarticle= UPDATE e_hw_question SET M_TOPIC = M_TOPIC-:M_TOPIC_NUM WHERE HW_ID = :HW_ID AND M_TOPIC > :M_TOPIC

homework.update.topicnum.hwid= UPDATE e_homework SET TOPIC_NUM = TOPIC_NUM+:ADD_NUM WHERE HW_ID = :HW_ID

homework.update.question.mtopic= UPDATE e_hw_question SET M_TOPIC = M_TOPIC -:MOVE_NUM WHERE HW_ID = :HW_ID AND QUES_ID = :QUES_ID

homework.update.prev.questions.mtopic= UPDATE e_hw_question ehq1, e_hw_question ehq2 SET ehq1.M_TOPIC = ehq1.M_TOPIC + 1 WHERE ehq2.HW_ID = :HW_ID AND ehq2.QUES_ID = :QUES_ID AND ehq1.HW_ID = ehq2.HW_ID AND ehq1.M_TOPIC < ehq2.M_TOPIC AND ehq1.M_TOPIC >= ehq2.M_TOPIC -:MOVE_NUM AND ehq1.QUES_ID <> IFNULL(ehq2.REMARK,0)

homework.update.next.questions.mtopic= UPDATE e_hw_question ehq1, e_hw_question ehq2 SET ehq1.M_TOPIC = ehq1.M_TOPIC - 1 WHERE ehq2.HW_ID = :HW_ID AND ehq2.QUES_ID = :QUES_ID AND ehq1.HW_ID = ehq2.HW_ID AND ehq1.M_TOPIC > ehq2.M_TOPIC AND ehq1.M_TOPIC <= ehq2.M_TOPIC -:MOVE_NUM

howework.get.knowledgepoints.by.hwid= SELECT ek.KP_ID, ek.KP_NAME, ek.P_KP_ID FROM e_homework eh, e_knowledge ek WHERE eh.HW_ID = :HW_ID AND ek.SUBJECT_ID = eh.SUBJECT_ID

homework.get.hwautocorrectflag.hwid= SELECT IF ( EXISTS ( SELECT * FROM e_hw_question ehq, e_question eq WHERE ehq.HW_ID = :HW_ID AND CREATOR = :USER_ID AND eq.QUES_ID = ehq.QUES_ID \
									AND ( eq.QUES_TYPE = 4 || eq.QUES_TYPE = 5 )) = 0, 1, 0 ) AUTO_CORRECT, \
									IF ( EXISTS ( SELECT * FROM e_hw_class WHERE HW_ID = :HW_ID AND CREATOR = :USER_ID AND START_TIME <= CURRENT_TIMESTAMP ()) = 1, 'useless', 'useful' ) USEFUL_STATUS

homework.get.classlist.hwid= SELECT cc.CLASS_ID, cc.CLASS_NAME, CONCAT(ehc.START_TIME,"") START_TIME, CONCAT(ehc.END_TIME,"") END_TIME, ehc.CORRECT \
								FROM c_class cc LEFT JOIN e_hw_class ehc ON ehc.CLASS_ID = cc.CLASS_ID AND ehc.HW_ID = :HW_ID \
								WHERE EXISTS( SELECT * FROM c_teacher ct, c_lesson cl, c_lesson_class clc \
								WHERE ct.USER_ID = :USER_ID AND cl.TEACHER_ID = ct.TEACHER_ID AND cl.SUBJECT_ID = :SUBJECT_ID AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND cc.CLASS_ID = clc.CLASS_ID) ORDER BY cc.CLASS_NAME
								
homework.save.ehomeworkclass = INSERT INTO e_hw_class(HW_ID, CLASS_ID, START_TIME, END_TIME, CREATOR, CORRECT, REMARK) VALUES(:HW_ID, :CLASS_ID, :START_TIME, :END_TIME, :CREATOR, :CORRECT, :REMARK)

homework.get.settleclassnames.by.hwid.creator = SELECT eh.HW_NAME, cc.CLASS_NAME, ehc.CORRECT FROM e_hw_class ehc, c_class cc, e_homework eh \
												WHERE ehc.HW_ID = :HW_ID AND ehc.CREATOR = :CREATOR AND cc.CLASS_ID = ehc.CLASS_ID AND eh.HW_ID = ehc.HW_ID ORDER BY cc.CLASS_NAME
												
homework.delete.hwclass.by.hwidclassid = DELETE FROM e_hw_class WHERE HW_ID = :HW_ID AND CLASS_ID = :CLASS_ID

homework.update.ehomework.releaseinfo= UPDATE e_homework SET RELEASE_STATUS = 1, RELEASE_TIME = CURRENT_TIMESTAMP() WHERE HW_ID = :HW_ID

homework.get.hwstatistic.by.userid= SELECT u.user_id, SUM( IF (eh.RELEASE_STATUS = 0, 1, 0)) AS UNRELEASED_NUM, SUM( IF (eh.RELEASE_STATUS = 1, 1, 0)) AS UNDELETED_NUM, SUM( IF ( eh.RELEASE_STATUS = 1, eh.TOPIC_NUM, 0 )) AS TOTAL_NUM \
									FROM s_user u LEFT JOIN e_homework eh ON eh.CREATOR = u.user_id WHERE u.user_id = :USER_ID
										
homework.get.unsettle.homeworks= SELECT eh.HW_ID, eh.HW_NAME, ws.SORT_NAME, eh.TOPIC_NUM, eh.CREATE_TIME, eh.REFER_HWID \
								FROM e_homework eh, w_sort ws WHERE eh.CREATOR = :USER_ID AND eh.RELEASE_STATUS = 0 AND ws.SORT_ID = eh.SUBJECT_ID ORDER BY eh.CREATE_TIME DESC

homework.update.homework.todeletedstatus= UPDATE e_homework SET RELEASE_STATUS = 2 WHERE HW_ID = :HW_ID

homework.update.questionssubjectno.by.hwid.subjectno= UPDATE e_hw_question ehq, e_question eq SET eq.SUBJECT_NO = :SUBJECT_NO WHERE ehq.HW_ID = :HW_ID AND eq.QUES_ID = ehq.QUES_ID

homework.get.homework.by.userid.subjectid.releasetime= SELECT eh.HW_ID, eh.HW_NAME, ws.SORT_ID, ws.SORT_NAME, eh.TOPIC_NUM, eh.CREATE_TIME, coun.USE_TIMES, eh.SHARE_FLAG, \
														IF(EXISTS(SELECT * FROM e_hw_class WHERE HW_ID = eh.HW_ID AND CREATOR = :USER_ID AND START_TIME <= CURRENT_TIMESTAMP())=1, 'useless', 'useful')  USEFUL_STATUS \
														FROM e_homework eh JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID LEFT JOIN (SELECT HW_ID, COUNT(HW_ID) USE_TIMES FROM e_hw_class GROUP BY HW_ID) coun ON coun.HW_ID = eh.HW_ID \
														WHERE eh.CREATOR = :USER_ID AND eh.RELEASE_STATUS = 1 AND eh.RELEASE_TIME >= :RELEASE_TIME AND eh.SUBJECT_ID = :SUBJECT_ID ORDER BY eh.CREATE_TIME DESC

homework.update.homework.shareflag.by.hwid= UPDATE e_homework SET SHARE_FLAG = :SHARE_FLAG WHERE HW_ID = :HW_ID

homework.get.sharedhomeworks = SELECT DISTINCT eh.HW_ID, eh.HW_NAME, eh.SUBJECT_ID, ws.SORT_NAME, eh.CREATE_TIME, su.user_no, eh.TOPIC_NUM, coun.USE_TIMES \
								FROM e_homework eh JOIN c_teacher ct ON ct.USER_ID = eh.CREATOR AND ct.SCHOOL_ID = :SCHOOL_ID AND ct.USER_ID <> :USER_ID \
								JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID JOIN s_user su ON su.user_id = eh.CREATOR \
								LEFT JOIN ( SELECT HW_ID, COUNT(HW_ID) USE_TIMES FROM e_hw_class GROUP BY HW_ID) coun ON coun.HW_ID = eh.HW_ID \
								WHERE eh.RELEASE_TIME >= :RELEASE_TIME AND eh.SUBJECT_ID = :SUBJECT_ID AND eh.SHARE_FLAG = 1 AND eh.RELEASE_STATUS = 1 ORDER BY eh.CREATE_TIME DESC

homework.get.questionIds.by.hwid = SELECT QUES_ID FROM e_hw_question WHERE HW_ID = :HW_ID

homework.get.hwquesrelation.by.hwid = SELECT HW_ID, QUES_ID, SCORE, O_SCORE, M_TOPIC, REMARK FROM e_hw_question WHERE HW_ID = :HW_ID

homework.teacher.get.knowledgepoints.by.subjectid = SELECT P_KP_ID, KP_ID, KP_NO, ek.KP_NAME FROM e_knowledge ek WHERE SUBJECT_ID = :SUBJECT_ID OR :SUBJECT_ID = -1

homework.teacher.get.pasthomeworks.by.userid= SELECT c.HW_ID, c.HW_NAME, c.START_TIME, c.END_TIME, NOW() NOW_TIME, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM,SUM(IF (ISNULL(ehr.HW_REC_ID)=0 && ehr.COMMIT_FLAG=1, 1, 0)) ACTUAL_NUM, \
												SUM( IF ( IFNULL(ehr.CORRECT_FLAG, 0) = 2, 1, 0 )) MARKED_NUM, SUM( IF ( ISNULL(ehr.CORRECT_FLAG) = 1, 0, IF (ehr.CORRECT_FLAG = 2, 0, 1))) UNMARKED_NUM \
												FROM ( \
													SELECT ehc.HW_ID, eh.HW_NAME, ehc.START_TIME, ehc.END_TIME, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM \
													FROM c_teacher AS ct, e_hw_class ehc, e_homework eh, c_class AS cc, w_sort AS ws, c_class_student AS ccs \
													WHERE ct.USER_ID = :USER_ID AND ehc.CREATOR = ct.USER_ID AND eh.HW_ID = ehc.HW_ID AND ws.SORT_ID = eh.SUBJECT_ID AND cc.CLASS_ID = ehc.CLASS_ID AND ccs.CLASS_ID = cc.CLASS_ID \
													AND EXISTS ( SELECT 1 FROM c_lesson AS cl, c_lesson_class AS clc WHERE cl.TEACHER_ID = ct.TEACHER_ID AND cl.EXIST_FLAG = 1 AND clc.LESSON_ID = cl.LESSON_ID AND ehc.CLASS_ID = clc.CLASS_ID ) \
													GROUP BY ehc.HW_ID, eh.HW_NAME, ehc.END_TIME, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME ) c \
												LEFT JOIN e_hw_record ehr ON ehr.HW_ID = c.HW_ID AND ehr.CLASS_ID = c.CLASS_ID \
												GROUP BY c.HW_ID, c.HW_NAME, c.END_TIME, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM \
												ORDER BY c.END_TIME DESC, c.SORT_ID, c.CLASS_NAME
												
homework.teacher.get.correctinfo.by.hwid.classid= SELECT ccs.CLASS_ID, cs.STUDENT_NO, cs.STUDENT_NAME, ehr.SCORE, ehr.STAR, ehr.COMMIT_FLAG, ehr.CORRECT_FLAG, eh.HW_ID, ehr.HW_REC_ID, ehr.COMMIT_TIME, su.photo, \
												IF ( ehr.CORRECT_FLAG <> 2, NULL, CONCAT( TRUNCATE ((c.RIGHT_NUM / eh.TOPIC_NUM) * 100, 1 ), '%' )) RIGHT_PERCENT FROM c_class_student ccs \
												JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID JOIN s_user su ON su.user_id = cs.USER_ID JOIN e_homework eh ON eh.HW_ID = :HW_ID \
												LEFT JOIN e_hw_record ehr ON ehr.HW_ID = eh.HW_ID AND ehr.STUDENT_ID = cs.STUDENT_ID LEFT JOIN ( SELECT ehr.HW_REC_ID, SUM( IF (ehrd.SCORE = ehq.SCORE, 1, 0)) RIGHT_NUM FROM e_hw_record ehr \
												JOIN e_hw_question ehq ON ehq.HW_ID = ehr.HW_ID LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID \
												WHERE ehr.HW_ID = :HW_ID AND ehr.CLASS_ID = :CLASS_ID GROUP BY ehr.HW_REC_ID ) c ON c.HW_REC_ID = ehr.HW_REC_ID WHERE ccs.CLASS_ID = :CLASS_ID ORDER BY ehr.COMMIT_FLAG DESC, ehr.CORRECT_FLAG, cs.STUDENT_NO
													
homework.teacher.get.questionsinfo.by.hwrecid = SELECT ehq.QUES_ID, ehq.M_TOPIC, IF (ehrd.SCORE = -1, 4, 2) QUES_FLAG FROM e_hw_record ehr \
												JOIN e_hw_question ehq ON ehq.HW_ID = ehr.HW_ID \
												JOIN e_question eq ON eq.QUES_TYPE <> 6 AND eq.QUES_ID = ehq.QUES_ID \
												LEFT JOIN e_hw_record_detail ehrd ON ehrd.QUES_ID = ehq.QUES_ID AND ehrd.HW_REC_ID = ehr.HW_REC_ID \
												WHERE ehr.HW_REC_ID = :HW_REC_ID ORDER BY ehq.M_TOPIC

homework.teacher.get.correctnum.by.hwrecid= SELECT COUNT(eq.QUES_ID) SUBJECTIVE_NUM, SUM(IF(ehrd.SCORE = - 1, 0, 1)) MARKED_NUM, ehr.CORRECT_FLAG, ehr.STAR, ehr.REMARK, ehr.CLASS_ID, cs.STUDENT_NAME, ehr.COMMENT_REC \
											FROM e_hw_record AS ehr, e_hw_question AS ehq, e_question AS eq, e_hw_record_detail AS ehrd, c_student AS cs WHERE \
											ehr.HW_REC_ID = :HW_REC_ID AND ehq.HW_ID = ehr.HW_ID AND eq.QUES_ID = ehq.QUES_ID AND eq.QUES_TYPE IN (4, 5) AND ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = eq.QUES_ID AND cs.STUDENT_ID = ehr.STUDENT_ID

homework.teacher.get.studenthomework= SELECT sa.SCORE, sa.O_SCORE, sa.M_TOPIC, sa.QUES_ID, sa.QUES_CONTENT, sa.OPTION_NUM, sa.QUES_TYPE, sa.REMARK, sa.KNOWLEDGE_POINT, sa.KEYWORD, sa.STU_OSCORE, \
										sa.STU_SCORE, sa.QUES_REFER, sa.COMMENT_REC, sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, cp.ANSWER_TOTAL, \
										IF ( cp.ANSWER_TOTAL = 0, 0, CONCAT( TRUNCATE ( cp.CORRECT_NUM / cp.ANSWER_TOTAL, 2 ) * 100, "%" )) CORRECT_PERCENT, \
										eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, eo.OPT_CONTENT, eo.OPT_ID, eo.OPT_REFER, eo.OPT_NO \
										FROM e_homework eh JOIN (SELECT ehq.HW_ID, ehq.QUES_ID, SUM( IF ( IFNULL(ehrd.SCORE, 0) >= ehq.SCORE, 1, 0 )) CORRECT_NUM, SUM( IF ( ISNULL(ehrd.STUDENT_ANSWER) = 1, 0, 1 )) ANSWER_TOTAL \
										FROM e_hw_question ehq LEFT JOIN e_hw_record_detail ehrd ON ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID GROUP BY ehq.QUES_ID) cp ON cp.HW_ID = eh.HW_ID \
										JOIN ( SELECT ehq.HW_ID, ehq.QUES_ID, ehq.SCORE, ehq.O_SCORE, ehq.M_TOPIC, eq.QUES_CONTENT, eq.OPTION_NUM, eq.QUES_TYPE, eq.REMARK, \
										eq.KNOWLEDGE_POINT, eq.KEYWORD, eq.QUES_REFER, ehrd.SCORE STU_SCORE, ehrd.O_SCORE STU_OSCORE, ehrd.TEACHER_COMMENT, ehrd.ANSWER, \
										IF ( ehrd.SCORE >= ehq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), ehrd.STUDENT_ANSWER, "@#@#" ), ehrd.STUDENT_ANSWER ) STUDENT_ANSWER, ehrd.COMMENT_REC \
										FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID AND (eq.QUES_TYPE=4 OR eq.QUES_TYPE=5 OR eq.QUES_TYPE=6 OR -1=:QUES_TYPE) LEFT JOIN e_hw_record_detail ehrd \
										ON ehrd.HW_REC_ID = :HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID) sa ON sa.QUES_ID = cp.QUES_ID \
										LEFT JOIN e_option eo ON eo.QUES_ID = sa.QUES_ID LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM \
										FROM ( SELECT err.QUES_ID, err.OPT_NO, err.ERROR_NUM, IF ( @quesId = err.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := err.QUES_ID \
										FROM ( SELECT ehq.QUES_ID, eo.OPT_NO, SUM( IF ( ehrd.STUDENT_ANSWER LIKE CONCAT("%", eo.OPT_NO, "%"), 1, 0 )) ERROR_NUM \
										FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID JOIN e_option eo ON eo.QUES_ID = ehq.QUES_ID LEFT JOIN e_hw_record_detail ehrd ON ehrd.QUES_ID = ehq.QUES_ID \
										WHERE ehq.HW_ID = :HW_ID AND eq.QUES_TYPE IN (1, 2) AND eo.OPT_REFER <> 1 GROUP BY ehq.QUES_ID, eo.OPT_NO ORDER BY ehq.QUES_ID, ERROR_NUM DESC) err, \
										( SELECT @rankNo := 0, @quesId := NULL ) rn ) easyerr WHERE RANK_NO = 1 ) eaerr ON eaerr.QUES_ID = cp.QUES_ID WHERE eh.HW_ID = :HW_ID ORDER BY sa.M_TOPIC, eo.OPT_NO

homework.teacher.update.homeworkrecorddetailinfo= UPDATE e_hw_record_detail SET SCORE = :SCORE, O_SCORE = :O_SCORE, TEACHER_COMMENT = :TEACHER_COMMENT WHERE QUES_ID = :QUES_ID AND HW_REC_ID = :HW_REC_ID

homework.teacher.update.homeworkrecord.correctflag= UPDATE e_hw_record ehr SET CORRECT_FLAG = :CORRECT_FLAG, CREATOR = :CREATOR, STAR = :STAR, REMARK = :REMARK, \
													SCORE = ( SELECT SUM( IF (ehrd.score = - 1, 0, ehrd.score)) FROM e_hw_record_detail ehrd WHERE ehrd.HW_REC_ID = ehr.HW_REC_ID ) WHERE HW_REC_ID = :HW_REC_ID

homework.teacher.get.studentinfo.by.hwrecid= SELECT ehr.HW_ID, ehr.HW_REC_ID, ehr.STAR, cs.STUDENT_ID, cs.STUDENT_NO, cs.STUDENT_NAME \
											FROM e_hw_record ehr, c_student cs WHERE ehr.HW_REC_ID = :HW_REC_ID AND cs.STUDENT_ID = ehr.STUDENT_ID
												
homework.teacher.get.class.unmarkedinfo.by.hwrecid= SELECT c.HW_ID, c.HW_NAME, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM, COUNT(ehr.HW_REC_ID) ACTUAL_NUM, \
													SUM(IF(ehr.CORRECT_FLAG = 2, 1, 0)) MARKED_NUM, SUM( IF (ehr.CORRECT_FLAG <> 2, 1, 0)) UNMARKED_NUM \
													FROM ( SELECT eh.HW_ID, eh.HW_NAME, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM \
													FROM e_hw_record ehr, e_homework eh, w_sort ws, c_class_student ccs, c_class cc \
													WHERE ehr.HW_REC_ID = :HW_REC_ID AND eh.HW_ID = ehr.HW_ID AND ws.SORT_ID = ehr.SUBJECT_ID AND ccs.CLASS_ID = ehr.CLASS_ID AND cc.CLASS_ID = ehr.CLASS_ID \
													) c JOIN e_hw_record ehr ON ehr.CLASS_ID = c.CLASS_ID AND ehr.HW_ID = c.HW_ID

homework.teacher.get.nexthomework.by.hwrecid= SELECT ehr2.HW_ID, ehr2.HW_REC_ID FROM e_hw_record ehr1, e_hw_record ehr2 \
												WHERE ehr1.HW_REC_ID = :HW_REC_ID AND ehr2.HW_ID = ehr1.HW_ID AND ehr2.CLASS_ID = ehr1.CLASS_ID AND ehr2.CORRECT_FLAG <> 2 LIMIT 0, 1
												
homework.teacher.get.teacherid.by.userid= SELECT t.TEACHER_ID, t.SCHOOL_ID FROM c_teacher t, c_warranty w WHERE t.USER_ID = :USER_ID \
											AND t.SCHOOL_ID = w.SCHOOL_ID AND w.END_DATETIME > SYSDATE() AND w.START_DATETIME < SYSDATE() AND w.SERVICE_TYPE = 3

homework.teacher.delete.unstartedhwclass.by.hwid = DELETE FROM e_hw_class WHERE HW_ID = :HW_ID

homework.teacher.get.uncommit.students.by.hwid.classid= SELECT stus.STUDENT_ID, stus.STUDENT_NAME, stus.photo FROM ( SELECT cs.STUDENT_ID, cs.STUDENT_NAME, ehr.COMMIT_FLAG, su.photo \
														FROM c_class_student ccs JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID JOIN s_user su ON su.user_id = cs.USER_ID \
														LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = :HW_ID AND ehr.STUDENT_ID = ccs.STUDENT_ID \
														WHERE ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1) stus WHERE IFNULL(stus.COMMIT_FLAG, 0) <> 1

homework.teacher.get.studentsnum.of.star.by.hwid.classid= SELECT stars.STAR, SUM(1) STAR_NUM FROM ( SELECT IFNULL(ehr.STAR, 0) STAR FROM c_class_student ccs JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID \
															LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = :HW_ID AND ehr.STUDENT_ID = ccs.STUDENT_ID \
															WHERE ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1) stars GROUP BY stars.STAR

homework.teacher.get.students.of.star.by.hwid.classid = SELECT cs.STUDENT_NAME, IFNULL(ehr.STAR, 0) STAR, su.photo FROM c_class_student ccs JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID JOIN s_user su ON su.user_id = cs.USER_ID \
														LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = :HW_ID AND ehr.STUDENT_ID = cs.STUDENT_ID WHERE ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1

homework.teacher.get.studentsnum.of.questions.by.hwid.classid = SELECT ehq.QUES_ID, ehq.M_TOPIC, SUM( IF ( ISNULL(ehrd.HW_REC_ID) = 1, 1, IF (ehq.SCORE = ehrd.SCORE, 0, 1))) ERROR_NUM, SUM(1) CLASS_NUM FROM e_hw_question ehq \
																JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID AND eq.QUES_TYPE <> 6 JOIN c_class_student ccs ON ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1 \
																LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = ehq.HW_ID AND ehr.STUDENT_ID = ccs.STUDENT_ID \
																LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID GROUP BY ehq.M_TOPIC ORDER BY ehq.M_TOPIC

homework.teacher.get.errorstudents.of.questions.by.hwid.classid= SELECT c.M_TOPIC, c.STUDENT_NAME, c.photo FROM ( \
																	SELECT ehq.M_TOPIC, IF ( ISNULL(ehrd.HW_REC_ID) = 1, cs.STUDENT_NAME, IF ( ehrd.SCORE <> ehq.SCORE, cs.STUDENT_NAME, NULL )) STUDENT_NAME, su.photo \
																	FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID AND eq.QUES_TYPE <> 6 JOIN c_class_student ccs ON ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1 \
																	JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID JOIN s_user su ON su.user_id = cs.USER_ID \
																	LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = ehq.HW_ID AND ehr.STUDENT_ID = ccs.STUDENT_ID \
																	LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = eq.QUES_ID \
																	WHERE ehq.HW_ID = :HW_ID ) c WHERE ISNULL(c.STUDENT_NAME)=0 ORDER BY c.M_TOPIC

homework.teacher.get.num.of.options.by.hwid.classid= SELECT ehq.QUES_ID, eo.OPT_NO, SUM( IF ( ISNULL(ehrd.STUDENT_ANSWER) = 1, 0, IF ( ehrd.STUDENT_ANSWER LIKE CONCAT('%', eo.OPT_NO, '%'), 1, 0 ))) OPTION_NUM \
														FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID AND ( eq.QUES_TYPE = 1 OR eq.QUES_TYPE = 2 ) JOIN e_option eo ON eo.QUES_ID = eq.QUES_ID \
														LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = :CLASS_ID AND ehr.HW_ID = ehq.HW_ID LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID \
														WHERE ehq.HW_ID = :HW_ID GROUP BY ehq.QUES_ID, eo.OPT_ID ORDER BY ehq.M_TOPIC, eo.OPT_NO

homework.teacher.get.stunum.in.area.by.hwid.classid= SELECT c.STUDENT_ID, c.STUDENT_NAME, c.photo, CONCAT(c.ANSWER_TIME, '') ANSWER_TIME FROM ( SELECT cs.STUDENT_ID, cs.STUDENT_NAME, su.photo, \
													IFNULL(SUM(ehrd.ANSWER_TIME), 0) ANSWER_TIME FROM c_class_student ccs JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID JOIN s_user su ON su.user_id = cs.USER_ID \
													JOIN e_hw_record ehr ON ehr.STUDENT_ID = ccs.STUDENT_ID AND ehr.HW_ID = :HW_ID JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID WHERE \
													ccs.CLASS_ID = :CLASS_ID AND ccs.EXIST_FLAG = 1 GROUP BY cs.STUDENT_ID) c WHERE c.ANSWER_TIME > 59 ORDER BY c.ANSWER_TIME

homework.teacher.get.homeworkinfo.by.hwid= SELECT q.QUES_ID, q.QUES_TYPE, q.QUES_CONTENT, o.OPT_CONTENT, q.OPTION_NUM, ehq.SCORE, ehq.O_SCORE, o.OPT_ID, o.OPT_REFER, o.OPT_NO, q.REMARK, q.KNOWLEDGE_POINT, \
											q.KEYWORD, ehq.M_TOPIC, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, \
											eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM FROM e_homework eh JOIN e_hw_question ehq ON ehq.HW_ID = eh.HW_ID JOIN e_question q ON ehq.QUES_ID = q.QUES_ID LEFT JOIN e_option o ON q.QUES_ID = o.QUES_ID \
											LEFT JOIN ques_statistic qs ON qs.QUES_ID = ehq.QUES_ID LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( \
											SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn \
											) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = ehq.QUES_ID WHERE eh.HW_ID = :HW_ID ORDER BY ehq.M_TOPIC, OPT_NO

homework.teacher.get.students.of.options.by.hwid.classid= SELECT ehq.QUES_ID, eo.OPT_NO, cs.STUDENT_NAME FROM e_hw_question ehq, e_question eq, e_option eo, e_hw_record ehr, e_hw_record_detail ehrd, c_student cs WHERE \
															ehq.HW_ID = : HW_ID AND eq.QUES_ID = ehq.QUES_ID AND ( eq.QUES_TYPE = 1 OR eq.QUES_TYPE = 2 ) AND eo.QUES_ID = eq.QUES_ID AND ehr.CLASS_ID = : CLASS_ID AND ehr.HW_ID = ehq.HW_ID AND ehrd.HW_REC_ID = ehr.HW_REC_ID \
															AND ehrd.QUES_ID = ehq.QUES_ID AND ehrd.STUDENT_ANSWER LIKE CONCAT('%', eo.OPT_NO, '%') AND cs.STUDENT_ID = ehr.STUDENT_ID GROUP BY ehq.QUES_ID, eo.OPT_ID ORDER BY ehq.M_TOPIC, eo.OPT_NO

homework.teacher.get.classnum.by.classid= SELECT COUNT(STUDENT_ID) CLASS_NUM FROM c_class_student WHERE CLASS_ID = :CLASS_ID

homework.teacher.get.rightnum.of.question.by.hwid.classid.quesid= SELECT COUNT(ehq.QUES_ID) RIGHT_NUM FROM e_hw_question ehq, e_hw_record ehr, e_hw_record_detail ehrd WHERE ehq.HW_ID = :HW_ID \
																	AND ehq.QUES_ID = :QUES_ID AND ehr.CLASS_ID = :CLASS_ID AND ehr.HW_ID = ehq.HW_ID AND ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID AND ehq.SCORE = ehrd.SCORE

homework.teacher.get.students.of.question.right.by.hwid.classid.quesid= SELECT cs.STUDENT_NAME, su.photo FROM e_hw_record ehr, e_hw_record_detail ehrd, e_hw_question ehq, c_student cs, s_user su WHERE ehr.CLASS_ID = :CLASS_ID \
																		AND ehr.HW_ID = :HW_ID AND ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = :QUES_ID AND ehq.QUES_ID = ehrd.QUES_ID AND ehq.SCORE = ehrd.SCORE AND cs.STUDENT_ID = ehr.STUDENT_ID AND su.user_id = cs.USER_ID

homework.teacher.get.students.of.question.error.by.hwid.classid.quesid= SELECT c.STUDENT_NAME, c.photo FROM ( SELECT cs.STUDENT_NAME, su.photo, ehr.HW_REC_ID, ehrd.SCORE STU_SCORE, ehq.SCORE FROM c_class_student ccs JOIN c_student cs ON cs.STUDENT_ID = ccs.STUDENT_ID \
																		JOIN s_user su ON su.user_id = cs.USER_ID JOIN e_hw_question ehq ON ehq.QUES_ID = :QUES_ID AND ehq.HW_ID = :HW_ID LEFT JOIN e_hw_record ehr ON ehr.CLASS_ID = ccs.CLASS_ID AND ehr.HW_ID = ehq.HW_ID AND ehr.STUDENT_ID = ccs.STUDENT_ID \
																		LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ccs.CLASS_ID = :CLASS_ID) c WHERE ISNULL(c.HW_REC_ID) = 1 OR c.SCORE <> c.STU_SCORE

homework.teacher.get.studentsnum.of.options.by.hwid.classid.quesid= SELECT eo.OPT_NO, SUM( IF ( ISNULL(ehrd.HW_REC_ID) = 1, 0, 1 )) STU_NUM FROM e_option eo JOIN e_question eq ON eq.QUES_ID = eo.QUES_ID AND (eq.QUES_TYPE=1 OR eq.QUES_TYPE=2) LEFT JOIN e_hw_record ehr ON ehr.HW_ID = :HW_ID AND ehr.CLASS_ID = :CLASS_ID \
																	LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = eo.QUES_ID AND ehrd.STUDENT_ANSWER LIKE CONCAT('%', eo.OPT_NO, '%') WHERE eo.QUES_ID = :QUES_ID GROUP BY eo.OPT_NO

homework.teacher.get.studentsname.of.options.by.hwid.classid.quesid= SELECT eo.OPT_NO, cs.STUDENT_NAME, su.photo FROM e_hw_record ehr, e_hw_record_detail ehrd, e_question eq, e_option eo, c_student cs, s_user su WHERE ehr.HW_ID = :HW_ID \
																		AND ehr.CLASS_ID = :CLASS_ID AND ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = :QUES_ID AND eq.QUES_ID = ehrd.QUES_ID AND ( eq.QUES_TYPE = 1 OR eq.QUES_TYPE = 2 ) \
																		AND eo.QUES_ID = eq.QUES_ID AND ehrd.STUDENT_ANSWER LIKE CONCAT('%', eo.OPT_NO, '%') AND cs.STUDENT_ID = ehr.STUDENT_ID AND su.user_id = cs.USER_ID ORDER BY eo.OPT_NO

homework.teacher.update.releaseflag.of.ques= UPDATE e_question eq SET eq.RELEASE_FLAG = :RELEASE_FLAG WHERE EXISTS(SELECT 1 FROM e_hw_question ehq WHERE ehq.HW_ID = :HW_ID AND ehq.QUES_ID = eq.QUES_ID) AND eq.RELEASE_FLAG = 0

homework.teacher.update.recorddetail.commentrec= UPDATE e_hw_record_detail SET COMMENT_REC = :COMMENT_REC WHERE HW_REC_ID = :HW_REC_ID AND QUES_ID = :QUES_ID

homework.teacher.update.record.commentrec= UPDATE e_hw_record SET COMMENT_REC = :COMMENT_REC WHERE HW_REC_ID = :HW_REC_ID

homework.teacher.update.quesrec= UPDATE e_question SET QUES_REC = :QUES_REC WHERE QUES_ID = :QUES_ID

homework.get.quesids.of.hw= SELECT QUES_ID FROM e_hw_question WHERE HW_ID = :HW_ID

homework.get.last.mtopic.of.hw= SELECT MAX(M_TOPIC) M_TOPIC FROM e_hw_question WHERE HW_ID = :HW_ID

############################################
#
#HOMEWORK-STUDENT
#
############################################
homework.student.get.homework.by.userid= SELECT eh.HW_NAME, ws.SORT_NAME, eh.HW_ID, eh.TOPIC_NUM, eh.RELEASE_TIME, ehr.COMMIT_FLAG, ehr.HW_REC_ID, \
										DATE_FORMAT( ehc.START_TIME, '%Y-%m-%d %T' ) START_TIME, DATE_FORMAT(ehc.END_TIME, '%Y-%m-%d %T') END_TIME, DATE_FORMAT(ehc.START_TIME, '%c.%e %H:%i') FORMAT_START_TIME, DATE_FORMAT(ehc.END_TIME, '%c.%e %H:%i') FORMAT_END_TIME \
										FROM c_student cs JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID AND ccs.EXIST_FLAG = 1 \
										JOIN e_hw_class ehc ON ehc.CLASS_ID = ccs.CLASS_ID AND ehc.END_TIME > DATE_SUB(CURDATE(), INTERVAL 1 DAY) \
										JOIN e_homework eh ON eh.HW_ID = ehc.HW_ID JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID \
										LEFT JOIN e_hw_record ehr ON ehr.HW_ID = eh.HW_ID AND ehr.STUDENT_ID = cs.STUDENT_ID \
										WHERE cs.USER_ID = :USER_ID ORDER BY ehc.START_TIME DESC
											
homework.student.get.hwrecordinfo.by.hwid.userid = SELECT eh.SUBJECT_ID, cs.STUDENT_ID, csc.CLASS_ID, ehc.START_TIME, ehc.END_TIME FROM e_homework eh, c_student cs, c_class_student csc, e_hw_class ehc \
													WHERE eh.HW_ID = :HW_ID AND cs.USER_ID = :USER_ID AND csc.STUDENT_ID = cs.STUDENT_ID
													
homework.student.save.ehomeworkrecord =	INSERT INTO e_hw_record(HW_REC_ID, USER_ID, SUBJECT_ID, HW_ID, FINISHED_NUM, CORRECT_FLAG, COMMIT_FLAG, COMMIT_TIME, SCORE, STUDENT_ID, CLASS_ID, STAR, REMARK) \
										VALUES(:HW_REC_ID, :USER_ID, :SUBJECT_ID, :HW_ID, :FINISHED_NUM, :CORRECT_FLAG, :COMMIT_FLAG, :COMMIT_TIME, :SCORE, :STUDENT_ID, :CLASS_ID, :STAR, :REMARK)

homework.student.delete.hwrecdetail.by.hwrecid = DELETE FROM e_hw_record_detail WHERE HW_REC_ID = :HW_REC_ID

homework.student.get.answers.by.hwid = SELECT ehq.QUES_ID, o.OPT_ID, ehq.O_SCORE, o.OPT_REFER, eq.OPTION_NUM, eq.QUES_TYPE FROM e_hw_question ehq JOIN e_option o ON ehq.QUES_ID = o.QUES_ID JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID =:HW_ID

homework.student.save.ehomeworkrecorddetail = INSERT INTO e_hw_record_detail (HW_REC_ID, QUES_ID, ANSWER, STUDENT_ANSWER, SCORE, O_SCORE, TEACHER_COMMENT, ANSWER_TIME, REMARK) \
												VALUES(:HW_REC_ID, :QUES_ID, :ANSWER, :STUDENT_ANSWER, :SCORE, :O_SCORE, :TEACHER_COMMENT, :ANSWER_TIME, :REMARK)
												
homework.student.update.ehomeworkrecord = UPDATE e_hw_record SET COMMIT_FLAG = :COMMIT_FLAG, SCORE = :SCORE, FINISHED_NUM = :FINISHED_NUM, COMMIT_TIME = :COMMIT_TIME WHERE HW_REC_ID = :HW_REC_ID

homework.student.get.hwfinishednum.by.hwrecid = SELECT FINISHED_NUM FROM e_hw_record WHERE HW_REC_ID = :HW_REC_ID

homework.update.hwrecorddetailscore.by.hwrecid = UPDATE e_hw_record_detail AS ehrd INNER JOIN ( \
													SELECT ehrd1.QUES_ID, IF ( ehrd1.STUDENT_ANSWER = q.QUES_REFER, ehq.SCORE, 0 ) SCORE \
													FROM e_hw_record_detail AS ehrd1, e_question AS q, e_hw_record AS ehr, e_hw_question AS ehq \
													WHERE ehrd1.HW_REC_ID = :HW_REC_ID AND q.QUES_ID = ehrd1.QUES_ID AND q.QUES_TYPE <> 4 AND q.QUES_TYPE <> 5 \
													AND ehr.HW_REC_ID = ehrd1.HW_REC_ID AND ehq.QUES_ID = ehrd1.QUES_ID AND ehq.HW_ID = ehr.HW_ID \
													) AS sqs ON (sqs.QUES_ID = ehrd.QUES_ID) \
													SET ehrd.SCORE = sqs.SCORE WHERE ehrd.HW_REC_ID = :HW_REC_ID
													
homework.student.get.autocorrectflag.by.hwrecid = SELECT ehc.CORRECT FROM e_hw_record ehr, e_hw_class ehc WHERE ehr.HW_REC_ID = :HW_REC_ID AND ehc.HW_ID = ehr.HW_ID AND ehc.CLASS_ID = ehr.CLASS_ID

homework.student.update.hwrecordcorrectinfo = UPDATE e_hw_record ehr SET CORRECT_FLAG = :CORRECT_FLAG, CREATOR = :CREATOR, SCORE = ( SELECT SUM( IF (ehrd.score =- 1, 0, ehrd.score)) FROM e_hw_record_detail ehrd WHERE ehrd.HW_REC_ID = ehr.HW_REC_ID ) WHERE HW_REC_ID = :HW_REC_ID

homework.student.get.hwclssinfo.by.hwrecid = SELECT ehc.CLASS_ID, ehc.CORRECT, ehc.CREATOR, DATE_FORMAT(ehc.END_TIME, '%Y-%m-%d %T') END_TIME, ehc.HW_ID, ehc.REMARK, DATE_FORMAT( ehc.START_TIME, '%Y-%m-%d %T' ) START_TIME FROM e_hw_record ehr, e_hw_class ehc WHERE ehr.HW_REC_ID = :HW_REC_ID AND ehc.HW_ID = ehr.HW_ID AND ehc.CLASS_ID = ehr.CLASS_ID

homework.student.get.questionsinfo.by.hwrecid= SELECT ehq.QUES_ID, ehq.M_TOPIC, IF ( ISNULL(ehrd.STUDENT_ANSWER) = 1, 4, IF (ehrd.STUDENT_ANSWER = '', 4, 2)) QUES_FLAG FROM e_hw_record ehr \
												JOIN e_hw_question ehq ON ehq.HW_ID = ehr.HW_ID JOIN e_question eq ON ehq.QUES_ID = eq.QUES_ID AND eq.QUES_TYPE <> 6 \
												LEFT JOIN e_hw_record_detail ehrd ON ehr.HW_REC_ID = ehrd.HW_REC_ID AND ehq.QUES_ID = ehrd.QUES_ID WHERE ehr.HW_REC_ID = :HW_REC_ID ORDER BY ehq.M_TOPIC
												
homework.student.update.ehomeworkrecord.star.by.hwrecid = UPDATE e_hw_record ehr, ( SELECT ehr1.HW_ID, (ehr1.SCORE / SUM(ehq.SCORE)) * 100 HW_SCORE FROM e_hw_record ehr1, e_hw_question ehq \
															WHERE ehr1.HW_REC_ID = :HW_REC_ID AND ehq.HW_ID = ehr1.HW_ID) hwscore SET STAR = ( \
															CASE WHEN HW_SCORE = 100 THEN 5 WHEN HW_SCORE >= 80 THEN 4 WHEN HW_SCORE >= 60 THEN \
															3 WHEN HW_SCORE >= 40 THEN 2 WHEN HW_SCORE > 0 THEN 1 ELSE 0 END) WHERE ehr.HW_REC_ID = :HW_REC_ID AND hwscore.HW_ID = ehr.HW_ID

homework.student.get.hwrecord.by.hwrecid = SELECT ehr.CLASS_ID, ehr.COMMIT_FLAG, ehr.COMMIT_TIME, ehr.CORRECT_FLAG, ehr.CREATOR, ehr.FINISHED_NUM, ehr.HW_ID, ehr.HW_REC_ID, ehr.REMARK, ehr.SCORE, ehr.STAR, ehr.STUDENT_ID, ehr.SUBJECT_ID, ehr.USER_ID, ehc.START_TIME, ehc.END_TIME, ehc.CORRECT, ehr.COMMENT_REC \
											FROM e_hw_record ehr, e_hw_class ehc WHERE ehr.HW_REC_ID = :HW_REC_ID AND ehc.HW_ID = ehr.HW_ID AND ehc.CLASS_ID = ehr.CLASS_ID
											
													
homework.student.get.commitedhomeworks.by.userid= SELECT ehr.HW_ID, ehr.HW_REC_ID, eh.HW_NAME, DATE_FORMAT( ehc.END_TIME, '%Y-%m-%d %h:%i' ) END_TIME, ws.SORT_NAME, ehr.STAR \
													FROM e_hw_record ehr, e_homework eh, w_sort ws, e_hw_class ehc \
													WHERE ehr.USER_ID = :USER_ID AND ehr.COMMIT_FLAG = 1 AND ehr.CORRECT_FLAG = 2 AND eh.HW_ID = ehr.HW_ID \
													AND ws.SORT_ID = ehr.SUBJECT_ID AND ehc.HW_ID = ehr.HW_ID AND ehc.CLASS_ID = ehr.CLASS_ID ORDER BY ehc.END_TIME DESC

homework.student.get.questions.by.hwid.hwrecid= SELECT sa.SCORE, sa.O_SCORE, sa.M_TOPIC, sa.QUES_ID, sa.QUES_TYPE, sa.QUES_CONTENT, sa.OPTION_NUM, sa.REMARK, sa.KNOWLEDGE_POINT, \
												sa.KEYWORD, sa.STU_OSCORE, sa.STU_SCORE, sa.QUES_REFER, sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, sa.FORMAT_TIME, sa.ANSWER_TIME, sa.FAV_FLAG, sa.QUES_REC, sa.COMMENT_REC, sa.DIFFICULTY, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
												IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE (qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, \
												eo.OPT_CONTENT, eo.OPT_ID, eo.OPT_REFER, eo.OPT_NO, note.NOTE_ID, note.CONTENT \
												FROM e_homework eh JOIN e_hw_question ehq ON ehq.HW_ID = eh.HW_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = ehq.QUES_ID \
												LEFT JOIN (SELECT ehq.HW_ID, ehq.QUES_ID, ehq.SCORE, ehq.O_SCORE, ehq.M_TOPIC, eq.QUES_CONTENT, eq.OPTION_NUM, \
												eq.QUES_TYPE, eq.REMARK, eq.KNOWLEDGE_POINT, eq.KEYWORD, eq.QUES_REFER, eq.DIFFICULTY, ehrd.SCORE STU_SCORE, \
												ehrd.O_SCORE STU_OSCORE, ehrd.TEACHER_COMMENT, ehrd.ANSWER, IF ( ISNULL(ehrd.ANSWER_TIME) = 1, CONCAT(0, '\u79D2'), IF ( ehrd.ANSWER_TIME < 60, CONCAT(ehrd.ANSWER_TIME, '\u79D2'), \
												CONCAT( FLOOR(ehrd.ANSWER_TIME / 60), '\u5206', ehrd.ANSWER_TIME % 60, '\u79D2' ))) FORMAT_TIME,ehrd.ANSWER_TIME, \
												IF ( ehrd.SCORE >= ehq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), ehrd.STUDENT_ANSWER, "@#@#" ), ehrd.STUDENT_ANSWER) STUDENT_ANSWER, IF(ISNULL(suf.OBJ_ID)=1, 0, 1) FAV_FLAG, eq.QUES_REC,ehrd.COMMENT_REC \
												FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID JOIN e_hw_record ehr ON ehr.HW_REC_ID = :HW_REC_ID LEFT JOIN e_hw_record_detail ehrd \
												ON ehrd.HW_REC_ID = :HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID LEFT JOIN s_user_fav suf ON suf.USER_ID = ehr.USER_ID AND suf.FAV_TYPE = '10' AND suf.OBJ_ID = ehq.QUES_ID \
												WHERE ehq.HW_ID = :HW_ID ) sa ON sa.QUES_ID = ehq.QUES_ID \
												LEFT JOIN e_option eo ON eo.QUES_ID = ehq.QUES_ID LEFT JOIN e_note note ON note.QUES_ID = ehq.QUES_ID \
												LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( \
												SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
												FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn ) easy_error_opt WHERE RANK_NO = 1 ) eaerr ON eaerr.QUES_ID = ehq.QUES_ID \
												WHERE eh.HW_ID = :HW_ID ORDER BY sa.M_TOPIC, eo.OPT_NO
													
homework.student.get.questionsflag.by.hwrecid= SELECT ehq.QUES_ID, ehq.M_TOPIC, IF ( ISNULL(ehrd.STUDENT_ANSWER) = 1, 4, IF (ehrd.SCORE = ehq.SCORE, 3, 1)) QUES_FLAG \
												FROM e_hw_record_detail AS ehrd, e_hw_record AS ehr, e_hw_question AS ehq WHERE ehrd.HW_REC_ID = :HW_REC_ID \
												AND ehr.HW_REC_ID = ehrd.HW_REC_ID AND ehq.HW_ID = ehr.HW_ID AND ehq.QUES_ID = ehrd.QUES_ID ORDER BY ehq.M_TOPIC

homework.teacher.get.studentid.by.userid= SELECT t.USER_ID FROM c_student t, c_class_student cc, c_class c, c_grade g, c_warranty w WHERE t.USER_ID = :USER_ID \
											AND t.STUDENT_ID = cc.STUDENT_ID AND cc.CLASS_ID = c.CLASS_ID AND c.GRADE_ID = g.GRADE_ID AND g.SCHOOL_ID = w.SCHOOL_ID \
											AND w.END_DATETIME > SYSDATE() AND w.START_DATETIME < SYSDATE() AND w.SERVICE_TYPE = 3

homework.teacher.get.class.basiccorrectinfo.by.hwid.classid= SELECT c.HW_ID, c.HW_NAME, c.SORT_ID, c.SORT_NAME, c.CLASS_ID, c.CLASS_NAME, c.CLASS_NUM, SUM( IF ( ISNULL(ehr.HW_REC_ID) = 0 && ehr.COMMIT_FLAG = 1, 1, 0 )) ACTUAL_NUM, \
															SUM( IF ( IFNULL(ehr.CORRECT_FLAG, 0) = 2, 1, 0 )) MARKED_NUM, SUM( IF ( ISNULL(ehr.CORRECT_FLAG) = 1, 0, IF (ehr.CORRECT_FLAG = 2, 0, 1))) UNMARKED_NUM \
															FROM ( SELECT eh.HW_ID, eh.HW_NAME, ws.SORT_ID, ws.SORT_NAME, cc.CLASS_ID, cc.CLASS_NAME, COUNT(ccs.STUDENT_ID) CLASS_NUM FROM e_homework eh, c_class AS cc, w_sort AS ws, c_class_student AS ccs WHERE \
															eh.HW_ID = :HW_ID AND ws.SORT_ID = eh.SUBJECT_ID AND cc.CLASS_ID = :CLASS_ID AND ccs.CLASS_ID = cc.CLASS_ID ) c LEFT JOIN e_hw_record ehr ON ehr.HW_ID = c.HW_ID AND ehr.CLASS_ID = c.CLASS_ID

homework.stuent.get.hwrecid.by.hwid.userid= SELECT HW_REC_ID FROM e_hw_record WHERE HW_ID = :HW_ID AND USER_ID = :USER_ID

homework.student.get.normalquestions.by.quesid= SELECT QUES_ID FROM e_question WHERE REMARK = :QUES_ID

homework.student.get.favoritekps.by.userid.subjectid= SELECT result.KP_ID, result.KP_NAME, result.P_KP_ID, SUM(result.TOTAL) TOTAL FROM ( SELECT KP_ID, KP_NAME, P_KP_ID, COUNT(QUES_ID) TOTAL FROM ( SELECT DISTINCT k.KP_ID, k.KP_NO, k.KP_NAME, eq2.QUES_ID, \
														eq2.KNOWLEDGE_POINT, k.P_KP_ID FROM s_user_fav suf, e_question eq, e_question eq2, e_ques_kp qk, e_kp_rel kr, e_knowledge k WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID AND eq.QUES_ID = suf.OBJ_ID \
														AND ( eq.SUBJECT_NO = :SUBJECT_ID OR - 1 = :SUBJECT_ID ) AND ( eq.QUES_TYPE = 6 OR ( eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 )) AND ( eq2.QUES_ID = eq.QUES_ID OR IFNULL(eq2.REMARK, 0) = eq.QUES_ID ) \
														AND qk.QUES_ID = eq2.QUES_ID AND kr.SUB_KP_ID = qk.KP_ID AND k.KP_ID = kr.KP_ID ) c GROUP BY KP_ID, KP_NAME, P_KP_ID ) result GROUP BY result.KP_ID, result.KP_NAME, result.P_KP_ID

homework.student.get.favorite.normalquestions.by.userid.kpid= SELECT DISTINCT eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, \
																IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, \
																note.CONTENT FROM s_user_fav suf JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID AND eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 JOIN e_ques_kp qk ON qk.QUES_ID = eq.QUES_ID \
																JOIN e_kp_rel kr ON kr.SUB_KP_ID = qk.KP_ID AND kr.KP_ID = :KP_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID LEFT JOIN user_ques_record_view uqrv ON uqrv.QUES_ID = eq.QUES_ID \
																AND uqrv.USER_ID = :USER_ID LEFT JOIN e_note note ON note.QUES_ID = eq.QUES_ID LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, \
																IF ( @quesId = eov.QUES_ID, @rankNo := @rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn ) easy_error_opt WHERE RANK_NO = 1 ) eaerr \
																ON eaerr.QUES_ID = eq.QUES_ID WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID

homework.student.get.options.of.favorite.normalquestion.by.userid.kpid = SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( SELECT DISTINCT ek2.KP_ID, eq.QUES_ID FROM s_user_fav suf \
																		JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID AND eq.QUES_TYPE <> 6 AND ISNULL(eq.REMARK) = 1 \
																		JOIN e_knowledge ek1 ON ( eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) \
																		JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
																		WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID) c, e_option eo WHERE eo.QUES_ID = c.QUES_ID

homework.student.get.favorite.articequestion.by.userid.kpid= SELECT DISTINCT equ.QUES_ID, equ.QUES_TYPE, equ.QUES_CONTENT, equ.KEYWORD, equ.KNOWLEDGE_POINT, equ.REMARK, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, \
																IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT \
																FROM s_user_fav suf JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID AND eq.QUES_TYPE = 6 JOIN e_question equ ON equ.QUES_ID = eq.QUES_ID OR equ.REMARK = eq.QUES_ID \
																JOIN e_knowledge ek1 ON ( equ.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR equ.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) \
																JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
																LEFT JOIN ques_statistic qs ON qs.QUES_ID = equ.QUES_ID LEFT JOIN user_ques_record_view uqrv ON uqrv.QUES_ID = equ.QUES_ID AND uqrv.USER_ID = :USER_ID LEFT JOIN e_note note ON note.QUES_ID = equ.QUES_ID LEFT JOIN ( \
																SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo := @rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
																FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn ) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = equ.QUES_ID WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID

homework.student.get.options.of.favorite.articlequestion.by.userid.kpid= SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( SELECT DISTINCT ek2.KP_ID, equ.QUES_ID FROM s_user_fav suf \
																		JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID AND eq.QUES_TYPE = 6 JOIN e_question equ ON equ.QUES_ID = eq.QUES_ID OR equ.REMARK = eq.QUES_ID \
																		JOIN e_knowledge ek1 ON ( equ.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR equ.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) \
																		JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
																		WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID) c,e_option eo WHERE eo.QUES_ID = c.QUES_ID

homework.student.get.errorqueskps= SELECT KP_ID, KP_NAME, P_KP_ID, COUNT(DISTINCT QUES_ID) TOTAL FROM ( SELECT ek.KP_ID, ek.KP_NO, ek.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, ek.P_KP_ID \
									FROM e_rec_detail_view erdv, e_question eq, e_ques_kp qk, e_kp_rel kr, e_knowledge ek WHERE erdv.USER_ID = :USER_ID AND erdv.QUES_FLAG = 1 AND erdv.QUES_ID = eq.QUES_ID \
									AND eq.TS_ID = :TS_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID OR IFNULL(eq.REMARK, 0) = CAST(seq.QUES_ID AS CHAR)) \
									AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND qk.QUES_ID = eq.QUES_ID AND kr.SUB_KP_ID = qk.KP_ID AND ek.KP_ID = kr.KP_ID ) c GROUP BY KP_ID, KP_NAME, P_KP_ID ORDER BY KP_ID

homework.student.get.errorquespage= SELECT eq.QUES_ID, eq.RESOURCE, IF ( LENGTH(eq.RESOURCE) > 31, CONCAT(LEFT(eq.RESOURCE, 10), '...'), eq.RESOURCE ) FORMAT_RESOURCE, eq.GRADE_LEVEL, eq.INPUT_TIME, eq.QUES_TYPE, \
									eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, eq.RELEASE_FLAG, eq.SHARE_FLAG, eq.REMARK FROM e_rec_detail_view erdv, e_question eq, e_ques_kp qk, e_kp_rel kr WHERE erdv.USER_ID = :USER_ID \
									AND erdv.QUES_FLAG = 1 AND erdv.QUES_ID = eq.QUES_ID AND eq.TS_ID = :TS_ID AND eq.SUBJECT_NO = :SUBJECT_ID AND EXISTS ( SELECT 1 FROM e_question seq WHERE ( seq.QUES_ID = eq.QUES_ID \
									OR IFNULL(eq.REMARK, 0) = CAST(seq.QUES_ID AS CHAR)) AND seq.QUES_CONTENT LIKE CONCAT('%', :KEYWORD, '%')) AND qk.QUES_ID = eq.QUES_ID AND kr.SUB_KP_ID = qk.KP_ID AND kr.KP_ID = :KP_ID

homework.student.get.errorquestions= SELECT c.*, aeq.QUES_CONTENT ART_CONTENT, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, IFNULL(qs.QUES_TOTAL_NUM, 0) QUES_TOTAL_NUM, IFNULL(qs.QUES_RIGHT_NUM, 0) QUES_RIGHT_NUM, quv.USE_TIMES, \
									IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, \
									eaerr.OPT_NO EASY_ERROR_OPT, IFNULL(eaerr.ERROR_NUM, 0) ERROR_NUM FROM (${homework.student.get.errorquespage} LIMIT :PAGE_START, :PAGE_SIZE) c \
									LEFT JOIN ques_statistic qs ON qs.QUES_ID = c.QUES_ID LEFT JOIN ques_usetimes_view quv ON quv.QUES_ID = c.QUES_ID LEFT JOIN e_question aeq ON aeq.QUES_ID = IFNULL(c.REMARK, 0) \
									LEFT JOIN user_ques_record_view uqrv ON uqrv.QUES_ID = c.QUES_ID AND uqrv.USER_ID = :USER_ID \
									LEFT JOIN (${exam.intelligentlychoose.get.easyerror}) eaerr ON eaerr.QUES_ID = c.QUES_ID ORDER BY c.INPUT_TIME DESC, c.QUES_ID

homework.student.get.options.of.errorquestions= SELECT DISTINCT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( ${homework.student.get.errorquespage} LIMIT :PAGE_START, :PAGE_SIZE ) c, e_option eo \
												WHERE eo.QUES_ID = c.QUES_ID ORDER BY c.INPUT_TIME DESC, c.QUES_ID

############################################
#
#ANDROID
#
############################################
android.get.userinfo.by.username.password = SELECT u.user_id, u.user_no, u.user_name, u.mail_address, u.`password`, u.photo, u.user_type, u.locked, u.last_visit, u.last_ip, u.credit, \
											u.regist_time, u.is_enterprise_user, u.session_num, u.ip_limit, u.isauthenmail, d.real_name, d.birth_date, \
											d.identityid, d.gender, d.phone, d.address, d.education, d.career, f.cash \
											FROM s_user AS u INNER JOIN s_user_detail AS d ON u.user_id = d.user_id INNER JOIN f_account AS f ON u.user_id = f.user_id \
											WHERE ( u.user_no = :USER_NO OR u.mail_address = :USER_NO OR d.phone = :USER_NO ) AND u.`password` = :PASSWORD

android.get.homeworks.by.userid= SELECT ehc.HW_ID, eh.HW_NAME, eh.TOPIC_NUM, ehr.HW_REC_ID, ct.TEACHER_NAME, su.photo, ws.SORT_NAME, UNIX_TIMESTAMP(ehc.START_TIME) * 1000 START_TIME, \
								UNIX_TIMESTAMP(ehc.END_TIME) * 1000 END_TIME, ehr.COMMIT_FLAG FROM c_student cs JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID AND ccs.EXIST_FLAG = 1 \
								JOIN e_hw_class ehc ON ehc.CLASS_ID = ccs.CLASS_ID AND ehc.END_TIME > NOW() JOIN e_homework eh ON eh.HW_ID = ehc.HW_ID JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID \
								JOIN s_user su ON su.user_id = ehc.CREATOR JOIN c_teacher ct ON ct.USER_ID = su.user_id LEFT JOIN e_hw_record ehr ON ehr.HW_ID = eh.HW_ID AND ehr.USER_ID = cs.USER_ID \
								WHERE cs.USER_ID = :USER_ID ORDER BY IFNULL(ehr.COMMIT_FLAG, 0), ehc.END_TIME


android.get.sortlistofstudent.by.userid= SELECT ws2.SORT_ID P_SORT_ID, ws2.SORT_NAME P_SORT_NAME, ws.SORT_ID, ws.SORT_NAME FROM c_student cs, w_sort ws, w_sort ws2 \
										 WHERE cs.USER_ID = :USER_ID AND EXISTS ( SELECT 1 FROM c_class_student ccs, c_lesson_class clc, c_lesson cl WHERE ccs.STUDENT_ID = cs.STUDENT_ID \
										 AND ccs.EXIST_FLAG = 1 AND clc.CLASS_ID = ccs.CLASS_ID AND clc.EXIST_FLAG = 1 AND cl.LESSON_ID = clc.LESSON_ID AND ws.SORT_ID = cl.SUBJECT_ID ) \
										 AND ws2.SORT_ID = ws.SORT_PARENT_ID ORDER BY ws.SORT_NO

android.get.statistic.by.userid.subjectid= SELECT COUNT(eh.HW_ID) * 5 TOTAL_STARNUM, IFNULL(SUM(IFNULL(ehr.STAR, 0)), 0) STUDENT_STARNUM \
											FROM c_student cs JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID AND ccs.EXIST_FLAG = 1 \
											JOIN e_hw_class ehc ON ehc.CLASS_ID = ccs.CLASS_ID AND ehc.END_TIME <= NOW() \
											JOIN e_homework eh ON eh.HW_ID = ehc.HW_ID AND (eh.SUBJECT_ID = :SUBJECT_ID OR -1 = :SUBJECT_ID) \
											LEFT JOIN e_hw_record ehr ON ehr.HW_ID = ehc.HW_ID AND ehr.USER_ID = cs.USER_ID AND CORRECT_FLAG = 2 \
											WHERE cs.USER_ID = :USER_ID

android.get.starnum.by.userid.subjectid= SELECT eh.HW_ID, eh.HW_NAME, ehr.HW_REC_ID, ws.SORT_NAME, su.photo, ct.TEACHER_NAME, IF ( ISNULL(ehr.STAR) = 1, 0, ehr.STAR ) STARNUM, ehc.START_TIME, ehc.END_TIME \
											FROM c_student cs JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID JOIN e_hw_class ehc ON ehc.CLASS_ID = ccs.CLASS_ID AND ehc.END_TIME <= NOW() \
											JOIN e_homework eh ON eh.HW_ID = ehc.HW_ID AND (eh.SUBJECT_ID = :SUBJECT_ID OR -1 = :SUBJECT_ID) \
											LEFT JOIN e_hw_record ehr ON ehr.USER_ID = cs.USER_ID AND ehr.HW_ID = eh.HW_ID AND ehr.CORRECT_FLAG = 2 \
											JOIN s_user su ON su.user_id = ehc.CREATOR JOIN c_teacher ct ON ct.USER_ID = su.user_id JOIN w_sort ws ON ws.SORT_ID = eh.SUBJECT_ID \
											WHERE cs.USER_ID = :USER_ID ORDER BY ehc.END_TIME DESC

android.get.hwinfo.by.userid.hwid= SELECT eh.HW_ID, eh.HW_NAME, eh.TOPIC_NUM, ehr.COMMIT_TIME, ehr.REMARK HW_COMMENT, \
									SUM( IF ( ISNULL(ehrd.SCORE) = 1, 0, IF (ehrd.SCORE >= ehq.SCORE, 1, 0))) RIGHT_NUM \
									FROM e_homework eh JOIN e_hw_question ehq ON ehq.HW_ID = eh.HW_ID \
									LEFT JOIN e_hw_record ehr ON ehr.HW_ID = eh.HW_ID AND ehr.USER_ID = :USER_ID \
									LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID \
									WHERE eh.HW_ID = :HW_ID

android.get.answercard.by.userid.hwid= SELECT ehq.QUES_ID, ehq.M_TOPIC, IF ( ISNULL(ehrd.STUDENT_ANSWER) = 1, 1, IF (ehrd.SCORE >= ehq.SCORE, 3, 2)) FLAG \
										FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID AND eq.QUES_TYPE <> 6 LEFT JOIN e_hw_record ehr ON ehr.HW_ID = ehq.HW_ID AND USER_ID = :USER_ID \
										LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID ORDER BY ehq.M_TOPIC

android.get.knowledgepoint.by.userid.hwid = SELECT KP_ID, KP_NAME, p_KP_ID, COUNT(QUES_ID) TOTAL, SUM(FLAG) RIGHT_NUM \
											FROM ( SELECT DISTINCT ek2.KP_ID, ek2.KP_NO, ek2.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, \
											IF ( IFNULL(ehrd.SCORE, 0) = ehq.SCORE, 1, 0 ) FLAG, ek2.P_KP_ID FROM e_hw_question ehq \
											JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID  AND eq.QUES_TYPE <> 6 \
											JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID,',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,',ek1.KP_ID,',%')) \
											JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO,'%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID \
											LEFT JOIN e_hw_record ehr ON ehr.HW_ID = ehq.HW_ID AND ehr.USER_ID = :USER_ID \
											LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = eq.QUES_ID \
											WHERE ehq.HW_ID = :HW_ID) c GROUP BY KP_ID, KP_NAME, P_KP_ID

android.get.all.questions.by.hwid.hwrecid= SELECT sa.QUES_ID, sa.M_TOPIC, sa.QUES_TYPE, sa.QUES_CONTENT, sa.REMARK, sa.KNOWLEDGE_POINT, sa.KEYWORD, sa.QUES_REFER, sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, sa.ANSWER_TIME, sa.FAV_FLAG, sa.O_SCORE, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
											IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT \
											FROM e_homework eh JOIN e_hw_question ehq ON ehq.HW_ID = eh.HW_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = ehq.QUES_ID \
											LEFT JOIN (SELECT ehq.HW_ID, ehq.QUES_ID, ehq.M_TOPIC, eq.QUES_CONTENT, eq.QUES_TYPE, eq.REMARK, eq.KNOWLEDGE_POINT, eq.KEYWORD, \
											eq.QUES_REFER, ehrd.TEACHER_COMMENT, ehrd.ANSWER, ehrd.ANSWER_TIME, ehrd.O_SCORE, IF ( ehrd.SCORE >= ehq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), ehrd.STUDENT_ANSWER, "@#@#" ), ehrd.STUDENT_ANSWER \
												) STUDENT_ANSWER,	IF(ISNULL(suf.OBJ_ID)=1, 0, 1) FAV_FLAG FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID \
											LEFT JOIN e_hw_record ehr ON ehr.HW_ID = ehq.HW_ID AND ehr.HW_REC_ID = :HW_REC_ID LEFT JOIN s_user_fav suf ON suf.FAV_TYPE = 10 AND suf.OBJ_ID = ehq.QUES_ID AND suf.USER_ID = ehr.USER_ID \
											LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID) sa ON sa.QUES_ID = ehq.QUES_ID \
											LEFT JOIN e_note note ON note.QUES_ID = ehq.QUES_ID LEFT JOIN ( SELECT QUES_ID, OPT_NO, ERROR_NUM FROM( \
											SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
											FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = ehq.QUES_ID WHERE eh.HW_ID = :HW_ID ORDER BY sa.M_TOPIC

android.get.options.by.hwid = SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_CONTENT, eo.OPT_REFER \
								FROM e_hw_question ehq, e_option eo WHERE ehq.HW_ID = :HW_ID AND eo.QUES_ID = ehq.QUES_ID ORDER BY eo.QUES_ID, eo.OPT_NO

android.save.note = INSERT INTO e_note(NOTE_ID, USER_ID, QUES_ID, COMMIT_TIME, CONTENT) VALUES(:NOTE_ID, :USER_ID, :QUES_ID, :COMMIT_TIME, :CONTENT)

android.update.note.by.noteid = UPDATE e_note SET COMMIT_TIME = :COMMIT_TIME, CONTENT = :CONTENT WHERE NOTE_ID = :NOTE_ID

android.get.favoriteknowledgepoints.by.userid.subjectid = SELECT KP_ID, KP_NAME, P_KP_ID, COUNT(QUES_ID) TOTAL FROM \
															( SELECT DISTINCT ek2.KP_ID, ek2.KP_NO, ek2.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, ek2.P_KP_ID \
															FROM s_user_fav suf JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID AND (eq.SUBJECT_NO = :SUBJECT_ID OR -1 = :SUBJECT_ID) \
															JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID,',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,',ek1.KP_ID,',%')) \
															JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO,'%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID \
															WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID)c GROUP BY KP_ID, KP_NAME, P_KP_ID

android.get.favorite.questions.basicinfo.by.userid.kpid= SELECT DISTINCT eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, 1 FAV_FLAG, \
															IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, equ.QUES_CONTENT ARTICLE, eaerr.OPT_NO EASY_ERROR_OPT, \
															eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT FROM s_user_fav suf JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID \
															JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%') ) \
															JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
															JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID LEFT JOIN user_ques_record_view uqrv ON uqrv.QUES_ID = eq.QUES_ID AND uqrv.USER_ID = :USER_ID \
															LEFT JOIN e_note note ON note.QUES_ID = eq.QUES_ID LEFT JOIN e_question equ ON equ.QUES_ID = eq.REMARK LEFT JOIN ( \
															SELECT QUES_ID, OPT_NO, ERROR_NUM FROM (SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo := @rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
															FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = eq.QUES_ID WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID

android.get.options.of.favoritequestions.by.userid.kpid= SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT \
															FROM ( SELECT DISTINCT ek2.KP_ID, eq.QUES_ID FROM s_user_fav suf \
															JOIN e_question eq ON eq.QUES_ID = suf.OBJ_ID \
															JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID,',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,',ek1.KP_ID,',%')) \
															JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO,'%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
															WHERE suf.FAV_TYPE = '10' AND suf.USER_ID = :USER_ID) c , e_option eo WHERE eo.QUES_ID = c.QUES_ID

android.get.error.knowledgepoints.by.userid.subjectid= SELECT DISTINCT ek2.KP_ID, ek2.KP_NAME, ek2.P_KP_ID, COUNT(eq.QUES_ID) TOTAL FROM e_rec_detail_view erdv, e_question eq, e_knowledge ek1, e_knowledge ek2 \
														WHERE erdv.SCORE <> - 1 AND erdv.QUES_FLAG = 1 AND eq.QUES_ID = erdv.QUES_ID AND ( eq.SUBJECT_NO = :SUBJECT_ID OR - 1 = :SUBJECT_ID ) \
														AND ( eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) \
														AND ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID GROUP BY ek2.KP_ID, ek2.KP_NAME, ek2.P_KP_ID

android.get.error.questions.basicinfo.by.userid.kpid= SELECT DISTINCT eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, IF(ISNULL(suf.OBJ_ID)=1, 0, 1) FAV_FLAG, \
														IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, equ.QUES_CONTENT ARTICLE, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT \
														FROM user_ques_record_view uqrv JOIN e_question eq ON eq.QUES_ID = uqrv.QUES_ID JOIN e_knowledge ek1 ON ( eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) \
														JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID LEFT JOIN s_user_fav suf ON suf.FAV_TYPE = '10' AND suf.OBJ_ID = eq.QUES_ID \
														LEFT JOIN e_note note ON note.QUES_ID = eq.QUES_ID LEFT JOIN e_question equ ON equ.QUES_ID = eq.REMARK LEFT JOIN (SELECT QUES_ID, OPT_NO, ERROR_NUM FROM( \
														SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID FROM error_opt_view eov, \
														( SELECT @rankNo := 0, @quesId := NULL ) rn) easy_error_opt	WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = eq.QUES_ID WHERE uqrv.USER_ID = :USER_ID AND uqrv.TOTAL_DO_NUM <> uqrv.RIGHT_DO_NUM

android.get.options.of.errorquestions.by.userid.kpid = SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( SELECT DISTINCT ek2.KP_ID, eq.QUES_ID FROM user_ques_record_view uqrv JOIN e_question eq ON eq.QUES_ID = uqrv.QUES_ID \
														JOIN e_knowledge ek1 ON ( eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%')) JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') \
														AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID WHERE uqrv.USER_ID = :USER_ID AND uqrv.RIGHT_DO_NUM <> uqrv.TOTAL_DO_NUM ) c, e_option eo WHERE eo.QUES_ID = c.QUES_ID

android.get.note.knowledgepoints.by.userid.subjectid = SELECT KP_ID, KP_NAME, p_KP_ID, COUNT(QUES_ID) TOTAL FROM ( \
														SELECT DISTINCT ek2.KP_ID, ek2.KP_NO, ek2.KP_NAME, eq.QUES_ID, eq.KNOWLEDGE_POINT, ek2.P_KP_ID \
														FROM e_note note JOIN e_question eq ON eq.QUES_ID = note.QUES_ID AND (eq.SUBJECT_NO = :SUBJECT_ID OR -1 = :SUBJECT_ID) \
														JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID,',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,',ek1.KP_ID,',%')) \
														JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO,'%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID \
														WHERE note.USER_ID = :USER_ID )c GROUP BY KP_ID, KP_NAME, P_KP_ID

android.get.note.questions.basicinfo.by.userid.kpid = SELECT DISTINCT ek2.KP_ID, eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.KEYWORD, eq.KNOWLEDGE_POINT, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, uqrv.TOTAL_DO_NUM, uqrv.RIGHT_DO_NUM, IF(ISNULL(suf.OBJ_ID)=1, 0, 1) FAV_FLAG, \
														IF ( QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, equ.QUES_CONTENT ARTICLE, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT \
														FROM e_note note JOIN e_question eq ON eq.QUES_ID = note.QUES_ID LEFT JOIN user_ques_record_view uqrv ON uqrv.USER_ID = :USER_ID AND uqrv.QUES_ID = eq.QUES_ID \
														JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID, ',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,', ek1.KP_ID, ',%') ) \
														JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO, '%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
														JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID LEFT JOIN s_user_fav suf ON suf.FAV_TYPE = '10' AND suf.OBJ_ID = eq.QUES_ID LEFT JOIN e_question equ ON equ.QUES_ID = eq.REMARK LEFT JOIN (SELECT QUES_ID, OPT_NO, ERROR_NUM FROM ( \
														SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
														FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = eq.QUES_ID WHERE note.USER_ID = :USER_ID

android.get.options.of.notequestions.by.userid.kpid = SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_REFER, eo.OPT_CONTENT FROM ( \
														SELECT DISTINCT ek2.KP_ID, eq.QUES_ID FROM e_note note JOIN e_question eq ON eq.QUES_ID = note.QUES_ID \
														JOIN e_knowledge ek1 ON (eq.KNOWLEDGE_POINT LIKE CONCAT(ek1.KP_ID,',%') OR eq.KNOWLEDGE_POINT LIKE CONCAT('%,',ek1.KP_ID,',%')) \
														JOIN e_knowledge ek2 ON ek1.KP_NO LIKE CONCAT(ek2.KP_NO,'%') AND ek2.SUBJECT_ID = ek1.SUBJECT_ID AND ek2.KP_ID = :KP_ID \
														WHERE note.USER_ID = :USER_ID ) c, e_option eo WHERE eo.QUES_ID = c.QUES_ID

android.collect.question = INSERT INTO s_user_fav(USER_ID, FAV_TYPE, OBJ_ID, FAV_TIME, REMARK) VALUES(:USER_ID, '10', :QUES_ID, NOW(), :REMARK)

android.update.homeworkrecord.to.commit = UPDATE e_hw_record SET COMMIT_FLAG = 1, COMMIT_TIME = NOW() WHERE HW_REC_ID = :HW_REC_ID

android.get.userinfo.by.userid = SELECT su.user_no, su.mail_address, cs.STUDENT_NAME, csch.SCHOOL_NAME, sc.`NAME` PROVINCE \
									FROM s_user su, c_student cs, c_class_student ccs, c_class cc, c_grade cg, c_school csch, s_code sc \
									WHERE su.user_id = :USER_ID AND cs.USER_ID = su.user_id AND ccs.STUDENT_ID = cs.STUDENT_ID AND cc.CLASS_ID = ccs.CLASS_ID \
									AND cg.GRADE_ID = cc.GRADE_ID AND csch.SCHOOL_ID = cg.SCHOOL_ID AND sc.`CODE` = csch.RESP_DIST AND sc.CODE_CATE = 'AREA'

android.get.questionsinfo.by.hwid.hwrecid = SELECT ehq.QUES_ID, ehq.M_TOPIC, eq.QUES_CONTENT, eq.QUES_TYPE, ehrd.STUDENT_ANSWER, IFNULL(ehrd.ANSWER_TIME,0) ANSWER_TIME, eq.REMARK \
											FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID \
											LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = :HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID \
											WHERE ehq.HW_ID = :HW_ID
											
android.get.question.by.quesid= SELECT eq.QUES_ID, eq.QUES_TYPE, eq.QUES_CONTENT, eq.QUES_REFER, eq.KNOWLEDGE_POINT, eq.SUBJECT_NO, eq.KEYWORD, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, equ.QUES_CONTENT REMARK, \
								IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE (qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2) * 100, "%" )) CORRECT_PERCENT, eov.OPT_NO EASY_ERROR_OPT FROM e_question eq \
								JOIN ques_statistic qs ON qs.QUES_ID = eq.QUES_ID LEFT JOIN e_question equ ON equ.QUES_ID = eq.REMARK \
								LEFT JOIN error_opt_view eov ON eov.QUES_ID = eq.QUES_ID WHERE eq.QUES_ID = :QUES_ID

android.get.option.by.quesid = SELECT :QUES_ID QUES_ID, eo.OPT_NO, eo.OPT_CONTENT FROM e_option eo WHERE eo.QUES_ID = :QUES_ID

android.get.studentid.by.userid = SELECT s.STUDENT_ID FROM c_student AS s INNER JOIN c_class_student AS cs ON s.STUDENT_ID = cs.STUDENT_ID WHERE s.USER_ID = :USER_ID AND cs.EXIST_FLAG = 1

android.get.uncommithwnum.by.userid= SELECT IFNULL(SUM(1), 0) TOTAL_NUM, IFNULL( SUM(1) - SUM(IFNULL(ehr.COMMIT_FLAG, 0)), 0 ) UNCOMMIT_NUM FROM c_student cs JOIN c_class_student ccs ON ccs.STUDENT_ID = cs.STUDENT_ID AND ccs.EXIST_FLAG = 1 \
									JOIN e_hw_class ehc ON ehc.CLASS_ID = ccs.CLASS_ID AND ehc.START_TIME <= NOW() AND ehc.END_TIME > NOW() LEFT JOIN e_hw_record ehr ON ( ehr.HW_ID = ehc.HW_ID AND ehr.STUDENT_ID = cs.STUDENT_ID ) WHERE cs.USER_ID = :USER_ID

android.get.hwrecinfo.by.hwid.userid = SELECT eh.HW_ID, eh.SUBJECT_ID, cs.USER_ID, cs.STUDENT_ID, ccs.CLASS_ID FROM e_homework eh, c_student cs, c_class_student ccs WHERE eh.HW_ID = :HW_ID AND cs.USER_ID = :USER_ID AND ccs.STUDENT_ID = cs.STUDENT_ID

android.get.errorquestions.by.hwid.hwrecid = SELECT sa.QUES_ID, sa.M_TOPIC, sa.QUES_TYPE, sa.QUES_CONTENT, sa.REMARK, sa.KNOWLEDGE_POINT, sa.KEYWORD, sa.QUES_REFER, sa.STUDENT_ANSWER, sa.ANSWER, sa.TEACHER_COMMENT, sa.ANSWER_TIME, sa.FAV_FLAG, sa.O_SCORE, qs.QUES_TOTAL_NUM, qs.QUES_RIGHT_NUM, \
												IF ( qs.QUES_TOTAL_NUM = 0, 0, CONCAT( TRUNCATE ( qs.QUES_RIGHT_NUM / qs.QUES_TOTAL_NUM, 2 ) * 100, "%" )) CORRECT_PERCENT, eaerr.OPT_NO EASY_ERROR_OPT, eaerr.ERROR_NUM, note.NOTE_ID, note.CONTENT \
												FROM (SELECT ehq.HW_ID, ehq.QUES_ID, ehq.M_TOPIC, eq.QUES_CONTENT, eq.QUES_TYPE, eq.REMARK, eq.KNOWLEDGE_POINT, eq.KEYWORD, eq.QUES_REFER, ehrd.TEACHER_COMMENT, ehrd.ANSWER, ehrd.ANSWER_TIME, ehrd.SCORE, ehrd.O_SCORE, \
												IF ( ehrd.SCORE >= ehq.SCORE, IF ( eq.QUES_TYPE NOT IN (1, 2, 3), ehrd.STUDENT_ANSWER, "@#@#" ), ehrd.STUDENT_ANSWER ) STUDENT_ANSWER, IF (ISNULL(suf.OBJ_ID) = 1, 0, 1) FAV_FLAG \
												FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID LEFT JOIN e_hw_record ehr ON ehr.HW_ID = ehq.HW_ID AND ehr.HW_REC_ID = :HW_REC_ID LEFT JOIN s_user_fav suf ON suf.FAV_TYPE = 10 \
												AND suf.OBJ_ID = ehq.QUES_ID AND suf.USER_ID = ehr.USER_ID LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = ehr.HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID \
												WHERE ehq.HW_ID = :HW_ID ) sa JOIN e_hw_question ehq ON ehq.HW_ID = sa.HW_ID AND ehq.QUES_ID = sa.QUES_ID AND ( sa.SCORE < ehq.SCORE OR ISNULL(sa.SCORE) = 1 ) \
												LEFT JOIN e_note note ON note.QUES_ID = ehq.QUES_ID LEFT JOIN ques_statistic qs ON qs.QUES_ID = ehq.QUES_ID LEFT JOIN (SELECT QUES_ID, OPT_NO, ERROR_NUM \
												FROM (SELECT eov.QUES_ID, eov.OPT_NO, eov.ERROR_NUM, IF ( @quesId = eov.QUES_ID, @rankNo :=@rankNo + 1, @rankNo := 1 ) AS RANK_NO, @quesId := eov.QUES_ID \
												FROM error_opt_view eov, ( SELECT @rankNo := 0, @quesId := NULL ) rn) easy_error_opt WHERE RANK_NO = 1) eaerr ON eaerr.QUES_ID = ehq.QUES_ID ORDER BY sa.M_TOPIC

android.get.options.of.errorquestions.by.hwid.hwrecid = SELECT eo.QUES_ID, eo.OPT_ID, eo.OPT_NO, eo.OPT_CONTENT, eo.OPT_REFER FROM ( \
														SELECT ehq.HW_ID, ehq.M_TOPIC, ehq.QUES_ID, ehrd.SCORE FROM e_hw_question ehq JOIN e_question eq ON eq.QUES_ID = ehq.QUES_ID \
														LEFT JOIN e_hw_record_detail ehrd ON ehrd.HW_REC_ID = :HW_REC_ID AND ehrd.QUES_ID = ehq.QUES_ID WHERE ehq.HW_ID = :HW_ID \
														) sa JOIN e_hw_question ehq ON ehq.HW_ID = sa.HW_ID AND ehq.QUES_ID = sa.QUES_ID AND ( sa.SCORE < ehq.SCORE OR ISNULL(sa.SCORE) = 1 ) \
														JOIN e_option eo ON eo.QUES_ID = ehq.QUES_ID ORDER BY sa.M_TOPIC, eo.OPT_NO

android.cancel.collection.by.userid.quesid = DELETE FROM s_user_fav WHERE USER_ID = :USER_ID AND FAV_TYPE = '10' AND OBJ_ID = :QUES_ID

android.get.options.of.homeworkquestions.by.hwid = SELECT eq.QUES_ID, eq.QUES_TYPE, eq.OPTION_NUM, eo.OPT_ID FROM e_hw_question ehq, e_question eq, e_option eo \
													WHERE ehq.HW_ID = :HW_ID AND eq.QUES_ID = ehq.QUES_ID AND eo.QUES_ID = ehq.QUES_ID ORDER BY ehq.M_TOPIC, eo.OPT_NO

android.get.hwrecorddetailinfo.by.hwrecid.quesid = SELECT eq.QUES_ID, eq.QUES_TYPE, eq.QUES_REFER, ehrd.ANSWER, ehrd.SCORE, ehrd.STUDENT_ANSWER FROM e_question eq, e_hw_record_detail ehrd WHERE eq.QUES_ID = :QUES_ID AND ehrd.QUES_ID = eq.QUES_ID AND ehrd.HW_REC_ID = :HW_REC_ID

android.get.options.of.onequestion.by.quesid= SELECT OPT_ID, OPT_NO, OPT_REFER FROM e_option WHERE QUES_ID = :QUES_ID ORDER BY OPT_ID

android.update.homeworkdetail.of.radio.checkbox = UPDATE e_hw_record_detail SET ANSWER = :ANSWER, STUDENT_ANSWER = :STUDENT_ANSWER, SCORE = :SCORE, ANSWER_TIME = :ANSWER_TIME WHERE HW_REC_ID = :HW_REC_ID AND QUES_ID = :QUES_ID

android.update.homeworkdetail.of.objectiveques = UPDATE e_hw_record_detail SET STUDENT_ANSWER = :STUDENT_ANSWER, ANSWER_TIME = :ANSWER_TIME WHERE HW_REC_ID = :HW_REC_ID AND QUES_ID = :QUES_ID

android.get.quesrecord.by.userid.quesid= SELECT qrv.RECORD_NAME, qrv.RIGHT_FLAG, qrv.STUDENT_ANSWER, qrv.ANSWER_TIME, qrv.COMMIT_TIME FROM ques_record_view qrv WHERE qrv.QUES_ID = :QUES_ID AND qrv.USER_ID = :USER_ID ORDER BY IFNULL(COMMIT_TIME, 0) DESC

android.get.hwrecid.by.hwid.userid = SELECT HW_REC_ID FROM e_hw_record WHERE USER_ID = :USER_ID AND HW_ID = :HW_ID

android.update.homework.finishednum.by.hwrecid = UPDATE e_hw_record SET FINISHED_NUM = FINISHED_NUM+:NUM WHERE HW_REC_ID = :HW_REC_ID
#######################################################
#
#FORMULA
#
#######################################################
formula.insert = INSERT INTO e_formula (USER_ID,LATEX,URL,SIZE,WIDTH,HEIGHT,COUNT,CREATETIME) \
               VALUES (:USERID, :LATEX,:URL,:SIZE,:WIDTH,:HEIGHT,:COUNT,:CREATETIME)
formula.get.userid = ${formula.get.all} WHERE USER_ID = :USERID

formula.get.all = SELECT USER_ID,LATEX,URL,SIZE,WIDTH,HEIGHT,COUNT,CREATETIME FROM  e_formula

formula.get.latex = ${formula.get.all} WHERE LATEX = :LATEX

formula.get.userid.latex = ${formula.get.all} WHERE USER_ID = :USERID AND LATEX = :LATEX

formula.update.count = UPDATE e_formula SET count = count+1 WHERE USER_ID = :USERID AND LATEX = :LATEX

formula.get.formulas= SELECT ID, LATEX, URL FROM e_formula WHERE USER_ID = :USER_ID ORDER BY CREATETIME DESC LIMIT 0, 10

formula.update.count.by.id= UPDATE e_formula SET COUNT = COUNT + 1 WHERE ID = :ID
#######################################################
#
#WENDA
#
#######################################################
wenda.get.allsorts= SELECT SORT_PARENT_ID, SORT_ID, SORT_NAME FROM w_sort WHERE ( SORT_PARENT_ID = 1 OR SORT_PARENT_ID = 2 OR SORT_PARENT_ID = 3 ) AND ( SORT_ID <> 4 AND SORT_ID <> 5 AND SORT_ID <> 6 ) ORDER BY SORT_PARENT_ID, SORT_ID

wenda.get.bean= SELECT USER_ID, BEAN FROM f_bean WHERE USER_ID = :USER_ID

wenda.get.shell= SELECT USER_ID, SHELL FROM f_shell WHERE USER_ID = :USER_ID

wenda.create.ask= INSERT INTO w_ask(ASK_ID, USER_ID, SUBJECT_ID, GRADE_LEVEL, CONTENT,PICTURE, VOICE, `STATUS`, BEAN, SHELL, ASK_TIME) \
				VALUES(:ASK_ID, :USER_ID, :SUBJECT_ID, :GRADE_LEVEL, :CONTENT, :PICTURE, :VOICE, :STATUS, :BEAN, :SHELL, :ASK_TIME)
				
wenda.get.latest.ask= SELECT wa.ASK_ID, wa.USER_ID, su.user_no, su.photo, wa.CONTENT, wa.PICTURE, wa.BEAN, wa.SHELL, IF ( wa.GRADE_LEVEL < 7, '\u5C0F\u5B66', sc.`NAME` ) `NAME`, ws.SORT_NAME, \
						IF ( CURDATE() > wa.ASK_TIME, DATE_FORMAT(wa.ASK_TIME, '%m\u6708%d\u65E5'), IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wa.ASK_TIME, '%H:%i')), \
						IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5206\u949F\u524D' ), \
						CONCAT( SECOND ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u79D2\u524D' ))))) ASK_TIME, SUM( IF ( ISNULL(wan.ANSWER_ID) = 0, 1, 0 )) ANSWER_NUM FROM w_ask wa JOIN s_user su ON su.user_id = wa.USER_ID \
						JOIN w_sort ws ON ws.SORT_ID = wa.SUBJECT_ID JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = wa.GRADE_LEVEL LEFT JOIN w_anwser wan ON wan.ASK_ID = wa.ASK_ID AND wan.`STATUS` <> 2 WHERE \
						ADDDATE(wa.ASK_TIME, 3) >= NOW() AND wa.`STATUS` <> 2 GROUP BY wa.ASK_ID ORDER BY wa.ASK_TIME DESC
						
wenda.get.highreward.ask= SELECT wa.ASK_ID, wa.USER_ID, su.user_no, su.photo, wa.CONTENT, wa.PICTURE, wa.BEAN, wa.SHELL, IF ( wa.GRADE_LEVEL < 7, '\u5C0F\u5B66', sc.`NAME` ) `NAME`, ws.SORT_NAME, \
						IF ( CURDATE() > wa.ASK_TIME, DATE_FORMAT(wa.ASK_TIME, '%m\u6708%d\u65E5'), IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wa.ASK_TIME, '%H:%i')), \
						IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5206\u949F\u524D' ), \
						CONCAT(SECOND(TIMEDIFF(NOW(),wa.ASK_TIME)),'\u79D2\u524D'))))) ASK_TIME, SUM(IF(ISNULL(wan.ANSWER_ID)=0, 1, 0)) ANSWER_NUM FROM w_ask wa JOIN s_user su ON su.user_id = wa.USER_ID \
						JOIN w_sort ws ON ws.SORT_ID = wa.SUBJECT_ID JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = wa.GRADE_LEVEL LEFT JOIN w_anwser wan ON wan.ASK_ID = wa.ASK_ID AND wan.`STATUS` <> 2 \
						WHERE ADDDATE(wa.ASK_TIME, 3) >= NOW() AND (wa.SHELL > 0 OR wa.BEAN >= 10) AND wa.`STATUS` <> 2 GROUP BY wa.ASK_ID ORDER BY wa.SHELL DESC, wa.BEAN DESC, wa.ASK_TIME DESC
						
wenda.get.hot.ask= SELECT wa.ASK_ID, wa.USER_ID, su.user_no, su.photo, wa.CONTENT, wa.PICTURE, wa.BEAN, wa.SHELL, IF ( wa.GRADE_LEVEL < 7, '\u5C0F\u5B66', sc.`NAME` ) `NAME`, ws.SORT_NAME, \
					IF ( CURDATE() > wa.ASK_TIME, DATE_FORMAT(wa.ASK_TIME, '%m\u6708%d\u65E5'), IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wa.ASK_TIME, '%H:%i')), \
					IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5206\u949F\u524D' ), \
					CONCAT( SECOND ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u79D2\u524D' ))))) ASK_TIME, SUM( IF ( ISNULL(wan.ANSWER_ID) = 0, 1, 0 )) ANSWER_NUM \
					FROM w_ask wa JOIN s_user su ON su.user_id = wa.USER_ID JOIN w_sort ws ON ws.SORT_ID = wa.SUBJECT_ID JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' \
					AND sc.`CODE` = wa.GRADE_LEVEL LEFT JOIN w_anwser wan ON wan.ASK_ID = wa.ASK_ID AND wan.`STATUS` <> 2 WHERE ADDDATE(wa.ASK_TIME, 3) >= NOW() AND wa.`STATUS` <> 2 GROUP BY wa.ASK_ID ORDER BY wa.ASK_TIME DESC
					
wenda.get.ask= SELECT wa.ASK_ID, wa.USER_ID, su.user_no, su.photo, wa.CONTENT, wa.PICTURE, wa.VOICE, wa.BEAN, wa.SHELL, IF ( wa.GRADE_LEVEL < 7, '\u5C0F\u5B66', sc.`NAME` ) `NAME`, ws.SORT_NAME, \
				IF ( CURDATE() > wa.ASK_TIME, DATE_FORMAT(wa.ASK_TIME, '%m\u6708%d\u65E5'), IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wa.ASK_TIME, '%H:%i')), \
				IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5206\u949F\u524D' ), \
				CONCAT(SECOND(TIMEDIFF(NOW(),wa.ASK_TIME)),'\u79D2\u524D'))))) ASK_TIME, SUM(IF(ISNULL(wan.ANSWER_ID)=0, 1, 0)) ANSWER_NUM FROM w_ask wa JOIN s_user su ON su.user_id = wa.USER_ID \
				JOIN w_sort ws ON ws.SORT_ID = wa.SUBJECT_ID JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = wa.GRADE_LEVEL LEFT JOIN w_anwser wan ON wan.ASK_ID = wa.ASK_ID AND wan.`STATUS` <> 2 WHERE wa.ASK_ID = :ASK_ID
				
wenda.get.unlock.answers= SELECT wan.ANSWER_ID, wan.USER_ID, su.photo, su.user_no, wan.PICTURE, wan.VOICE, IFNULL(ds.DISCUSS_NUM, 0) DISCUSS_NUM, IFNULL(ass.ASSESS_NUM, 0) ASSESS_NUM, \
						IF ( CURDATE() > wan.ANSWER_TIME, DATE_FORMAT( wan.ANSWER_TIME, '%m\u6708%d\u65E5' ), IF ( HOUR ( TIMEDIFF(NOW(), wan.ANSWER_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wan.ANSWER_TIME, '%H:%i')), \
						IF ( HOUR ( TIMEDIFF(NOW(), wan.ANSWER_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wan.ANSWER_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wan.ANSWER_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wan.ANSWER_TIME)), '\u5206\u949F\u524D' ), \
						CONCAT(SECOND(TIMEDIFF(NOW(),wan.ANSWER_TIME)),'\u79D2\u524D'))))) ANSWER_TIME FROM w_anwser wan JOIN s_user su ON su.user_id = wan.USER_ID \
						LEFT JOIN (SELECT ANSWER_ID, COUNT(ANSWER_ID) DISCUSS_NUM FROM w_discuss WHERE `STATUS` <> 2 GROUP BY ANSWER_ID) ds ON ds.ANSWER_ID = wan.ANSWER_ID \
						LEFT JOIN (SELECT ANSWER_ID, COUNT(ANSWER_ID) ASSESS_NUM FROM w_assess GROUP BY ANSWER_ID) ass ON ass.ANSWER_ID = wan.ANSWER_ID \
						WHERE wan.ASK_ID = :ASK_ID AND wan.`STATUS` <> 2 AND ( EXISTS ( SELECT 1 FROM w_unlock wu WHERE wu.ANSWER_ID = wan.ANSWER_ID AND wu.USER_ID = :USER_ID ) OR wan.USER_ID = :USER_ID ) ORDER BY wan.ANSWER_TIME DESC
						
wenda.get.lock.answers= SELECT wan.ANSWER_ID, wan.USER_ID, su.photo, su.user_no, wan.BEAN, IF ( ISNULL(wan.VOICE) = 0 && wan.VOICE <> '', 1, 0 ) VOICE_FLAG, \
						IFNULL(ul.UNLOCK_NUM, 0) UNLOCK_NUM, IFNULL(ass.GOOD_ASSESS_NUM, 0) GOOD_ASSESS_NUM, IFNULL(ass.STAR, 0) STAR, IFNULL(asst.ASSESS_COUNT, 0) ASSESS_COUNT, \
						IFNULL(asst.BAD_ASSESS_TOTAL, 0) BAD_ASSESS_TOTAL, IFNULL(asst.GOOD_ASSESS_TOTAL, 0) GOOD_ASSESS_TOTAL, IFNULL(asst.STAR_TOTAL, 0) STAR_TOTAL, \
						IFNULL(ant.ANSWER_TOTAL, 0) ANSWER_TOTAL, IFNULL(ult.UNLOCK_TOTAL, 0) UNLOCK_TOTAL FROM w_anwser wan JOIN s_user su ON su.user_id = wan.USER_ID \
						LEFT JOIN (SELECT ANSWER_ID, COUNT(ANSWER_ID) UNLOCK_NUM FROM w_unlock GROUP BY ANSWER_ID) ul ON ul.ANSWER_ID = wan.ANSWER_ID \
						LEFT JOIN (SELECT ANSWER_ID, TRUNCATE (SUM(STAR) / SUM(1), 1) STAR, SUM(IF(ASSESS = 3, 1, 0)) GOOD_ASSESS_NUM FROM w_assess GROUP BY ANSWER_ID) ass ON ass.ANSWER_ID = wan.ANSWER_ID \
						LEFT JOIN (SELECT AN_USER_ID, TRUNCATE (SUM(STAR) / SUM(1), 1) STAR_TOTAL, SUM(1) ASSESS_COUNT, SUM(IF(ASSESS = 3, 1, 0)) GOOD_ASSESS_TOTAL, SUM(IF(ASSESS = 1, 1, 0)) BAD_ASSESS_TOTAL FROM w_assess GROUP BY AN_USER_ID) asst ON asst.AN_USER_ID = wan.USER_ID \
						LEFT JOIN (SELECT USER_ID, COUNT(USER_ID) ANSWER_TOTAL FROM w_anwser GROUP BY USER_ID) ant ON ant.USER_ID = wan.USER_ID \
						LEFT JOIN (SELECT wa.USER_ID, COUNT(wa.USER_ID) UNLOCK_TOTAL FROM w_anwser wa, w_unlock wu WHERE wu.ANSWER_ID = wa.ANSWER_ID GROUP BY wa.USER_ID) ult ON ult.USER_ID = wan.USER_ID \
						WHERE wan.ASK_ID = :ASK_ID AND wan.`STATUS` <> 2 AND ( NOT EXISTS ( SELECT 1 FROM w_unlock wu WHERE wu.ANSWER_ID = wan.ANSWER_ID AND wu.USER_ID =:USER_ID ) AND wan.USER_ID <> :USER_ID ) ORDER BY wan.ANSWER_TIME DESC
						
wenda.create.answer= INSERT INTO w_anwser(ANSWER_ID, USER_ID, ASK_ID, CONTENT, PICTURE, VOICE, `STATUS`, BEAN, SHELL, ANSWER_TIME) \
					VALUES (:ANSWER_ID, :USER_ID, :ASK_ID, :CONTENT, :PICTURE, :VOICE, :`STATUS`, :BEAN, :SHELL, :ANSWER_TIME)
					
wenda.create.inform= INSERT INTO w_inform (INFORM_ID, USER_ID, INFORM_OBJ_ID, INFORM_TYPE, INFORM_REASON, `STATUS`, RESULT, INFORM_TIME) \
					VALUES(:INFORM_ID, :USER_ID, :INFORM_OBJ_ID, :INFORM_TYPE, :INFORM_REASON, :`STATUS`, :RESULT, :INFORM_TIME)
					
wenda.get.discusses= SELECT wd.DISCUSS_ID, wd.USER_ID, su.user_no, su.photo, wd.DISCUSS_CONTENT, wd.PICTURE, wd.VOICE, IF ( CURDATE() > wd.DISCUSS_TIME, DATE_FORMAT( wd.DISCUSS_TIME, '%m\u6708%d\u65E5' ), \
					IF ( HOUR ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wd.DISCUSS_TIME, '%H:%i')), IF ( HOUR ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)), '\u5C0F\u65F6\u524D' ), \
					IF ( MINUTE ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)), '\u5206\u949F\u524D' ), CONCAT( SECOND ( TIMEDIFF(NOW(), wd.DISCUSS_TIME)), '\u79D2\u524D' ) \
					)))) ANSWER_TIME FROM w_discuss wd, s_user su WHERE wd.ANSWER_ID = :ANSWER_ID AND wd.`STATUS` <> 2 AND su.user_id = wd.USER_ID ORDER BY wd.DISCUSS_TIME DESC

wenda.create.discuss= INSERT INTO w_discuss(DISCUSS_ID, USER_ID, ANSWER_ID, ASK_ID, DISCUSS_CONTENT, PICTURE, VOICE, `STATUS`, DISCUSS_TIME) \
					VALUES(:DISCUSS_ID, :USER_ID, :ANSWER_ID, :ASK_ID, :DISCUSS_CONTENT, :PICTURE, :VOICE, :STATUS, :DISCUSS_TIME)
					
wenda.get.assesses= SELECT was.ASSESS_ID, su.user_id, su.photo, su.user_no, was.ASSESS, was.ASSESS_CONTENT, was.STAR \
					FROM w_assess was, s_user su WHERE was.ANSWER_ID = :ANSWER_ID AND su.user_id = was.AN_USER_ID ORDER BY was.ASSESS_TIME DESC

wenda.create.assess= INSERT INTO w_assess(ASSESS_ID, USER_ID, ANSWER_ID, AN_USER_ID, ASK_ID, AS_USER_ID, ASSESS, ASSESS_CONTENT, STAR, ASSESS_TIME, `EXPLAIN`) \
					VALUES (:ASSESS_ID, :USER_ID, :ANSWER_ID, :AN_USER_ID, :ASK_ID, :AS_USER_ID, :ASSESS, :ASSESS_CONTENT, :STAR, :ASSESS_TIME, :`EXPLAIN`)
					
wenda.create.unlock= INSERT INTO w_unlock(ANSWER_ID, USER_ID, ASK_ID, UNLOCK_TIME) VALUES(:ANSWER_ID, :USER_ID, :ASK_ID, :UNLOCK_TIME)

wenda.update.bean= UPDATE f_bean SET BEAN = BEAN + :BEAN WHERE USER_ID = :USER_ID

wenda.update.shell= UPDATE f_shell SET SHELL = SHELL + :SHELL WHERE USER_ID = :USER_ID

wenda.get.answer= SELECT wa.ASK_ID, wa.USER_ID, su.user_no, su.photo, wa.CONTENT, wa.PICTURE, wa.VOICE, wa.BEAN, wa.SHELL, IF ( wa.GRADE_LEVEL < 7, '\u5C0F\u5B66', sc.`NAME` ) `NAME`, ws.SORT_NAME, \
					IF ( CURDATE() > wa.ASK_TIME, DATE_FORMAT(wa.ASK_TIME, '%m\u6708%d\u65E5'), IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) >= 4, CONCAT( '\u4ECA\u5929', TIME_FORMAT(wa.ASK_TIME, '%H:%i')), \
					IF ( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( HOUR ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5C0F\u65F6\u524D' ), IF ( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)) > 0, CONCAT( MINUTE ( TIMEDIFF(NOW(), wa.ASK_TIME)), '\u5206\u949F\u524D' ), \
					CONCAT(SECOND(TIMEDIFF(NOW(),wa.ASK_TIME)),'\u79D2\u524D'))))) ASK_TIME, SUM(IF(ISNULL(wan.ANSWER_ID)=0, 1, 0)) ANSWER_NUM FROM w_ask wa JOIN s_user su ON su.user_id = wa.USER_ID \
					JOIN w_sort ws ON ws.SORT_ID = wa.SUBJECT_ID JOIN s_code sc ON sc.CODE_CATE = 'GRADELEVEL' AND sc.`CODE` = wa.GRADE_LEVEL LEFT JOIN w_anwser wan ON wan.ASK_ID = wa.ASK_ID AND wan.`STATUS` <> 2 WHERE wa.ASK_ID = :ASK_ID
zhujuan.category.insert = insert into z_category(id,name, parent_id,type,bank_id) values(:ID, :NAME, :PARENTID, :TYPE, :BANKID)
zhujuan.categroy.select = SELECT C.id AS 'id', C.name as 'name', C.parent_id as 'parentid', C.type as 'type', C.bank_id as 'bankid'  from z_category C where parent_id = :CATEGORYID and type = :TYPE and bank_id = :BANKID
zhujuan.imageurl.save=REPLACE INTO z_image(url) values (:IMGURL)
zhujuan.category.ques.save=REPLACE INTO z_ques_category(ques_id, category_id) VALUES (:QUESID, :CATEGORYID)
zhujuan.ques.save = INSERT INTO z_ques(id,QuesAbility,QuesAnswer,QuesBody,QuesDiff,QuesParse,QuesType,Time,Title) \
                    VALUES(:ID, :QUESABILITY, :QUESANSWER, :QUESBODY, :QUESDIFF, :QUESPARSE, :QUESTYPE, :TIME, :TITLE)
zhujuan.task.log.select = SELECT pageNo FROM z_log Z WHERE Z.task_id = :TASKID
zhujuan.task.select = SELECT task_id as 'id', category_id as 'categoryId', type, bank_id as 'bankId' FROM z_task WHERE flag = 0
zhujuan.task.update = UPDATE z_task SET FLAG = 1 WHERE task_id = :TASKID
zhujuan.task.log.save = replace into z_log(task_id, pageNo) VALUES(:TASKID, :PAGENO)
zhujuan.image.select = select url from z_image LIMIT :LIMIT
zhujuan.image.delete = delete from z_image where url = :URL
zhujuan.ques.select = SELECT q.id, q.QuesAbility, q.QuesAnswer,q.QuesBody,q.QuesDiff,q.QuesParse,q.QuesType,q.Time,q.Title from z_ques q where q.flag = 0 LIMIT :LIMIT
zhujuan.ques.update = update z_ques set flag = 1 where ID = :ID